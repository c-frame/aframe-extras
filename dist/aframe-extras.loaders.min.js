!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("THREE"));else if("function"==typeof define&&define.amd)define(["THREE"],t);else{var r="object"==typeof exports?t(require("THREE")):t(e.THREE);for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(self,(e=>(()=>{var t={883:e=>{e.exports=THREE.ColladaLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"anonymous",load:function(e,t,r,n){var a=this,o=void 0===a.path?THREE.LoaderUtils.extractUrlBase(e):a.path,i=new THREE.FileLoader(a.manager);i.setPath(a.path),i.load(e,(function(e){t(a.parse(e,o))}),r,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){function r(e,t){for(var r=[],n=e.childNodes,a=0,o=n.length;a<o;a++){var i=n[a];i.nodeName===t&&r.push(i)}return r}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,a=t.length;n<a;n++)r[n]=t[n];return r}function a(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,a=t.length;n<a;n++)r[n]=parseFloat(t[n]);return r}function o(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),n=0,a=t.length;n<a;n++)r[n]=parseInt(t[n]);return r}function i(e){return e.substring(1)}function s(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function c(e){return void 0!==e?e.textContent:"Y_UP"}function u(e,t,n,a){var o=r(e,t)[0];if(void 0!==o)for(var i=r(o,n),s=0;s<i.length;s++)a(i[s])}function d(e,t){for(var r in e)e[r].build=t(e[r])}function p(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function h(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType&&"input"===a.nodeName){var o=i(a.getAttribute("source")),s=a.getAttribute("semantic");t.inputs[s]=o}}return t}function f(e){var t={},r=e.getAttribute("target").split("/"),n=r.shift(),a=r.shift(),o=-1!==a.indexOf("("),s=-1!==a.indexOf(".");if(s)r=a.split("."),a=r.shift(),t.member=r.shift();else if(o){var l=a.split("(");a=l.shift();for(var c=0;c<l.length;c++)l[c]=parseInt(l[c].replace(/\)/,""));t.indices=l}return t.id=n,t.sid=a,t.arraySyntax=o,t.memberSyntax=s,t.sampler=i(e.getAttribute("source")),t}function m(e){var t=[],r=e.channels,n=e.samplers,a=e.sources;for(var o in r)if(r.hasOwnProperty(o)){var i=r[o],s=n[i.sampler],l=s.inputs.INPUT,c=s.inputs.OUTPUT;E(v(i,a[l],a[c]),t)}return t}function g(e){return p(qe.animations[e],m)}function v(e,t,r){var n,a,o,i,s,l,c=qe.nodes[e.id],u=Fe(c.id),d=c.transforms[e.sid],p=c.matrix.clone().transpose(),h={};switch(d){case"matrix":for(o=0,i=t.array.length;o<i;o++)if(n=t.array[o],a=o*r.stride,void 0===h[n]&&(h[n]={}),!0===e.arraySyntax){var f=r.array[a],m=e.indices[0]+4*e.indices[1];h[n][m]=f}else for(s=0,l=r.stride;s<l;s++)h[n][s]=r.array[a+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',d)}var g=function(e,t){var r=[];for(var n in e)r.push({time:parseFloat(n),value:e[n]});r.sort((function(e,t){return e.time-t.time}));for(var a=0;a<16;a++)x(r,a,t.elements[a]);return r}(h,p);return{name:u.uuid,keyframes:g}}var y=new THREE.Vector3,b=new THREE.Vector3,w=new THREE.Quaternion;function E(e,t){for(var r=e.keyframes,n=e.name,a=[],o=[],i=[],s=[],l=0,c=r.length;l<c;l++){var u=r[l],d=u.time,p=u.value;Ne.fromArray(p).transpose(),Ne.decompose(y,w,b),a.push(d),o.push(y.x,y.y,y.z),i.push(w.x,w.y,w.z,w.w),s.push(b.x,b.y,b.z)}return o.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".position",a,o)),i.length>0&&t.push(new THREE.QuaternionKeyframeTrack(n+".quaternion",a,i)),s.length>0&&t.push(new THREE.VectorKeyframeTrack(n+".scale",a,s)),t}function x(e,t,r){var n,a,o,i=!0;for(a=0,o=e.length;a<o;a++)void 0===(n=e[a]).value[t]?n.value[t]=null:i=!1;if(!0===i)for(a=0,o=e.length;a<o;a++)(n=e[a]).value[t]=r;else!function(e,t){for(var r,n,a=0,o=e.length;a<o;a++){var i=e[a];if(null===i.value[t]){if(r=T(e,a,t),n=N(e,a,t),null===r){i.value[t]=n.value[t];continue}if(null===n){i.value[t]=r.value[t];continue}A(i,r,n,t)}}}(e,t)}function T(e,t,r){for(;t>=0;){var n=e[t];if(null!==n.value[r])return n;t--}return null}function N(e,t,r){for(;t<e.length;){var n=e[t];if(null!==n.value[r])return n;t++}return null}function A(e,t,r,n){r.time-t.time!=0?e.value[n]=(e.time-t.time)*(r.value[n]-t.value[n])/(r.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function k(e){for(var t=[],r=e.name,n=e.end-e.start||-1,a=e.animations,o=0,i=a.length;o<i;o++)for(var s=g(a[o]),l=0,c=s.length;l<c;l++)t.push(s[l]);return new THREE.AnimationClip(r,n,t)}function R(e){return p(qe.clips[e],k)}function I(e){for(var t={sources:{}},r=0,n=e.childNodes.length;r<n;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=a(o.textContent);break;case"source":var i=o.getAttribute("id");t.sources[i]=ae(o);break;case"joints":t.joints=C(o);break;case"vertex_weights":t.vertexWeights=M(o)}}return t}function C(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType&&"input"===a.nodeName){var o=a.getAttribute("semantic"),s=i(a.getAttribute("source"));t.inputs[o]=s}}return t}function M(e){for(var t={inputs:{}},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"input":var s=a.getAttribute("semantic"),l=i(a.getAttribute("source")),c=parseInt(a.getAttribute("offset"));t.inputs[s]={id:l,offset:c};break;case"vcount":t.vcount=o(a.textContent);break;case"v":t.v=o(a.textContent)}}return t}function L(e){var t={id:e.id},r=qe.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,r,n,a={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=e.sources,i=e.vertexWeights,s=i.vcount,l=i.v,c=i.inputs.JOINT.offset,u=i.inputs.WEIGHT.offset,d=e.sources[e.joints.inputs.JOINT],p=e.sources[e.joints.inputs.INV_BIND_MATRIX],h=o[i.inputs.WEIGHT.id].array,f=0;for(t=0,n=s.length;t<n;t++){var m=s[t],g=[];for(r=0;r<m;r++){var v=l[f+c],y=h[l[f+u]];g.push({index:v,weight:y}),f+=2}for(g.sort(x),r=0;r<4;r++){var b=g[r];void 0!==b?(a.indices.array.push(b.index),a.weights.array.push(b.weight)):(a.indices.array.push(0),a.weights.array.push(0))}}for(e.bindShapeMatrix?a.bindMatrix=(new THREE.Matrix4).fromArray(e.bindShapeMatrix).transpose():a.bindMatrix=(new THREE.Matrix4).identity(),t=0,n=d.array.length;t<n;t++){var w=d.array[t],E=(new THREE.Matrix4).fromArray(p.array,t*p.stride).transpose();a.joints.push({name:w,boneInverse:E})}return a;function x(e,t){return t.weight-e.weight}}(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function D(e){return void 0!==e.build?e.build:e.init_from}function S(e){var t=qe.images[e];return void 0!==t?p(t,D):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function O(e){for(var t={surfaces:{},samplers:{}},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"newparam":F(a,t);break;case"technique":t.technique=B(a);break;case"extra":t.extra=z(a)}}return t}function F(e,t){for(var r=e.getAttribute("sid"),n=0,a=e.childNodes.length;n<a;n++){var o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"surface":t.surfaces[r]=P(o);break;case"sampler2D":t.samplers[r]=H(o)}}}function P(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];1===a.nodeType&&"init_from"===a.nodeName&&(t.init_from=a.textContent)}return t}function H(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];1===a.nodeType&&"source"===a.nodeName&&(t.source=a.textContent)}return t}function B(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=a.nodeName,t.parameters=j(a)}}return t}function j(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[a.nodeName]=U(a);break;case"transparent":t[a.nodeName]={opaque:a.getAttribute("opaque"),data:U(a)}}}return t}function U(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"color":t[o.nodeName]=a(o.textContent);break;case"float":t[o.nodeName]=parseFloat(o.textContent);break;case"texture":t[o.nodeName]={id:o.getAttribute("texture"),extra:_(o)}}}return t}function _(e){for(var t={technique:{}},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];1===a.nodeType&&"extra"===a.nodeName&&V(a,t)}return t}function V(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];1===a.nodeType&&"technique"===a.nodeName&&G(a,t)}}function G(e,t){for(var r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[a.nodeName]=parseFloat(a.textContent);break;case"wrapU":case"wrapV":"TRUE"===a.textContent.toUpperCase()?t.technique[a.nodeName]=1:"FALSE"===a.textContent.toUpperCase()?t.technique[a.nodeName]=0:t.technique[a.nodeName]=parseInt(a.textContent)}}}function z(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];1===a.nodeType&&"technique"===a.nodeName&&(t.technique=W(a))}return t}function W(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];1===a.nodeType&&"double_sided"===a.nodeName&&(t[a.nodeName]=parseInt(a.textContent))}return t}function X(e){return e}function q(e){var t,r,n=(t=e.url,p(qe.effects[t],X)),a=n.profile.technique,o=n.profile.extra;switch(a.type){case"phong":case"blinn":r=new THREE.MeshPhongMaterial;break;case"lambert":r=new THREE.MeshLambertMaterial;break;default:r=new THREE.MeshBasicMaterial}function i(e){var t=n.profile.samplers[e.id],r=null;if(void 0!==t?r=S(n.profile.surfaces[t.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=S(e.id)),null!==r){var a=function(e){var t=e.slice(2+(e.lastIndexOf(".")-1>>>0));return"tga"===(t=t.toLowerCase())?Ue:Ge}(r);if(void 0!==a){var o=a.load(r),i=e.extra;if(void 0!==i&&void 0!==i.technique&&!1===s(i.technique)){var l=i.technique;o.wrapS=l.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,o.wrapT=l.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,o.offset.set(l.offsetU||0,l.offsetV||0),o.repeat.set(l.repeatU||1,l.repeatV||1)}else o.wrapS=THREE.RepeatWrapping,o.wrapT=THREE.RepeatWrapping;return o}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}r.name=e.name;var l=a.parameters;for(var c in l){var u=l[c];switch(c){case"diffuse":u.color&&r.color.fromArray(u.color),u.texture&&(r.map=i(u.texture));break;case"specular":u.color&&r.specular&&r.specular.fromArray(u.color),u.texture&&(r.specularMap=i(u.texture));break;case"bump":u.texture&&(r.normalMap=i(u.texture));break;case"ambient":u.texture&&(r.lightMap=i(u.texture));break;case"shininess":u.float&&r.shininess&&(r.shininess=u.float);break;case"emission":u.color&&r.emissive&&r.emissive.fromArray(u.color),u.texture&&(r.emissiveMap=i(u.texture))}}var d=l.transparent,h=l.transparency;if(void 0===h&&d&&(h={float:1}),void 0===d&&h&&(d={opaque:"A_ONE",data:{color:[1,1,1,1]}}),d&&h)if(d.data.texture)r.transparent=!0;else{var f=d.data.color;switch(d.opaque){case"A_ONE":r.opacity=f[3]*h.float;break;case"RGB_ZERO":r.opacity=1-f[0]*h.float;break;case"A_ZERO":r.opacity=1-f[3]*h.float;break;case"RGB_ONE":r.opacity=f[0]*h.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',d.opaque)}r.opacity<1&&(r.transparent=!0)}return void 0!==o&&void 0!==o.technique&&1===o.technique.double_sided&&(r.side=THREE.DoubleSide),r}function K(e){return p(qe.materials[e],q)}function J(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if("technique_common"===r.nodeName)return Q(r)}return{}}function Q(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=Z(n)}}return t}function Z(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}function Y(e){var t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var r=e.optics.parameters.ymag,n=e.optics.parameters.xmag,a=e.optics.parameters.aspect_ratio;n=void 0===n?r*a:n,r=void 0===r?n/a:r,n*=.5,r*=.5,t=new THREE.OrthographicCamera(-n,n,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name,t}function $(e){var t=qe.cameras[e];return void 0!==t?p(t,Y):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function ee(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=a.nodeName,t.parameters=te(a)}}return t}function te(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"color":var i=a(o.textContent);t.color=(new THREE.Color).fromArray(i);break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var s=parseFloat(o.textContent);t.distance=s?Math.sqrt(1/s):0}}return t}function re(e){var t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function ne(e){var t=qe.lights[e];return void 0!==t?p(t,re):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ae(e){for(var t={array:[],stride:3},o=0;o<e.childNodes.length;o++){var i=e.childNodes[o];if(1===i.nodeType)switch(i.nodeName){case"float_array":t.array=a(i.textContent);break;case"Name_array":t.array=n(i.textContent);break;case"technique_common":var s=r(i,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function oe(e){for(var t={},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];1===n.nodeType&&(t[n.getAttribute("semantic")]=i(n.getAttribute("source")))}return t}function ie(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"input":var s=i(a.getAttribute("source")),l=a.getAttribute("semantic"),c=parseInt(a.getAttribute("offset")),u=parseInt(a.getAttribute("set")),d=u>0?l+u:l;t.inputs[d]={id:s,offset:c},t.stride=Math.max(t.stride,c+1),"TEXCOORD"===l&&(t.hasUV=!0);break;case"vcount":t.vcount=o(a.textContent);break;case"p":t.p=o(a.textContent)}}return t}function se(e){for(var t=0,r=0,n=e.length;r<n;r++)!0===e[r].hasUV&&t++;t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function le(e){var t={},r=e.sources,n=e.vertices,a=e.primitives;if(0===a.length)return{};var o=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(a);for(var i in o){var s=o[i];se(s),t[i]=ce(s,r,n)}return t}function ce(e,t,r){for(var n={},a={array:[],stride:0},o={array:[],stride:0},i={array:[],stride:0},s={array:[],stride:0},l={array:[],stride:0},c=[],u=[],d=new THREE.BufferGeometry,p=[],h=0,f=0;f<e.length;f++){var m=e[f],g=m.inputs,v=0;switch(m.type){case"lines":case"linestrips":v=2*m.count;break;case"triangles":v=3*m.count;break;case"polylist":for(var y=0;y<m.count;y++){var b=m.vcount[y];switch(b){case 3:v+=3;break;case 4:v+=6;break;default:v+=3*(b-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",m.type)}for(var w in d.addGroup(h,v,f),h+=v,m.material&&p.push(m.material),g){var E=g[w];switch(w){case"VERTEX":for(var x in r){var T=r[x];switch(x){case"POSITION":var N=a.array.length;if(ue(m,t[T],E.offset,a.array),a.stride=t[T].stride,t.skinWeights&&t.skinIndices&&(ue(m,t.skinIndices,E.offset,c),ue(m,t.skinWeights,E.offset,u)),!1===m.hasUV&&!0===e.uvsNeedsFix){v=(a.array.length-N)/a.stride;for(var A=0;A<v;A++)i.array.push(0,0)}break;case"NORMAL":ue(m,t[T],E.offset,o.array),o.stride=t[T].stride;break;case"COLOR":ue(m,t[T],E.offset,l.array),l.stride=t[T].stride;break;case"TEXCOORD":ue(m,t[T],E.offset,i.array),i.stride=t[T].stride;break;case"TEXCOORD1":ue(m,t[T],E.offset,s.array),i.stride=t[T].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',x)}}break;case"NORMAL":ue(m,t[E.id],E.offset,o.array),o.stride=t[E.id].stride;break;case"COLOR":ue(m,t[E.id],E.offset,l.array),l.stride=t[E.id].stride;break;case"TEXCOORD":ue(m,t[E.id],E.offset,i.array),i.stride=t[E.id].stride;break;case"TEXCOORD1":ue(m,t[E.id],E.offset,s.array),s.stride=t[E.id].stride}}}return a.array.length>0&&d.addAttribute("position",new THREE.Float32BufferAttribute(a.array,a.stride)),o.array.length>0&&d.addAttribute("normal",new THREE.Float32BufferAttribute(o.array,o.stride)),l.array.length>0&&d.addAttribute("color",new THREE.Float32BufferAttribute(l.array,l.stride)),i.array.length>0&&d.addAttribute("uv",new THREE.Float32BufferAttribute(i.array,i.stride)),s.array.length>0&&d.addAttribute("uv2",new THREE.Float32BufferAttribute(s.array,s.stride)),c.length>0&&d.addAttribute("skinIndex",new THREE.Float32BufferAttribute(c,4)),u.length>0&&d.addAttribute("skinWeight",new THREE.Float32BufferAttribute(u,4)),n.data=d,n.type=e[0].type,n.materialKeys=p,n}function ue(e,t,r,n){var a=e.p,o=e.stride,i=e.vcount;function s(e){for(var t=a[e+r]*c,o=t+c;t<o;t++)n.push(l[t])}var l=t.array,c=t.stride;if(void 0!==e.vcount)for(var u=0,d=0,p=i.length;d<p;d++){var h=i[d];if(4===h){var f=u+1*o,m=u+2*o,g=u+3*o;s(u+0*o),s(f),s(g),s(f),s(m),s(g)}else if(3===h)f=u+1*o,m=u+2*o,s(u+0*o),s(f),s(m);else if(h>4)for(var v=1,y=h-2;v<=y;v++)f=u+o*v,m=u+o*(v+1),s(u+0*o),s(f),s(m);u+=o*h}else for(d=0,p=a.length;d<p;d+=o)s(d)}function de(e){return p(qe.geometries[e],le)}function pe(e){return void 0!==e.build?e.build:e}function he(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=fe(n);break;case"link":t.links.push(ge(n))}}}function fe(e){for(var t,r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=me(n)}}return t}function me(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":var o=a(n.textContent);t.axis.fromArray(o);break;case"limits":var i=n.getElementsByTagName("max")[0],s=n.getElementsByTagName("min")[0];t.limits.max=parseFloat(i.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ge(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":t.attachments.push(ve(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ve(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"link":t.links.push(ge(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(ye(n))}}return t}function ye(e){var t={type:e.nodeName},r=a(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(r);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(r),t.angle=THREE.MathUtils.degToRad(r[3])}return t}function be(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];1===n.nodeType&&"technique_common"===n.nodeName&&we(n,t)}}function we(e,t){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"inertia":t.inertia=a(n.textContent);break;case"mass":t.mass=a(n.textContent)[0]}}}function Ee(e){for(var t={target:e.getAttribute("target").split("/").pop()},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType&&"axis"===n.nodeName){var a=n.getElementsByTagName("param")[0];t.axis=a.textContent;var o=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=o.substr(0,o.length-1)}}return t}function xe(e){return void 0!==e.build?e.build:e}function Te(e){for(var t=[],r=Be.querySelector('[id="'+e.id+'"]'),n=0;n<r.childNodes.length;n++){var o=r.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"matrix":var i=a(o.textContent),s=(new THREE.Matrix4).fromArray(i).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:s});break;case"translate":case"scale":i=a(o.textContent);var l=(new THREE.Vector3).fromArray(i);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l});break;case"rotate":i=a(o.textContent),l=(new THREE.Vector3).fromArray(i);var c=THREE.MathUtils.degToRad(i[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:l,angle:c})}}return t}var Ne=new THREE.Matrix4,Ae=new THREE.Vector3;function ke(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"node":t.nodes.push(n.getAttribute("id")),ke(n);break;case"instance_camera":t.instanceCameras.push(i(n.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Re(n));break;case"instance_light":t.instanceLights.push(i(n.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Re(n));break;case"instance_node":t.instanceNodes.push(i(n.getAttribute("url")));break;case"matrix":var o=a(n.textContent);t.matrix.multiply(Ne.fromArray(o).transpose()),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":o=a(n.textContent),Ae.fromArray(o),t.matrix.multiply(Ne.makeTranslation(Ae.x,Ae.y,Ae.z)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":o=a(n.textContent);var s=THREE.MathUtils.degToRad(o[3]);t.matrix.multiply(Ne.makeRotationAxis(Ae.fromArray(o),s)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":o=a(n.textContent),t.matrix.scale(Ae.fromArray(o)),t.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return Oe(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):qe.nodes[t.id]=t,t}function Re(e){for(var t={id:i(e.getAttribute("url")),materials:{},skeletons:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeName){case"bind_material":for(var a=n.getElementsByTagName("instance_material"),o=0;o<a.length;o++){var s=a[o],l=s.getAttribute("symbol"),c=s.getAttribute("target");t.materials[l]=i(c)}break;case"skeleton":t.skeletons.push(i(n.textContent))}}return t}function Ie(e,t){var r,n,a,o=[],i=[];for(r=0;r<e.length;r++){var s=e[r];if(Oe(s))Ce(Fe(s),t,o);else if(a=s,void 0!==qe.visualScenes[a])for(var l=qe.visualScenes[s].children,c=0;c<l.length;c++){var u=l[c];"JOINT"===u.type&&Ce(Fe(u.id),t,o)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(r=0;r<t.length;r++)for(c=0;c<o.length;c++)if((n=o[c]).bone.name===t[r].name){i[r]=n,n.processed=!0;break}for(r=0;r<o.length;r++)!1===(n=o[r]).processed&&(i.push(n),n.processed=!0);var d=[],p=[];for(r=0;r<i.length;r++)n=i[r],d.push(n.bone),p.push(n.boneInverse);return new THREE.Skeleton(d,p)}function Ce(e,t,r){e.traverse((function(e){if(!0===e.isBone){for(var n,a=0;a<t.length;a++){var o=t[a];if(o.name===e.name){n=o.boneInverse;break}}void 0===n&&(n=new THREE.Matrix4),r.push({bone:e,boneInverse:n,processed:!1})}}))}function Me(e){for(var t,r=[],n=e.matrix,a=e.nodes,o=e.type,i=e.instanceCameras,s=e.instanceControllers,l=e.instanceLights,c=e.instanceGeometries,u=e.instanceNodes,d=0,h=a.length;d<h;d++)r.push(Fe(a[d]));for(d=0,h=i.length;d<h;d++){var f=$(i[d]);null!==f&&r.push(f.clone())}for(d=0,h=s.length;d<h;d++)for(var m=s[d],g=(t=m.id,p(qe.controllers[t],L)),v=Se(de(g.id),m.materials),y=Ie(m.skeletons,g.skin.joints),b=0,w=v.length;b<w;b++){var E;(E=v[b]).isSkinnedMesh&&(E.bind(y,g.skin.bindMatrix),E.normalizeSkinWeights()),r.push(E)}for(d=0,h=l.length;d<h;d++){var x=ne(l[d]);null!==x&&r.push(x.clone())}for(d=0,h=c.length;d<h;d++)for(b=0,w=(v=Se(de((m=c[d]).id),m.materials)).length;b<w;b++)r.push(v[b]);for(d=0,h=u.length;d<h;d++)r.push(Fe(u[d]).clone());if(0===a.length&&1===r.length)E=r[0];else for(E="JOINT"===o?new THREE.Bone:new THREE.Group,d=0;d<r.length;d++)E.add(r[d]);return""===E.name&&(E.name="JOINT"===o?e.sid:e.name),E.matrix.copy(n),E.matrix.decompose(E.position,E.quaternion,E.scale),E}var Le=new THREE.MeshBasicMaterial({color:16711935});function De(e,t){for(var r=[],n=0,a=e.length;n<a;n++){var o=t[e[n]];void 0===o?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),r.push(Le)):r.push(K(o))}return r}function Se(e,t){var r=[];for(var n in e){var a=e[n],o=De(a.materialKeys,t);0===o.length&&("lines"===n||"linestrips"===n?o.push(new THREE.LineBasicMaterial):o.push(new THREE.MeshPhongMaterial));var i=void 0!==a.data.attributes.skinIndex;if(i)for(var s=0,l=o.length;s<l;s++)o[s].skinning=!0;var c,u=1===o.length?o[0]:o;switch(n){case"lines":c=new THREE.LineSegments(a.data,u);break;case"linestrips":c=new THREE.Line(a.data,u);break;case"triangles":case"polylist":c=i?new THREE.SkinnedMesh(a.data,u):new THREE.Mesh(a.data,u)}r.push(c)}return r}function Oe(e){return void 0!==qe.nodes[e]}function Fe(e){return p(qe.nodes[e],Me)}function Pe(e){var t=new THREE.Group;t.name=e.name;for(var r=e.children,n=0;n<r.length;n++){var a=r[n];t.add(Fe(a.id))}return t}function He(e){return p(qe.visualScenes[e],Pe)}if(0===e.length)return{scene:new THREE.Scene};var Be=r((new DOMParser).parseFromString(e,"application/xml"),"COLLADA")[0],je=Be.getAttribute("version");console.log("THREE.ColladaLoader: File version",je);var Ue,_e,Ve=(_e=r(Be,"asset")[0],{unit:l(r(_e,"unit")[0]),upAxis:c(r(_e,"up_axis")[0])}),Ge=new THREE.TextureLoader(this.manager);Ge.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),THREE.TGALoader&&(Ue=new THREE.TGALoader(this.manager)).setPath(this.resourcePath||t);var ze=[],We={},Xe=0,qe={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};u(Be,"library_animations","animation",(function(e){for(var t={sources:{},samplers:{},channels:{}},r=0,n=e.childNodes.length;r<n;r++){var a,o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"source":a=o.getAttribute("id"),t.sources[a]=ae(o);break;case"sampler":a=o.getAttribute("id"),t.samplers[a]=h(o);break;case"channel":a=o.getAttribute("target"),t.channels[a]=f(o);break;default:console.log(o)}}qe.animations[e.getAttribute("id")]=t})),u(Be,"library_animation_clips","animation_clip",(function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];1===a.nodeType&&"instance_animation"===a.nodeName&&t.animations.push(i(a.getAttribute("url")))}qe.clips[e.getAttribute("id")]=t})),u(Be,"library_controllers","controller",(function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"skin":t.id=i(a.getAttribute("source")),t.skin=I(a);break;case"morph":t.id=i(a.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}qe.controllers[e.getAttribute("id")]=t})),u(Be,"library_images","image",(function(e){var t={init_from:r(e,"init_from")[0].textContent};qe.images[e.getAttribute("id")]=t})),u(Be,"library_effects","effect",(function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];1===a.nodeType&&"profile_COMMON"===a.nodeName&&(t.profile=O(a))}qe.effects[e.getAttribute("id")]=t})),u(Be,"library_materials","material",(function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];1===a.nodeType&&"instance_effect"===a.nodeName&&(t.url=i(a.getAttribute("url")))}qe.materials[e.getAttribute("id")]=t})),u(Be,"library_cameras","camera",(function(e){for(var t={name:e.getAttribute("name")},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];1===a.nodeType&&"optics"===a.nodeName&&(t.optics=J(a))}qe.cameras[e.getAttribute("id")]=t})),u(Be,"library_lights","light",(function(e){for(var t={},r=0,n=e.childNodes.length;r<n;r++){var a=e.childNodes[r];1===a.nodeType&&"technique_common"===a.nodeName&&(t=ee(a))}qe.lights[e.getAttribute("id")]=t})),u(Be,"library_geometries","geometry",(function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=r(e,"mesh")[0];if(void 0!==n){for(var a=0;a<n.childNodes.length;a++){var o=n.childNodes[a];if(1===o.nodeType){var i=o.getAttribute("id");switch(o.nodeName){case"source":t.sources[i]=ae(o);break;case"vertices":t.vertices=oe(o);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ie(o));break;default:console.log(o)}}}qe.geometries[e.getAttribute("id")]=t}})),u(Be,"library_nodes","node",ke),u(Be,"library_visual_scenes","visual_scene",(function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),r=0;r<t.length;r++){var n=t[r];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+Xe++)}}(e);for(var n=r(e,"node"),a=0;a<n.length;a++)t.children.push(ke(n[a]));qe.visualScenes[e.getAttribute("id")]=t})),u(Be,"library_kinematics_models","kinematics_model",(function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];1===n.nodeType&&"technique_common"===n.nodeName&&he(n,t)}qe.kinematicsModels[e.getAttribute("id")]=t})),u(Be,"library_physics_models","physics_model",(function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];1===n.nodeType&&"rigid_body"===n.nodeName&&(t.rigidBodies[n.getAttribute("name")]={},be(n,t.rigidBodies[n.getAttribute("name")]))}qe.physicsModels[e.getAttribute("id")]=t})),u(Be,"scene","instance_kinematics_scene",(function(e){for(var t={bindJointAxis:[]},r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];1===n.nodeType&&"bind_joint_axis"===n.nodeName&&t.bindJointAxis.push(Ee(n))}qe.kinematicsScenes[i(e.getAttribute("url"))]=t})),d(qe.animations,m),d(qe.clips,k),d(qe.controllers,L),d(qe.images,D),d(qe.effects,X),d(qe.materials,q),d(qe.cameras,Y),d(qe.lights,re),d(qe.geometries,le),d(qe.visualScenes,Pe),function(){var e=qe.clips;if(!0===s(e)){if(!1===s(qe.animations)){var t=[];for(var r in qe.animations)for(var n=g(r),a=0,o=n.length;a<o;a++)t.push(n[a]);ze.push(new THREE.AnimationClip("default",-1,t))}}else for(var r in e)ze.push(R(r))}(),function(){var e=Object.keys(qe.kinematicsModels)[0],t=Object.keys(qe.kinematicsScenes)[0],r=Object.keys(qe.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var n,a=(n=e,p(qe.kinematicsModels[n],pe)),o=function(e){return p(qe.kinematicsScenes[e],xe)}(t),i=He(r),s=o.bindJointAxis,l={},c=0,u=s.length;c<u;c++){var d=s[c],h=Be.querySelector('[sid="'+d.target+'"]');if(h){var f=h.parentElement;g(d.jointIndex,f)}}var m=new THREE.Matrix4;We={joints:a&&a.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var r=l[e];if(r){var n=r.joint;if(t>n.limits.max||t<n.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var a=r.object,o=n.axis,i=r.transforms;Ne.identity();for(var s=0;s<i.length;s++){var c=i[s];if(c.sid&&-1!==c.sid.indexOf(e))switch(n.type){case"revolute":Ne.multiply(m.makeRotationAxis(o,THREE.MathUtils.degToRad(t)));break;case"prismatic":Ne.multiply(m.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+n.type)}else switch(c.type){case"matrix":Ne.multiply(c.obj);break;case"translate":Ne.multiply(m.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":Ne.scale(c.obj);break;case"rotate":Ne.multiply(m.makeRotationAxis(c.obj,c.angle))}}a.matrix.copy(Ne),a.matrix.decompose(a.position,a.quaternion,a.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function g(e,t){var r=t.getAttribute("name"),n=a.joints[e];i.traverse((function(a){a.name===r&&(l[e]={object:a,transforms:Te(t),joint:n,position:n.zeroPosition})}))}}();var Ke=function(e){return He(i(r(e,"instance_visual_scene")[0].getAttribute("url")))}(r(Be,"scene")[0]);return"Z_UP"===Ve.upAxis&&Ke.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),Ke.scale.multiplyScalar(Ve.unit),{animations:ze,kinematics:We,library:qe,scene:Ke}}}},416:e=>{function t(e){const t=document.getElementById(e),r=t.parentNode;try{r&&r.removeChild(t)}catch(e){}}e.exports=function(e){return e=e||{},function(r,n){return function(e,r,n){return new n((function(n,a){const o=r.timeout||5e3,i="script_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),s=function(e,t){var r=document.createElement("script");return r.type="text/javascript",r.async=!0,r.id=t,r.src=e,r}(e,i),l=setTimeout((function(){a(new Error("Script request to "+e+" timed out")),t(i)}),o),c=function(e){clearTimeout(e)};s.addEventListener("load",(function(e){n({ok:!0}),c(l),t(i)})),s.addEventListener("error",(function(r){a(new Error("Script request to "+e+" failed "+r)),c(l),t(i)})),function(e){const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(s)}))}(r,n=n||{},e.Promise||Promise)}}},422:e=>{const t={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};function r(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}e.exports=AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},useRegExp:{default:!1},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(t)},repetitions:{default:1/0,min:0},timeScale:{default:1},startAt:{default:0}},init:function(){this.model=null,this.mixer=null,this.activeActions=[];const e=this.el.getObject3D("mesh");e?this.load(e):this.el.addEventListener("model-loaded",(e=>{this.load(e.detail.model)}))},load:function(e){const t=this.el;this.model=e,this.mixer=new THREE.AnimationMixer(e),this.mixer.addEventListener("loop",(e=>{t.emit("animation-loop",{action:e.action,loopDelta:e.loopDelta})})),this.mixer.addEventListener("finished",(e=>{t.emit("animation-finished",{action:e.action,direction:e.direction})})),this.data.clip&&this.update({})},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(e){if(!e)return;const r=this.data,n=AFRAME.utils.diff(r,e);if("clip"in n)return this.stopAction(),void(r.clip&&this.playAction());this.activeActions.forEach((e=>{"duration"in n&&r.duration&&e.setDuration(r.duration),"clampWhenFinished"in n&&(e.clampWhenFinished=r.clampWhenFinished),("loop"in n||"repetitions"in n)&&e.setLoop(t[r.loop],r.repetitions),"timeScale"in n&&e.setEffectiveTimeScale(r.timeScale)}))},stopAction:function(){const e=this.data;for(let t=0;t<this.activeActions.length;t++)e.crossFadeDuration?this.activeActions[t].fadeOut(e.crossFadeDuration):this.activeActions[t].stop();this.activeActions.length=0},playAction:function(){if(!this.mixer)return;const e=this.model,n=this.data,a=e.animations||(e.geometry||{}).animations||[];if(!a.length)return;const o=n.useRegExp?n.clip:(i=n.clip,new RegExp("^"+i.split(/\*+/).map(r).join(".*")+"$"));var i;for(let r,i=0;r=a[i];i++)if(r.name.match(o)){const a=this.mixer.clipAction(r,e);a.enabled=!0,a.clampWhenFinished=n.clampWhenFinished,n.duration&&a.setDuration(n.duration),1!==n.timeScale&&a.setEffectiveTimeScale(n.timeScale),a.startAt(this.mixer.time-n.startAt/1e3),a.setLoop(t[n.loop],n.repetitions).fadeIn(n.crossFadeDuration).play(),this.activeActions.push(a)}},tick:function(e,t){this.mixer&&!isNaN(t)&&this.mixer.update(t/1e3)}})},944:(e,t,r)=>{THREE.ColladaLoader=r(883),e.exports.Component=AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var e=this,t=this.el,r=this.data,n=this.el.sceneEl.systems.renderer;r&&(this.remove(),this.loader.load(r,(function(r){e.model=r.scene,e.model.traverse((function(e){if(e.isMesh){var t=e.material;t.color&&n.applyColorCorrection(t.color),t.map&&n.applyColorCorrection(t.map),t.emissive&&n.applyColorCorrection(t.emissive),t.emissiveMap&&n.applyColorCorrection(t.emissiveMap)}})),t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"collada",model:e.model})})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},631:(e,t,r)=>{"use strict";r.r(t);var n=r(824),a=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};try{URL.revokeObjectURL(a(""))}catch(e){a=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var o=Uint8Array,i=Uint16Array,s=Uint32Array,l=new o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),c=new o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),u=new o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=function(e,t){for(var r=new i(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var a=new s(r[30]);for(n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)a[o]=o-r[n]<<5|n;return[r,a]},p=d(l,2),h=p[0],f=p[1];h[28]=258,f[258]=28;for(var m=d(c,0),g=m[0],v=(m[1],new i(32768)),y=0;y<32768;++y){var b=(43690&y)>>>1|(21845&y)<<1;b=(61680&(b=(52428&b)>>>2|(13107&b)<<2))>>>4|(3855&b)<<4,v[y]=((65280&b)>>>8|(255&b)<<8)>>>1}var w=function(e,t,r){for(var n=e.length,a=0,o=new i(t);a<n;++a)++o[e[a]-1];var s,l=new i(t);for(a=0;a<t;++a)l[a]=l[a-1]+o[a-1]<<1;if(r){s=new i(1<<t);var c=15-t;for(a=0;a<n;++a)if(e[a])for(var u=a<<4|e[a],d=t-e[a],p=l[e[a]-1]++<<d,h=p|(1<<d)-1;p<=h;++p)s[v[p]>>>c]=u}else for(s=new i(n),a=0;a<n;++a)e[a]&&(s[a]=v[l[e[a]-1]++]>>>15-e[a]);return s},E=new o(288);for(y=0;y<144;++y)E[y]=8;for(y=144;y<256;++y)E[y]=9;for(y=256;y<280;++y)E[y]=7;for(y=280;y<288;++y)E[y]=8;var x=new o(32);for(y=0;y<32;++y)x[y]=5;var T=w(E,9,1),N=w(x,5,1),A=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},k=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},R=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},I=function(e,t,r){var n=e.length;if(!n||r&&!r.l&&n<5)return t||new o(0);var a=!t||r,d=!r||r.i;r||(r={}),t||(t=new o(3*n));var p,f=function(e){var r=t.length;if(e>r){var n=new o(Math.max(2*r,e));n.set(t),t=n}},m=r.f||0,v=r.p||0,y=r.b||0,b=r.l,E=r.d,x=r.m,I=r.n,C=8*n;do{if(!b){r.f=m=k(e,v,1);var M=k(e,v+1,3);if(v+=3,!M){var L=e[(p=v,(V=(p/8|0)+(7&p&&1)+4)-4)]|e[V-3]<<8,D=V+L;if(D>n){if(d)throw"unexpected EOF";break}a&&f(y+L),t.set(e.subarray(V,D),y),r.b=y+=L,r.p=v=8*D;continue}if(1==M)b=T,E=N,x=9,I=5;else{if(2!=M)throw"invalid block type";var S=k(e,v,31)+257,O=k(e,v+10,15)+4,F=S+k(e,v+5,31)+1;v+=14;for(var P=new o(F),H=new o(19),B=0;B<O;++B)H[u[B]]=k(e,v+3*B,7);v+=3*O;var j=A(H),U=(1<<j)-1,_=w(H,j,1);for(B=0;B<F;){var V,G=_[k(e,v,U)];if(v+=15&G,(V=G>>>4)<16)P[B++]=V;else{var z=0,W=0;for(16==V?(W=3+k(e,v,3),v+=2,z=P[B-1]):17==V?(W=3+k(e,v,7),v+=3):18==V&&(W=11+k(e,v,127),v+=7);W--;)P[B++]=z}}var X=P.subarray(0,S),q=P.subarray(S);x=A(X),I=A(q),b=w(X,x,1),E=w(q,I,1)}if(v>C){if(d)throw"unexpected EOF";break}}a&&f(y+131072);for(var K=(1<<x)-1,J=(1<<I)-1,Q=v;;Q=v){var Z=(z=b[R(e,v)&K])>>>4;if((v+=15&z)>C){if(d)throw"unexpected EOF";break}if(!z)throw"invalid length/literal";if(Z<256)t[y++]=Z;else{if(256==Z){Q=v,b=null;break}var Y=Z-254;if(Z>264){var $=l[B=Z-257];Y=k(e,v,(1<<$)-1)+h[B],v+=$}var ee=E[R(e,v)&J],te=ee>>>4;if(!ee)throw"invalid distance";if(v+=15&ee,q=g[te],te>3&&($=c[te],q+=R(e,v)&(1<<$)-1,v+=$),v>C){if(d)throw"unexpected EOF";break}a&&f(y+131072);for(var re=y+Y;y<re;y+=4)t[y]=t[y-q],t[y+1]=t[y+1-q],t[y+2]=t[y+2-q],t[y+3]=t[y+3-q];y=re}}r.l=b,r.p=Q,r.b=y,b&&(m=1,r.m=x,r.d=E,r.n=I)}while(!m);return y==t.length?t:function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var n=new(e instanceof i?i:e instanceof s?s:o)(r-t);return n.set(e.subarray(t,r)),n}(t,0,y)},C=new o(0);var M="undefined"!=typeof TextDecoder&&new TextDecoder;try{M.decode(C,{stream:!0})}catch(e){}function L(e,t,r){const n=r.length-e-1;if(t>=r[n])return n-1;if(t<=r[e])return e;let a=e,o=n,i=Math.floor((a+o)/2);for(;t<r[i]||t>=r[i+1];)t<r[i]?o=i:a=i,i=Math.floor((a+o)/2);return i}function D(e,t){let r=1;for(let t=2;t<=e;++t)r*=t;let n=1;for(let e=2;e<=t;++e)n*=e;for(let r=2;r<=e-t;++r)n*=r;return r/n}class S extends n.Curve{constructor(e,t,r,a,o){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=a||0,this.endKnot=o||this.knots.length-1;for(let e=0;e<r.length;++e){const t=r[e];this.controlPoints[e]=new n.Vector4(t.x,t.y,t.z,t.w)}}getPoint(e,t=new n.Vector3){const r=t,a=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),o=function(e,t,r,a){const o=L(e,a,t),i=function(e,t,r,n){const a=[],o=[],i=[];a[0]=1;for(let s=1;s<=r;++s){o[s]=t-n[e+1-s],i[s]=n[e+s]-t;let r=0;for(let e=0;e<s;++e){const t=i[e+1],n=o[s-e],l=a[e]/(t+n);a[e]=r+t*l,r=n*l}a[s]=r}return a}(o,a,e,t),s=new n.Vector4(0,0,0,0);for(let t=0;t<=e;++t){const n=r[o-e+t],a=i[t],l=n.w*a;s.x+=n.x*l,s.y+=n.y*l,s.z+=n.z*l,s.w+=n.w*a}return s}(this.degree,this.knots,this.controlPoints,a);return 1!==o.w&&o.divideScalar(o.w),r.set(o.x,o.y,o.z)}getTangent(e,t=new n.Vector3){const r=t,a=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),o=function(e,t,r,a,o){const i=function(e,t,r,a,o){const i=o<e?o:e,s=[],l=L(e,a,t),c=function(e,t,r,n,a){const o=[];for(let e=0;e<=r;++e)o[e]=0;const i=[];for(let e=0;e<=n;++e)i[e]=o.slice(0);const s=[];for(let e=0;e<=r;++e)s[e]=o.slice(0);s[0][0]=1;const l=o.slice(0),c=o.slice(0);for(let n=1;n<=r;++n){l[n]=t-a[e+1-n],c[n]=a[e+n]-t;let r=0;for(let e=0;e<n;++e){const t=c[e+1],a=l[n-e];s[n][e]=t+a;const o=s[e][n-1]/s[n][e];s[e][n]=r+t*o,r=a*o}s[n][n]=r}for(let e=0;e<=r;++e)i[0][e]=s[e][r];for(let e=0;e<=r;++e){let t=0,a=1;const l=[];for(let e=0;e<=r;++e)l[e]=o.slice(0);l[0][0]=1;for(let o=1;o<=n;++o){let n=0;const c=e-o,u=r-o;e>=o&&(l[a][0]=l[t][0]/s[u+1][c],n=l[a][0]*s[c][u]);const d=e-1<=u?o-1:r-e;for(let e=c>=-1?1:-c;e<=d;++e)l[a][e]=(l[t][e]-l[t][e-1])/s[u+1][c+e],n+=l[a][e]*s[c+e][u];e<=u&&(l[a][o]=-l[t][o-1]/s[u+1][e],n+=l[a][o]*s[e][u]),i[o][e]=n;const p=t;t=a,a=p}}let u=r;for(let e=1;e<=n;++e){for(let t=0;t<=r;++t)i[e][t]*=u;u*=r-e}return i}(l,a,e,i,t),u=[];for(let e=0;e<r.length;++e){const t=r[e].clone(),n=t.w;t.x*=n,t.y*=n,t.z*=n,u[e]=t}for(let t=0;t<=i;++t){const r=u[l-e].clone().multiplyScalar(c[t][0]);for(let n=1;n<=e;++n)r.add(u[l-e+n].clone().multiplyScalar(c[t][n]));s[t]=r}for(let e=i+1;e<=o+1;++e)s[e]=new n.Vector4(0,0,0);return s}(e,t,r,a,o);return function(e){const t=e.length,r=[],a=[];for(let o=0;o<t;++o){const t=e[o];r[o]=new n.Vector3(t.x,t.y,t.z),a[o]=t.w}const o=[];for(let e=0;e<t;++e){const t=r[e].clone();for(let r=1;r<=e;++r)t.sub(o[e-r].clone().multiplyScalar(D(e,r)*a[r]));o[e]=t.divideScalar(a[0])}return o}(i)}(this.degree,this.knots,this.controlPoints,a,1);return r.copy(o[1]).normalize(),r}}let O,F,P;class H extends n.Loader{constructor(e){super(e)}load(e,t,r,a){const o=this,i=""===o.path?n.LoaderUtils.extractUrlBase(e):o.path,s=new n.FileLoader(this.manager);s.setPath(o.path),s.setResponseType("arraybuffer"),s.setRequestHeader(o.requestHeader),s.setWithCredentials(o.withCredentials),s.load(e,(function(r){try{t(o.parse(r,i))}catch(t){a?a(t):console.error(t),o.manager.itemError(e)}}),r,a)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=21&&t===ee(e,0,21)}(e))O=(new V).parse(e);else{const t=ee(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let r=0;function n(t){const n=e[t-1];return e=e.slice(r+t),r++,n}for(let e=0;e<t.length;++e)if(n(1)===t[e])return!1;return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(W(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+W(t));O=(new _).parse(t)}const r=new n.TextureLoader(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new B(r,this.manager).parse(O)}}class B{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){F=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),n=this.parseDeformers(),a=(new j).parse(n);return this.parseScene(n,a,r),P}parseConnections(){const e=new Map;return"Connections"in O&&O.Connections.connections.forEach((function(t){const r=t[0],n=t[1],a=t[2];e.has(r)||e.set(r,{parents:[],children:[]});const o={ID:n,relationship:a};e.get(r).parents.push(o),e.has(n)||e.set(n,{parents:[],children:[]});const i={ID:r,relationship:a};e.get(n).children.push(i)})),e}parseImages(){const e={},t={};if("Video"in O.Objects){const r=O.Objects.Video;for(const n in r){const a=r[n];if(e[parseInt(n)]=a.RelativeFilename||a.Filename,"Content"in a){const e=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,o="string"==typeof a.Content&&""!==a.Content;if(e||o){const e=this.parseImage(r[n]);t[a.RelativeFilename||a.Filename]=e}}}}for(const r in e){const n=e[r];void 0!==t[n]?e[r]=t[n]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){const t=e.Content,r=e.RelativeFilename||e.Filename,n=r.slice(r.lastIndexOf(".")+1).toLowerCase();let a;switch(n){case"bmp":a="image/bmp";break;case"jpg":case"jpeg":a="image/jpeg";break;case"png":a="image/png";break;case"tif":a="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),a="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+n+'" is not supported.')}if("string"==typeof t)return"data:"+a+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:a}))}}parseTextures(e){const t=new Map;if("Texture"in O.Objects){const r=O.Objects.Texture;for(const n in r){const a=this.parseTexture(r[n],e);t.set(parseInt(n),a)}}return t}parseTexture(e,t){const r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;const a=e.WrapModeU,o=e.WrapModeV,i=void 0!==a?a.value:0,s=void 0!==o?o.value:0;if(r.wrapS=0===i?n.RepeatWrapping:n.ClampToEdgeWrapping,r.wrapT=0===s?n.RepeatWrapping:n.ClampToEdgeWrapping,"Scaling"in e){const t=e.Scaling.value;r.repeat.x=t[0],r.repeat.y=t[1]}if("Translation"in e){const t=e.Translation.value;r.offset.x=t[0],r.offset.y=t[1]}return r}loadTexture(e,t){let r;const a=this.textureLoader.path,o=F.get(e.id).children;let i;void 0!==o&&o.length>0&&void 0!==t[o[0].ID]&&(r=t[o[0].ID],0!==r.indexOf("blob:")&&0!==r.indexOf("data:")||this.textureLoader.setPath(void 0));const s=e.FileName.slice(-3).toLowerCase();if("tga"===s){const t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),i=new n.Texture):(t.setPath(this.textureLoader.path),i=t.load(r))}else if("dds"===s){const t=this.manager.getHandler(".dds");null===t?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),i=new n.Texture):(t.setPath(this.textureLoader.path),i=t.load(r))}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),i=new n.Texture):i=this.textureLoader.load(r);return this.textureLoader.setPath(a),i}parseMaterials(e){const t=new Map;if("Material"in O.Objects){const r=O.Objects.Material;for(const n in r){const a=this.parseMaterial(r[n],e);null!==a&&t.set(parseInt(n),a)}}return t}parseMaterial(e,t){const r=e.id,a=e.attrName;let o=e.ShadingModel;if("object"==typeof o&&(o=o.value),!F.has(r))return null;const i=this.parseParameters(e,t,r);let s;switch(o.toLowerCase()){case"phong":s=new n.MeshPhongMaterial;break;case"lambert":s=new n.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),s=new n.MeshPhongMaterial}return s.setValues(i),s.name=a,s}parseParameters(e,t,r){const a={};e.BumpFactor&&(a.bumpScale=e.BumpFactor.value),e.Diffuse?a.color=(new n.Color).fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(a.color=(new n.Color).fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(a.displacementScale=e.DisplacementFactor.value),e.Emissive?a.emissive=(new n.Color).fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(a.emissive=(new n.Color).fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(a.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(a.opacity=parseFloat(e.Opacity.value)),a.opacity<1&&(a.transparent=!0),e.ReflectionFactor&&(a.reflectivity=e.ReflectionFactor.value),e.Shininess&&(a.shininess=e.Shininess.value),e.Specular?a.specular=(new n.Color).fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&"Color"===e.SpecularColor.type&&(a.specular=(new n.Color).fromArray(e.SpecularColor.value).convertSRGBToLinear());const o=this;return F.get(r).children.forEach((function(e){const r=e.relationship;switch(r){case"Bump":a.bumpMap=o.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":a.aoMap=o.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":a.map=o.getTexture(t,e.ID),void 0!==a.map&&(a.map.colorSpace=n.SRGBColorSpace);break;case"DisplacementColor":a.displacementMap=o.getTexture(t,e.ID);break;case"EmissiveColor":a.emissiveMap=o.getTexture(t,e.ID),void 0!==a.emissiveMap&&(a.emissiveMap.colorSpace=n.SRGBColorSpace);break;case"NormalMap":case"Maya|TEX_normal_map":a.normalMap=o.getTexture(t,e.ID);break;case"ReflectionColor":a.envMap=o.getTexture(t,e.ID),void 0!==a.envMap&&(a.envMap.mapping=n.EquirectangularReflectionMapping,a.envMap.colorSpace=n.SRGBColorSpace);break;case"SpecularColor":a.specularMap=o.getTexture(t,e.ID),void 0!==a.specularMap&&(a.specularMap.colorSpace=n.SRGBColorSpace);break;case"TransparentColor":case"TransparencyFactor":a.alphaMap=o.getTexture(t,e.ID),a.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r)}})),a}getTexture(e,t){return"LayeredTexture"in O.Objects&&t in O.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=F.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in O.Objects){const r=O.Objects.Deformer;for(const n in r){const a=r[n],o=F.get(parseInt(n));if("Skin"===a.attrType){const t=this.parseSkeleton(o,r);t.ID=n,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=o.parents[0].ID,e[n]=t}else if("BlendShape"===a.attrType){const e={id:n};e.rawTargets=this.parseMorphTargets(o,r),e.id=n,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const r=[];return e.children.forEach((function(e){const a=t[e.ID];if("Cluster"!==a.attrType)return;const o={ID:e.ID,indices:[],weights:[],transformLink:(new n.Matrix4).fromArray(a.TransformLink.a)};"Indexes"in a&&(o.indices=a.Indexes.a,o.weights=a.Weights.a),r.push(o)})),{rawBones:r,bones:[]}}parseMorphTargets(e,t){const r=[];for(let n=0;n<e.children.length;n++){const a=e.children[n],o=t[a.ID],i={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;i.geoID=F.get(parseInt(a.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,r.push(i)}return r}parseScene(e,t,r){P=new n.Group;const a=this.parseModels(e.skeletons,t,r),o=O.Objects.Model,i=this;a.forEach((function(e){const t=o[e.ID];i.setLookAtProperties(e,t),F.get(e.ID).parents.forEach((function(t){const r=a.get(t.ID);void 0!==r&&r.add(e)})),null===e.parent&&P.add(e)})),this.bindSkeleton(e.skeletons,t,a),this.addGlobalSceneSettings(),P.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=Z(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const s=(new U).parse();1===P.children.length&&P.children[0].isGroup&&(P.children[0].animations=s,P=P.children[0]),P.animations=s}parseModels(e,t,r){const a=new Map,o=O.Objects.Model;for(const i in o){const s=parseInt(i),l=o[i],c=F.get(s);let u=this.buildSkeleton(c,e,s,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,t,r);break;case"NurbsCurve":u=this.createCurve(c,t);break;case"LimbNode":case"Root":u=new n.Bone;break;default:u=new n.Group}u.name=l.attrName?n.PropertyBinding.sanitizeNodeName(l.attrName):"",u.userData.originalName=l.attrName,u.ID=s}this.getTransformData(u,l),a.set(s,u)}return a}buildSkeleton(e,t,r,a){let o=null;return e.parents.forEach((function(e){for(const i in t){const s=t[i];s.rawBones.forEach((function(t,i){if(t.ID===e.ID){const e=o;o=new n.Bone,o.matrixWorld.copy(t.transformLink),o.name=a?n.PropertyBinding.sanitizeNodeName(a):"",o.userData.originalName=a,o.ID=r,s.bones[i]=o,null!==e&&o.add(e)}}))}})),o}createCamera(e){let t,r;if(e.children.forEach((function(e){const t=O.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)})),void 0===r)t=new n.Object3D;else{let e=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(e=1);let a=1;void 0!==r.NearPlane&&(a=r.NearPlane.value/1e3);let o=1e3;void 0!==r.FarPlane&&(o=r.FarPlane.value/1e3);let i=window.innerWidth,s=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(i=r.AspectWidth.value,s=r.AspectHeight.value);const l=i/s;let c=45;void 0!==r.FieldOfView&&(c=r.FieldOfView.value);const u=r.FocalLength?r.FocalLength.value:null;switch(e){case 0:t=new n.PerspectiveCamera(c,l,a,o),null!==u&&t.setFocalLength(u);break;case 1:t=new n.OrthographicCamera(-i/2,i/2,s/2,-s/2,a,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new n.Object3D}}return t}createLight(e){let t,r;if(e.children.forEach((function(e){const t=O.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)})),void 0===r)t=new n.Object3D;else{let e;e=void 0===r.LightType?0:r.LightType.value;let a=16777215;void 0!==r.Color&&(a=(new n.Color).fromArray(r.Color.value).convertSRGBToLinear());let o=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(o=0);let i=0;void 0!==r.FarAttenuationEnd&&(i=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value);const s=1;switch(e){case 0:t=new n.PointLight(a,o,i,s);break;case 1:t=new n.DirectionalLight(a,o);break;case 2:let e=Math.PI/3;void 0!==r.InnerAngle&&(e=n.MathUtils.degToRad(r.InnerAngle.value));let l=0;void 0!==r.OuterAngle&&(l=n.MathUtils.degToRad(r.OuterAngle.value),l=Math.max(l,1)),t=new n.SpotLight(a,o,i,e,l,s);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),t=new n.PointLight(a,o)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,r){let a,o=null,i=null;const s=[];return e.children.forEach((function(e){t.has(e.ID)&&(o=t.get(e.ID)),r.has(e.ID)&&s.push(r.get(e.ID))})),s.length>1?i=s:s.length>0?i=s[0]:(i=new n.MeshPhongMaterial({name:n.Loader.DEFAULT_MATERIAL_NAME,color:13421772}),s.push(i)),"color"in o.attributes&&s.forEach((function(e){e.vertexColors=!0})),o.FBX_Deformer?(a=new n.SkinnedMesh(o,i),a.normalizeSkinWeights()):a=new n.Mesh(o,i),a}createCurve(e,t){const r=e.children.reduce((function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e}),null),a=new n.LineBasicMaterial({name:n.Loader.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new n.Line(r,a)}getTransformData(e,t){const r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?Y(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,t){"LookAtProperty"in t&&F.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){const r=O.Objects.Model[t.ID];if("Lcl_Translation"in r){const t=r.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),P.add(e.target)):e.lookAt((new n.Vector3).fromArray(t))}}}))}bindSkeleton(e,t,r){const a=this.parsePoseNodes();for(const o in e){const i=e[o];F.get(parseInt(i.ID)).parents.forEach((function(e){if(t.has(e.ID)){const t=e.ID;F.get(t).parents.forEach((function(e){r.has(e.ID)&&r.get(e.ID).bind(new n.Skeleton(i.bones),a[e.ID])}))}}))}}parsePoseNodes(){const e={};if("Pose"in O.Objects){const t=O.Objects.Pose;for(const r in t)if("BindPose"===t[r].attrType&&t[r].NbPoseNodes>0){const a=t[r].PoseNode;Array.isArray(a)?a.forEach((function(t){e[t.Node]=(new n.Matrix4).fromArray(t.Matrix.a)})):e[a.Node]=(new n.Matrix4).fromArray(a.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in O){if("AmbientColor"in O.GlobalSettings){const e=O.GlobalSettings.AmbientColor.value,t=e[0],r=e[1],a=e[2];if(0!==t||0!==r||0!==a){const e=new n.Color(t,r,a).convertSRGBToLinear();P.add(new n.AmbientLight(e,1))}}"UnitScaleFactor"in O.GlobalSettings&&(P.userData.unitScaleFactor=O.GlobalSettings.UnitScaleFactor.value)}}}class j{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in O.Objects){const r=O.Objects.Geometry;for(const n in r){const a=F.get(parseInt(n)),o=this.parseGeometry(a,r[n],e);t.set(parseInt(n),o)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){const n=r.skeletons,a=[],o=e.parents.map((function(e){return O.Objects.Model[e.ID]}));if(0===o.length)return;const i=e.children.reduce((function(e,t){return void 0!==n[t.ID]&&(e=n[t.ID]),e}),null);e.children.forEach((function(e){void 0!==r.morphTargets[e.ID]&&a.push(r.morphTargets[e.ID])}));const s=o[0],l={};"RotationOrder"in s&&(l.eulerOrder=Y(s.RotationOrder.value)),"InheritType"in s&&(l.inheritType=parseInt(s.InheritType.value)),"GeometricTranslation"in s&&(l.translation=s.GeometricTranslation.value),"GeometricRotation"in s&&(l.rotation=s.GeometricRotation.value),"GeometricScaling"in s&&(l.scale=s.GeometricScaling.value);const c=Z(l);return this.genGeometry(t,i,a,c)}genGeometry(e,t,r,a){const o=new n.BufferGeometry;e.attrName&&(o.name=e.attrName);const i=this.parseGeoNode(e,t),s=this.genBuffers(i),l=new n.Float32BufferAttribute(s.vertex,3);if(l.applyMatrix4(a),o.setAttribute("position",l),s.colors.length>0&&o.setAttribute("color",new n.Float32BufferAttribute(s.colors,3)),t&&(o.setAttribute("skinIndex",new n.Uint16BufferAttribute(s.weightsIndices,4)),o.setAttribute("skinWeight",new n.Float32BufferAttribute(s.vertexWeights,4)),o.FBX_Deformer=t),s.normal.length>0){const e=(new n.Matrix3).getNormalMatrix(a),t=new n.Float32BufferAttribute(s.normal,3);t.applyNormalMatrix(e),o.setAttribute("normal",t)}if(s.uvs.forEach((function(e,t){const r=0===t?"uv":`uv${t}`;o.setAttribute(r,new n.Float32BufferAttribute(s.uvs[t],2))})),i.material&&"AllSame"!==i.material.mappingType){let e=s.materialIndex[0],t=0;if(s.materialIndex.forEach((function(r,n){r!==e&&(o.addGroup(t,n-t,e),e=r,t=n)})),o.groups.length>0){const t=o.groups[o.groups.length-1],r=t.start+t.count;r!==s.materialIndex.length&&o.addGroup(r,s.materialIndex.length-r,e)}0===o.groups.length&&o.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(o,e,r,a),o}parseGeoNode(e,t){const r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(n,a){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[a]})}))}))),r}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,n=0,a=!1,o=[],i=[],s=[],l=[],c=[],u=[];const d=this;return e.vertexIndices.forEach((function(p,h){let f,m=!1;p<0&&(p^=-1,m=!0);let g=[],v=[];if(o.push(3*p,3*p+1,3*p+2),e.color){const t=K(h,r,p,e.color);s.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[p]&&e.weightTable[p].forEach((function(e){v.push(e.weight),g.push(e.id)})),v.length>4){a||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),a=!0);const e=[0,0,0,0],t=[0,0,0,0];v.forEach((function(r,n){let a=r,o=g[n];t.forEach((function(t,r,n){if(a>t){n[r]=a,a=t;const i=e[r];e[r]=o,o=i}}))})),g=e,v=t}for(;v.length<4;)v.push(0),g.push(0);for(let e=0;e<4;++e)c.push(v[e]),u.push(g[e])}if(e.normal){const t=K(h,r,p,e.normal);i.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=K(h,r,p,e.material)[0],f<0&&(d.negativeMaterialIndices=!0,f=0)),e.uv&&e.uv.forEach((function(e,t){const n=K(h,r,p,e);void 0===l[t]&&(l[t]=[]),l[t].push(n[0]),l[t].push(n[1])})),n++,m&&(d.genFace(t,e,o,f,i,s,l,c,u,n),r++,n=0,o=[],i=[],s=[],l=[],c=[],u=[])})),t}getNormalNewell(e){const t=new n.Vector3(0,0,0);for(let r=0;r<e.length;r++){const n=e[r],a=e[(r+1)%e.length];t.x+=(n.y-a.y)*(n.z+a.z),t.y+=(n.z-a.z)*(n.x+a.x),t.z+=(n.x-a.x)*(n.y+a.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),r=(Math.abs(t.z)>.5?new n.Vector3(0,1,0):new n.Vector3(0,0,1)).cross(t).normalize(),a=t.clone().cross(r).normalize();return{normal:t,tangent:r,bitangent:a}}flattenVertex(e,t,r){return new n.Vector2(e.dot(t),e.dot(r))}genFace(e,t,r,a,o,i,s,l,c,u){let d;if(u>3){const e=[];for(let a=0;a<r.length;a+=3)e.push(new n.Vector3(t.vertexPositions[r[a]],t.vertexPositions[r[a+1]],t.vertexPositions[r[a+2]]));const{tangent:a,bitangent:o}=this.getNormalTangentAndBitangent(e),i=[];for(const t of e)i.push(this.flattenVertex(t,a,o));d=n.ShapeUtils.triangulateShape(i,[])}else d=[[0,1,2]];for(const[n,u,p]of d)e.vertex.push(t.vertexPositions[r[3*n]]),e.vertex.push(t.vertexPositions[r[3*n+1]]),e.vertex.push(t.vertexPositions[r[3*n+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),e.vertex.push(t.vertexPositions[r[3*p]]),e.vertex.push(t.vertexPositions[r[3*p+1]]),e.vertex.push(t.vertexPositions[r[3*p+2]]),t.skeleton&&(e.vertexWeights.push(l[4*n]),e.vertexWeights.push(l[4*n+1]),e.vertexWeights.push(l[4*n+2]),e.vertexWeights.push(l[4*n+3]),e.vertexWeights.push(l[4*u]),e.vertexWeights.push(l[4*u+1]),e.vertexWeights.push(l[4*u+2]),e.vertexWeights.push(l[4*u+3]),e.vertexWeights.push(l[4*p]),e.vertexWeights.push(l[4*p+1]),e.vertexWeights.push(l[4*p+2]),e.vertexWeights.push(l[4*p+3]),e.weightsIndices.push(c[4*n]),e.weightsIndices.push(c[4*n+1]),e.weightsIndices.push(c[4*n+2]),e.weightsIndices.push(c[4*n+3]),e.weightsIndices.push(c[4*u]),e.weightsIndices.push(c[4*u+1]),e.weightsIndices.push(c[4*u+2]),e.weightsIndices.push(c[4*u+3]),e.weightsIndices.push(c[4*p]),e.weightsIndices.push(c[4*p+1]),e.weightsIndices.push(c[4*p+2]),e.weightsIndices.push(c[4*p+3])),t.color&&(e.colors.push(i[3*n]),e.colors.push(i[3*n+1]),e.colors.push(i[3*n+2]),e.colors.push(i[3*u]),e.colors.push(i[3*u+1]),e.colors.push(i[3*u+2]),e.colors.push(i[3*p]),e.colors.push(i[3*p+1]),e.colors.push(i[3*p+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(a),e.materialIndex.push(a),e.materialIndex.push(a)),t.normal&&(e.normal.push(o[3*n]),e.normal.push(o[3*n+1]),e.normal.push(o[3*n+2]),e.normal.push(o[3*u]),e.normal.push(o[3*u+1]),e.normal.push(o[3*u+2]),e.normal.push(o[3*p]),e.normal.push(o[3*p+1]),e.normal.push(o[3*p+2])),t.uv&&t.uv.forEach((function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(s[r][2*n]),e.uvs[r].push(s[r][2*n+1]),e.uvs[r].push(s[r][2*u]),e.uvs[r].push(s[r][2*u+1]),e.uvs[r].push(s[r][2*p]),e.uvs[r].push(s[r][2*p+1])}))}addMorphTargets(e,t,r,n){if(0===r.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const a=this;r.forEach((function(r){r.rawTargets.forEach((function(r){const o=O.Objects.Geometry[r.geoID];void 0!==o&&a.genMorphGeometry(e,t,o,n,r.name)}))}))}genMorphGeometry(e,t,r,a,o){const i=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==r.Vertices?r.Vertices.a:[],l=void 0!==r.Indexes?r.Indexes.a:[],c=3*e.attributes.position.count,u=new Float32Array(c);for(let e=0;e<l.length;e++){const t=3*l[e];u[t]=s[3*e],u[t+1]=s[3*e+1],u[t+2]=s[3*e+2]}const d={vertexIndices:i,vertexPositions:u},p=this.genBuffers(d),h=new n.Float32BufferAttribute(p.vertex,3);h.name=o||r.attrName,h.applyMatrix4(a),e.morphAttributes.position.push(h)}parseNormals(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a;let a=[];return"IndexToDirect"===r&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:a,mappingType:t,referenceType:r}}parseUVs(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a;let a=[];return"IndexToDirect"===r&&(a=e.UVIndex.a),{dataSize:2,buffer:n,indices:a,mappingType:t,referenceType:r}}parseVertexColors(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,a=e.Colors.a;let o=[];"IndexToDirect"===r&&(o=e.ColorIndex.a);for(let e=0,t=new n.Color;e<a.length;e+=4)t.fromArray(a,e).convertSRGBToLinear().toArray(a,e);return{dataSize:4,buffer:a,indices:o,mappingType:t,referenceType:r}}parseMaterialIndices(e){const t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};const n=e.Materials.a,a=[];for(let e=0;e<n.length;++e)a.push(e);return{dataSize:1,buffer:n,indices:a,mappingType:t,referenceType:r}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new n.BufferGeometry;const r=t-1,a=e.KnotVector.a,o=[],i=e.Points.a;for(let e=0,t=i.length;e<t;e+=4)o.push((new n.Vector4).fromArray(i,e));let s,l;if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){s=r,l=a.length-1-s;for(let e=0;e<r;++e)o.push(o[e])}const c=new S(r,a,o,s,l).getPoints(12*o.length);return(new n.BufferGeometry).setFromPoints(c)}}class U{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const r in t){const n=t[r],a=this.addClip(n);e.push(a)}return e}parseClips(){if(void 0===O.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=O.Objects.AnimationCurveNode,t=new Map;for(const r in e){const n=e[r];if(null!==n.attrName.match(/S|R|T|DeformPercent/)){const e={id:n.id,attr:n.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=O.Objects.AnimationCurve;for(const r in t){const n={id:t[r].id,times:t[r].KeyTime.a.map(X),values:t[r].KeyValueFloat.a},a=F.get(n.id);if(void 0!==a){const t=a.parents[0].ID,r=a.parents[0].relationship;r.match(/X/)?e.get(t).curves.x=n:r.match(/Y/)?e.get(t).curves.y=n:r.match(/Z/)?e.get(t).curves.z=n:r.match(/DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=n)}}}parseAnimationLayers(e){const t=O.Objects.AnimationLayer,r=new Map;for(const a in t){const t=[],o=F.get(parseInt(a));void 0!==o&&(o.children.forEach((function(r,a){if(e.has(r.ID)){const o=e.get(r.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===t[a]){const e=F.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==e){const o=O.Objects.Model[e.toString()];if(void 0===o)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",r);const i={modelName:o.attrName?n.PropertyBinding.sanitizeNodeName(o.attrName):"",ID:o.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};P.traverse((function(e){e.ID===o.id&&(i.transform=e.matrix,e.userData.transformData&&(i.eulerOrder=e.userData.transformData.eulerOrder))})),i.transform||(i.transform=new n.Matrix4),"PreRotation"in o&&(i.preRotation=o.PreRotation.value),"PostRotation"in o&&(i.postRotation=o.PostRotation.value),t[a]=i}}t[a]&&(t[a][o.attr]=o)}else if(void 0!==o.curves.morph){if(void 0===t[a]){const e=F.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,o=F.get(e).parents[0].ID,i=F.get(o).parents[0].ID,s=F.get(i).parents[0].ID,l=O.Objects.Model[s],c={modelName:l.attrName?n.PropertyBinding.sanitizeNodeName(l.attrName):"",morphName:O.Objects.Deformer[e].attrName};t[a]=c}t[a][o.attr]=o}}})),r.set(parseInt(a),t))}return r}parseAnimStacks(e){const t=O.Objects.AnimationStack,r={};for(const n in t){const a=F.get(parseInt(n)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(a[0].ID);r[n]={name:t[n].attrName,layer:o}}return r}addClip(e){let t=[];const r=this;return e.layer.forEach((function(e){t=t.concat(r.generateTracks(e))})),new n.AnimationClip(e.name,-1,t)}generateTracks(e){const t=[];let r=new n.Vector3,a=new n.Vector3;if(e.transform&&e.transform.decompose(r,new n.Quaternion,a),r=r.toArray(),a=a.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==n&&t.push(n)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const r=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);void 0!==r&&t.push(r)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.S.curves,a,"scale");void 0!==r&&t.push(r)}if(void 0!==e.DeformPercent){const r=this.generateMorphTrack(e);void 0!==r&&t.push(r)}return t}generateVectorTrack(e,t,r,a){const o=this.getTimesForAllAxes(t),i=this.getKeyframeTrackValues(o,t,r);return new n.VectorKeyframeTrack(e+"."+a,o,i)}generateRotationTrack(e,t,r,a,o){let i,s;if(void 0!==t.x&&void 0!==t.y&&void 0!==t.z){const e=this.interpolateRotations(t.x,t.y,t.z,o);i=e[0],s=e[1]}void 0!==r&&((r=r.map(n.MathUtils.degToRad)).push(o),r=(new n.Euler).fromArray(r),r=(new n.Quaternion).setFromEuler(r)),void 0!==a&&((a=a.map(n.MathUtils.degToRad)).push(o),a=(new n.Euler).fromArray(a),a=(new n.Quaternion).setFromEuler(a).invert());const l=new n.Quaternion,c=new n.Euler,u=[];if(!s||!i)return new n.QuaternionKeyframeTrack(e+".quaternion",[],[]);for(let e=0;e<s.length;e+=3)c.set(s[e],s[e+1],s[e+2],o),l.setFromEuler(c),void 0!==r&&l.premultiply(r),void 0!==a&&l.multiply(a),e>2&&(new n.Quaternion).fromArray(u,(e-3)/3*4).dot(l)<0&&l.set(-l.x,-l.y,-l.z,-l.w),l.toArray(u,e/3*4);return new n.QuaternionKeyframeTrack(e+".quaternion",i,u)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,r=t.values.map((function(e){return e/100})),a=P.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new n.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+a+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,r=t[0];for(let n=1;n<t.length;n++){const a=t[n];a!==r&&(t[e]=a,r=a,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,r){const n=r,a=[];let o=-1,i=-1,s=-1;return e.forEach((function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(i=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==o){const e=t.x.values[o];a.push(e),n[0]=e}else a.push(n[0]);if(-1!==i){const e=t.y.values[i];a.push(e),n[1]=e}else a.push(n[1]);if(-1!==s){const e=t.z.values[s];a.push(e),n[2]=e}else a.push(n[2])})),a}interpolateRotations(e,t,r,a){const o=[],i=[];o.push(e.times[0]),i.push(n.MathUtils.degToRad(e.values[0])),i.push(n.MathUtils.degToRad(t.values[0])),i.push(n.MathUtils.degToRad(r.values[0]));for(let s=1;s<e.values.length;s++){const l=[e.values[s-1],t.values[s-1],r.values[s-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;const c=l.map(n.MathUtils.degToRad),u=[e.values[s],t.values[s],r.values[s]];if(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))continue;const d=u.map(n.MathUtils.degToRad),p=[u[0]-l[0],u[1]-l[1],u[2]-l[2]],h=[Math.abs(p[0]),Math.abs(p[1]),Math.abs(p[2])];if(h[0]>=180||h[1]>=180||h[2]>=180){const t=Math.max(...h)/180,r=new n.Euler(...c,a),l=new n.Euler(...d,a),u=(new n.Quaternion).setFromEuler(r),p=(new n.Quaternion).setFromEuler(l);u.dot(p)&&p.set(-p.x,-p.y,-p.z,-p.w);const f=e.times[s-1],m=e.times[s]-f,g=new n.Quaternion,v=new n.Euler;for(let e=0;e<1;e+=1/t)g.copy(u.clone().slerp(p.clone(),e)),o.push(f+e*m),v.setFromQuaternion(g,a),i.push(v.x),i.push(v.y),i.push(v.z)}else o.push(e.times[s]),i.push(n.MathUtils.degToRad(e.values[s])),i.push(n.MathUtils.degToRad(t.values[s])),i.push(n.MathUtils.degToRad(r.values[s]))}return[o,i]}}class _{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new z,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,r=e.split(/[\r\n]+/);return r.forEach((function(e,n){const a=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(a||o)return;const i=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");i?t.parseNodeBegin(e,i):s?t.parseNodeProperty(e,s,r[++n]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),a={name:r},o=this.parseNodeAttr(n),i=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,a):r in i?("PoseNode"===r?i.PoseNode.push(a):void 0!==i[r].id&&(i[r]={},i[r][i[r].id]=i[r]),""!==o.id&&(i[r][o.id]=a)):"number"==typeof o.id?(i[r]={},i[r][o.id]=a):"Properties70"!==r&&(i[r]="PoseNode"===r?[a]:a),"number"==typeof o.id&&(a.id=o.id),""!==o.name&&(a.attrName=o.name),""!==o.type&&(a.attrType=o.type),this.pushStack(a)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}}parseNodeProperty(e,t,r){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),a=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===a&&(a=r.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===n){const e=a.split(",").slice(1),t=parseInt(e[0]),r=parseInt(e[1]);let i=a.split(",").slice(3);i=i.map((function(e){return e.trim().replace(/^"/,"")})),n="connections",a=[t,r],function(e,t){for(let r=0,n=e.length,a=t.length;r<a;r++,n++)e[n]=t[r]}(a,i),void 0===o[n]&&(o[n]=[])}"Node"===n&&(o.id=a),n in o&&Array.isArray(o[n])?o[n].push(a):"a"!==n?o[n]=a:o.a=a,this.setCurrentProp(o,n),"a"===n&&","!==a.slice(-1)&&(o.a=$(a))}else this.parseNodeSpecialProperty(e,n,a)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=$(t.a))}parseNodeSpecialProperty(e,t,r){const n=r.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),a=n[0],o=n[1],i=n[2],s=n[3];let l=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=$(l)}this.getPrevNode()[a]={type:o,type2:i,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),a)}}class V{parse(e){const t=new G(e);t.skip(23);const r=t.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);const n=new z;for(;!this.endOfContent(t);){const e=this.parseNode(t,r);null!==e&&n.add(e.name,e)}return n}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const r={},n=t>=7500?e.getUint64():e.getUint32(),a=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),i=e.getString(o);if(0===n)return null;const s=[];for(let t=0;t<a;t++)s.push(this.parseProperty(e));const l=s.length>0?s[0]:"",c=s.length>1?s[1]:"",u=s.length>2?s[2]:"";for(r.singleProperty=1===a&&e.getOffset()===n;n>e.getOffset();){const n=this.parseNode(e,t);null!==n&&this.parseSubNode(i,r,n)}return r.propertyList=s,"number"==typeof l&&(r.id=l),""!==c&&(r.attrName=c),""!==u&&(r.attrType=u),""!==i&&(r.name=i),r}parseSubNode(e,t,r){if(!0===r.singleProperty){const e=r.propertyList[0];Array.isArray(e)?(t[r.name]=r,r.a=e):t[r.name]=e}else if("Connections"===e&&"C"===r.name){const e=[];r.propertyList.forEach((function(t,r){0!==r&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===r.name)Object.keys(r).forEach((function(e){t[e]=r[e]}));else if("Properties70"===e&&"P"===r.name){let e=r.propertyList[0],n=r.propertyList[1];const a=r.propertyList[2],o=r.propertyList[3];let i;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),i="Color"===n||"ColorRGB"===n||"Vector"===n||"Vector3D"===n||0===n.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[e]={type:n,type2:a,flag:o,value:i}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)}parseProperty(e){const t=e.getString(1);let r;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return r=e.getUint32(),e.getArrayBuffer(r);case"S":return r=e.getUint32(),e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const n=e.getUint32(),a=e.getUint32(),o=e.getUint32();if(0===a)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}const i=function(e,t){return I((function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"}(e),e.subarray(2,-4)),t)}(new Uint8Array(e.getArrayBuffer(o))),s=new G(i.buffer);switch(t){case"b":case"c":return s.getBooleanArray(n);case"d":return s.getFloat64Array(n);case"f":return s.getFloat32Array(n);case"i":return s.getInt32Array(n);case"l":return s.getInt64Array(n)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class G{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){const t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let r=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const n=r.indexOf(0);return n>=0&&(r=new Uint8Array(this.dv.buffer,t,n)),this._textDecoder.decode(r)}}class z{add(e,t){this[e]=t}}function W(e){const t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function X(e){return e/46186158e3}const q=[];function K(e,t,r,n){let a;switch(n.mappingType){case"ByPolygonVertex":a=e;break;case"ByPolygon":a=t;break;case"ByVertice":a=r;break;case"AllSame":a=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(a=n.indices[a]);const o=a*n.dataSize,i=o+n.dataSize;return function(e,t,r,n){for(let a=r,o=0;a<n;a++,o++)e[o]=t[a];return e}(q,n.buffer,o,i)}const J=new n.Euler,Q=new n.Vector3;function Z(e){const t=new n.Matrix4,r=new n.Matrix4,a=new n.Matrix4,o=new n.Matrix4,i=new n.Matrix4,s=new n.Matrix4,l=new n.Matrix4,c=new n.Matrix4,u=new n.Matrix4,d=new n.Matrix4,p=new n.Matrix4,h=new n.Matrix4,f=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(Q.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(n.MathUtils.degToRad);t.push(e.eulerOrder||n.Euler.DEFAULT_ORDER),r.makeRotationFromEuler(J.fromArray(t))}if(e.rotation){const t=e.rotation.map(n.MathUtils.degToRad);t.push(e.eulerOrder||n.Euler.DEFAULT_ORDER),a.makeRotationFromEuler(J.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(n.MathUtils.degToRad);t.push(e.eulerOrder||n.Euler.DEFAULT_ORDER),o.makeRotationFromEuler(J.fromArray(t)),o.invert()}e.scale&&i.scale(Q.fromArray(e.scale)),e.scalingOffset&&l.setPosition(Q.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(Q.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(Q.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(Q.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(p.copy(e.parentMatrix),d.copy(e.parentMatrixWorld));const m=r.clone().multiply(a).multiply(o),g=new n.Matrix4;g.extractRotation(d);const v=new n.Matrix4;v.copyPosition(d);const y=v.clone().invert().multiply(d),b=g.clone().invert().multiply(y),w=i,E=new n.Matrix4;if(0===f)E.copy(g).multiply(m).multiply(b).multiply(w);else if(1===f)E.copy(g).multiply(b).multiply(m).multiply(w);else{const e=(new n.Matrix4).scale((new n.Vector3).setFromMatrixScale(p)).clone().invert(),t=b.clone().multiply(e);E.copy(g).multiply(m).multiply(t).multiply(w)}const x=u.clone().invert(),T=s.clone().invert();let N=t.clone().multiply(c).multiply(u).multiply(r).multiply(a).multiply(o).multiply(x).multiply(l).multiply(s).multiply(i).multiply(T);const A=(new n.Matrix4).copyPosition(N),k=d.clone().multiply(A);return h.copyPosition(k),N=h.clone().multiply(E),N.premultiply(d.invert()),N}function Y(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function $(e){return e.split(",").map((function(e){return parseFloat(e)}))}function ee(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),(new TextDecoder).decode(new Uint8Array(e,t,r))}THREE.FBXLoader=H,AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){const e=this.data;if(!e.src)return;this.remove();const t=new THREE.FBXLoader;e.crossorigin&&t.setCrossOrigin(e.crossorigin),t.load(e.src,this.load.bind(this))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"fbx",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},183:(e,t,r)=>{const n=r(416)(),a=function(){let e;return function(){return e=e||n("https://cdn.jsdelivr.net/gh/mrdoob/three.js@r86/examples/js/loaders/GLTFLoader.js"),e}}();e.exports=AFRAME.registerComponent("gltf-model-legacy",{schema:{type:"model"},init:function(){this.model=null,this.loader=null,this.loaderPromise=a().then((()=>{this.loader=new THREE.GLTFLoader,this.loader.setCrossOrigin("Anonymous")}))},update:function(){const e=this,t=this.el,r=this.data;r&&(this.remove(),this.loaderPromise.then((()=>{this.loader.load(r,(function(r){e.model=r.scene,e.model.animations=r.animations,t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"gltf",model:e.model})}))})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},648:e=>{e.exports=AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){let e;const t=this.data;t.src&&(this.remove(),e=new THREE.ObjectLoader,t.crossorigin&&e.setCrossOrigin(t.crossorigin),e.load(t.src,(e=>{e.traverse((e=>{e instanceof THREE.SkinnedMesh&&e.material&&(e.material.skinning=!!(e.geometry&&e.geometry.bones||[]).length)})),this.load(e)})))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"json",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},824:t=>{"use strict";t.exports=e}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var o=r[e]={exports:{}};return t[e](o,o.exports,n),o.exports}return n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(422),n(944),n(631),n(183),n(648),{}})()));
//# sourceMappingURL=aframe-extras.loaders.min.js.map