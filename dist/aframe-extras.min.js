/*! For license information please see aframe-extras.min.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("THREE"));else if("function"==typeof define&&define.amd)define(["THREE"],t);else{var n="object"==typeof exports?t(require("THREE")):t(e.THREE);for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(self,e=>(()=>{var t={95:()=>{AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){const e=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!e)throw new Error("No `checkpoint-controls` component found.");e.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}})},109:()=>{AFRAME.registerComponent("sphere-collider",{schema:{enabled:{default:!0},interval:{default:80},objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.prevCheckTime=void 0,this.eventDetail={},this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},play:function(){const e=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(e,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){const e=this.data;let t;t=e.objects?this.el.sceneEl.querySelectorAll(e.objects):this.el.sceneEl.children,this.els=Array.prototype.slice.call(t)},tick:function(){const e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,i=new THREE.Box3,s=[],r=new Map;return function(a){if(!this.data.enabled)return;const c=this.prevCheckTime;if(c&&a-c<this.data.interval)return;this.prevCheckTime=a;const l=this.el,d=this.data;let h;var u;l.getObject3D("mesh")&&(s.length=0,r.clear(),l.object3D.getWorldPosition(e),l.object3D.getWorldScale(n),h=d.radius*(u=n,Math.max(u.x,u.y,u.z)),this.els.forEach(function(n){let a,c,l,d;n.isEntity&&(c=n.getObject3D("mesh"),c&&(i.setFromObject(c).getSize(o),d=Math.max(o.x,o.y,o.z)/2,a=Math.sqrt(2*d*d),i.getCenter(t),a&&(l=e.distanceTo(t),l<a+h&&(s.push(n),r.set(n,l)))))}),s.sort((e,t)=>r.get(e)>r.get(t)?1:-1).forEach(this.handleHit),this.collisions.filter(e=>!r.has(e)).forEach(this.handleHitEnd),function(e,t){e.length=0;for(let n=0;n<t.length;n++)e[n]=t[n]}(this.collisions,s))}}(),handleHit:function(e){e.emit("hit"),e.addState(this.data.state),this.eventDetail.el=e,this.el.emit("hit",this.eventDetail)},handleHitEnd:function(e){e.emit("hitend"),e.removeState(this.data.state),this.eventDetail.el=e,this.el.emit("hitend",this.eventDetail)}})},144:()=>{AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){let e;const t=this.data;t.src&&(this.remove(),e=new THREE.ObjectLoader,t.crossorigin&&e.setCrossOrigin(t.crossorigin),e.load(t.src,e=>{e.traverse(e=>{e instanceof THREE.SkinnedMesh&&e.material&&(e.material.skinning=!!(e.geometry&&e.geometry.bones||[]).length)}),this.load(e)}))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"json",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},267:()=>{AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const e=this.el.sceneEl,t=e.canvas;if(!t)return void e.addEventListener("render-target-loaded",this.addEventListeners.bind(this));t.addEventListener("touchstart",this.onTouchStart,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd,{passive:!0});const n=e.getAttribute("vr-mode-ui");n&&n.cardboardModeEnabled&&e.addEventListener("enter-vr",this.onEnterVR)},removeEventListeners:function(){const e=this.el.sceneEl&&this.el.sceneEl.canvas;e&&(e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchend",this.onTouchEnd),this.el.sceneEl.removeEventListener("enter-vr",this.onEnterVR))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},onTouchStart:function(e){this.direction=-1,this.data.reverseEnabled&&e.touches&&2===e.touches.length&&(this.direction=1),e.preventDefault()},onTouchEnd:function(e){this.direction=0,e.preventDefault()},onEnterVR:function(){const e=this.el.sceneEl.xrSession;e&&(e.addEventListener("selectstart",this.onTouchStart),e.addEventListener("selectend",this.onTouchEnd))}})},417:()=>{const e={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};function t(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},useRegExp:{default:!1},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(e)},repetitions:{default:1/0,min:0},timeScale:{default:1},startAt:{default:0}},init:function(){this.model=null,this.mixer=null,this.activeActions=[];const e=this.el.getObject3D("mesh");e?this.load(e):this.el.addEventListener("model-loaded",e=>{this.load(e.detail.model)})},load:function(e){const t=this.el;this.model=e,this.mixer=new THREE.AnimationMixer(e),this.mixer.addEventListener("loop",e=>{t.emit("animation-loop",{action:e.action,loopDelta:e.loopDelta})}),this.mixer.addEventListener("finished",e=>{t.emit("animation-finished",{action:e.action,direction:e.direction})}),this.data.clip&&this.update({})},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(t){if(!t)return;const n=this.data,o=AFRAME.utils.diff(n,t);if("clip"in o)return this.stopAction(),void(n.clip&&this.playAction());this.activeActions.forEach(t=>{"duration"in o&&n.duration&&t.setDuration(n.duration),"clampWhenFinished"in o&&(t.clampWhenFinished=n.clampWhenFinished),("loop"in o||"repetitions"in o)&&t.setLoop(e[n.loop],n.repetitions),"timeScale"in o&&t.setEffectiveTimeScale(n.timeScale)})},stopAction:function(){const e=this.data;for(let t=0;t<this.activeActions.length;t++)e.crossFadeDuration?this.activeActions[t].fadeOut(e.crossFadeDuration):this.activeActions[t].stop();this.activeActions.length=0},playAction:function(){if(!this.mixer)return;const n=this.model,o=this.data,i=n.animations||(n.geometry||{}).animations||[];if(!i.length)return;const s=o.useRegExp?o.clip:(r=o.clip,new RegExp("^"+r.split(/\*+/).map(t).join(".*")+"$"));var r;for(let t,r=0;t=i[r];r++)if(t.name.match(s)){const i=this.mixer.clipAction(t,n);i.enabled=!0,i.clampWhenFinished=o.clampWhenFinished,o.duration&&i.setDuration(o.duration),1!==o.timeScale&&i.setEffectiveTimeScale(o.timeScale),i.startAt(this.mixer.time-o.startAt/1e3),i.setLoop(e[o.loop],o.repetitions).fadeIn(o.crossFadeDuration).play(),this.activeActions.push(i)}},tick:function(e,t){this.mixer&&!isNaN(t)&&this.mixer.update(t/1e3)}})},449:(e,t,n)=>{"use strict";n(866),n(982);var o=n(612);class i{static roundNumber(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}static sample(e){return e[Math.floor(Math.random()*e.length)]}static distanceToSquared(e,t){var n=e.x-t.x,o=e.y-t.y,i=e.z-t.z;return n*n+o*o+i*i}static isPointInPoly(e,t){for(var n=!1,o=-1,i=e.length,s=i-1;++o<i;s=o)(e[o].z<=t.z&&t.z<e[s].z||e[s].z<=t.z&&t.z<e[o].z)&&t.x<(e[s].x-e[o].x)*(t.z-e[o].z)/(e[s].z-e[o].z)+e[o].x&&(n=!n);return n}static isVectorInPolygon(e,t,n){var o=1e5,i=-1e5,s=[];return t.vertexIds.forEach(e=>{o=Math.min(n[e].y,o),i=Math.max(n[e].y,i),s.push(n[e])}),!!(e.y<i+.5&&e.y>o-.5&&this.isPointInPoly(s,e))}static triarea2(e,t,n){return(n.x-e.x)*(t.z-e.z)-(t.x-e.x)*(n.z-e.z)}static vequal(e,t){return this.distanceToSquared(e,t)<1e-5}static mergeVertices(e,t=1e-4){t=Math.max(t,Number.EPSILON);for(var n={},i=e.getIndex(),s=e.getAttribute("position"),r=i?i.count:s.count,a=0,c=[],l=[],d=Math.log10(1/t),h=Math.pow(10,d),u=0;u<r;u++){var p=i?i.getX(u):u,f="";f+=~~(s.getX(p)*h)+",",f+=~~(s.getY(p)*h)+",",(f+=~~(s.getZ(p)*h)+",")in n?c.push(n[f]):(l.push(s.getX(p)),l.push(s.getY(p)),l.push(s.getZ(p)),n[f]=a,c.push(a),a++)}const m=new o.BufferAttribute(new Float32Array(l),s.itemSize,s.normalized),y=new o.BufferGeometry;return y.setAttribute("position",m),y.setIndex(c),y}}class s{constructor(e){this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.sinkDown(this.content.length-1)}pop(){const e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e}remove(e){const t=this.content.indexOf(e),n=this.content.pop();t!==this.content.length-1&&(this.content[t]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))}size(){return this.content.length}rescoreElement(e){this.sinkDown(this.content.indexOf(e))}sinkDown(e){const t=this.content[e];for(;e>0;){const n=(e+1>>1)-1,o=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(o)))break;this.content[n]=t,this.content[e]=o,e=n}}bubbleUp(e){const t=this.content.length,n=this.content[e],o=this.scoreFunction(n);for(;;){const i=e+1<<1,s=i-1;let r,a=null;if(s<t&&(r=this.scoreFunction(this.content[s]),r<o&&(a=s)),i<t&&this.scoreFunction(this.content[i])<(null===a?o:r)&&(a=i),null===a)break;this.content[e]=this.content[a],this.content[a]=n,e=a}}}class r{constructor(){this.portals=[]}push(e,t){void 0===t&&(t=e),this.portals.push({left:e,right:t})}stringPull(){const e=this.portals,t=[];let n,o,s,r=0,a=0,c=0;n=e[0].left,o=e[0].left,s=e[0].right,t.push(n);for(let l=1;l<e.length;l++){const d=e[l].left,h=e[l].right;if(i.triarea2(n,s,h)<=0){if(!(i.vequal(n,s)||i.triarea2(n,o,h)>0)){t.push(o),n=o,r=a,o=n,s=n,a=r,c=r,l=r;continue}s=h,c=l}if(i.triarea2(n,o,d)>=0){if(!(i.vequal(n,o)||i.triarea2(n,s,d)<0)){t.push(s),n=s,r=c,o=n,s=n,a=r,c=r,l=r;continue}o=d,a=l}}return 0!==t.length&&i.vequal(t[t.length-1],e[e.length-1].left)||t.push(e[e.length-1].left),this.path=t,t}}class a{constructor(){this.zones={}}static createZone(e,t=1e-4){return class{static buildZone(e,t){const n=this._buildNavigationMesh(e,t),s={};n.vertices.forEach(e=>{e.x=i.roundNumber(e.x,2),e.y=i.roundNumber(e.y,2),e.z=i.roundNumber(e.z,2)}),s.vertices=n.vertices;const r=this._buildPolygonGroups(n);return s.groups=new Array(r.length),r.forEach((e,t)=>{const n=new Map;e.forEach((e,t)=>{n.set(e,t)});const r=new Array(e.length);e.forEach((e,t)=>{const a=[];e.neighbours.forEach(e=>a.push(n.get(e)));const c=[];e.neighbours.forEach(t=>c.push(this._getSharedVerticesInOrder(e,t)));const l=new o.Vector3(0,0,0);l.add(s.vertices[e.vertexIds[0]]),l.add(s.vertices[e.vertexIds[1]]),l.add(s.vertices[e.vertexIds[2]]),l.divideScalar(3),l.x=i.roundNumber(l.x,2),l.y=i.roundNumber(l.y,2),l.z=i.roundNumber(l.z,2),r[t]={id:t,neighbours:a,vertexIds:e.vertexIds,centroid:l,portals:c}}),s.groups[t]=r}),s}static _buildNavigationMesh(e,t){return e=i.mergeVertices(e,t),this._buildPolygonsFromGeometry(e)}static _spreadGroupId(e){let t=new Set([e]);for(;t.size>0;){const n=t;t=new Set,n.forEach(n=>{n.group=e.group,n.neighbours.forEach(e=>{void 0===e.group&&t.add(e)})})}}static _buildPolygonGroups(e){const t=[];return e.polygons.forEach(e=>{void 0!==e.group?t[e.group].push(e):(e.group=t.length,this._spreadGroupId(e),t.push([e]))}),t}static _buildPolygonNeighbours(e,t){const n=new Set,o=t[e.vertexIds[1]],i=t[e.vertexIds[2]];return t[e.vertexIds[0]].forEach(t=>{t!==e&&(o.includes(t)||i.includes(t))&&n.add(t)}),o.forEach(t=>{t!==e&&i.includes(t)&&n.add(t)}),n}static _buildPolygonsFromGeometry(e){const t=[],n=[],i=e.attributes.position,s=e.index,r=[];for(let e=0;e<i.count;e++)n.push((new o.Vector3).fromBufferAttribute(i,e)),r[e]=[];for(let n=0;n<e.index.count;n+=3){const e=s.getX(n),o=s.getX(n+1),i=s.getX(n+2),a={vertexIds:[e,o,i],neighbours:null};t.push(a),r[e].push(a),r[o].push(a),r[i].push(a)}return t.forEach(e=>{e.neighbours=this._buildPolygonNeighbours(e,r)}),{polygons:t,vertices:n}}static _getSharedVerticesInOrder(e,t){const n=e.vertexIds,o=n[0],i=n[1],s=n[2],r=t.vertexIds,a=r.includes(o),c=r.includes(i),l=r.includes(s);return a&&c&&l?Array.from(n):a&&c?[o,i]:c&&l?[i,s]:a&&l?[s,o]:(console.warn("Error processing navigation mesh neighbors; neighbors with <2 shared vertices found."),[])}}.buildZone(e,t)}setZoneData(e,t){this.zones[e]=t}getRandomNode(e,t,n,s){if(!this.zones[e])return new o.Vector3;n=n||null,s=s||0;const r=[];return this.zones[e].groups[t].forEach(e=>{n&&s?i.distanceToSquared(n,e.centroid)<s*s&&r.push(e.centroid):r.push(e.centroid)}),i.sample(r)||new o.Vector3}getClosestNode(e,t,n,o=!1){const s=this.zones[t].vertices;let r=null,a=1/0;return this.zones[t].groups[n].forEach(t=>{const n=i.distanceToSquared(t.centroid,e);n<a&&(!o||i.isVectorInPolygon(e,t,s))&&(r=t,a=n)}),r}findPath(e,t,n,a){const c=this.zones[n].groups[a],l=this.zones[n].vertices,d=this.getClosestNode(e,n,a,!0),h=this.getClosestNode(t,n,a,!0);if(!d||!h)return null;const u=class{static init(e){for(let t=0;t<e.length;t++){const n=e[t];n.f=0,n.g=0,n.h=0,n.cost=1,n.visited=!1,n.closed=!1,n.parent=null}}static cleanUp(e){for(let t=0;t<e.length;t++){const n=e[t];delete n.f,delete n.g,delete n.h,delete n.cost,delete n.visited,delete n.closed,delete n.parent}}static heap(){return new s(function(e){return e.f})}static search(e,t,n){this.init(e);const o=this.heap();for(o.push(t);o.size()>0;){const t=o.pop();if(t===n){let e=t;const n=[];for(;e.parent;)n.push(e),e=e.parent;return this.cleanUp(n),n.reverse()}t.closed=!0;const i=this.neighbours(e,t);for(let e=0,s=i.length;e<s;e++){const s=i[e];if(s.closed)continue;const r=t.g+s.cost,a=s.visited;if(!a||r<s.g){if(s.visited=!0,s.parent=t,!s.centroid||!n.centroid)throw new Error("Unexpected state");s.h=s.h||this.heuristic(s.centroid,n.centroid),s.g=r,s.f=s.g+s.h,a?o.rescoreElement(s):o.push(s)}}}return[]}static heuristic(e,t){return i.distanceToSquared(e,t)}static neighbours(e,t){const n=[];for(let o=0;o<t.neighbours.length;o++)n.push(e[t.neighbours[o]]);return n}}.search(c,d,h),p=function(e,t){for(var n=0;n<e.neighbours.length;n++)if(e.neighbours[n]===t.id)return e.portals[n]},f=new r;f.push(e);for(let e=0;e<u.length;e++){const t=u[e],n=u[e+1];if(n){const e=p(t,n);f.push(l[e[0]],l[e[1]])}}f.push(t),f.stringPull();const m=f.path.map(e=>new o.Vector3(e.x,e.y,e.z));return m.shift(),m}}a.prototype.getGroup=function(){const e=new o.Plane;return function(t,n,o=!1){if(!this.zones[t])return null;let s=null,r=Math.pow(50,2);const a=this.zones[t];for(let t=0;t<a.groups.length;t++){const c=a.groups[t];for(const l of c){if(o&&(e.setFromCoplanarPoints(a.vertices[l.vertexIds[0]],a.vertices[l.vertexIds[1]],a.vertices[l.vertexIds[2]]),Math.abs(e.distanceToPoint(n))<.01)&&i.isPointInPoly([a.vertices[l.vertexIds[0]],a.vertices[l.vertexIds[1]],a.vertices[l.vertexIds[2]]],n))return t;const c=i.distanceToSquared(l.centroid,n);c<r&&(s=t,r=c)}}return s}}(),a.prototype.clampStep=function(){const e=new o.Vector3,t=new o.Plane,n=new o.Triangle,i=new o.Vector3;let s,r,a=new o.Vector3;return function(o,c,l,d,h,u){const p=this.zones[d].vertices,f=this.zones[d].groups[h],m=[l],y={};y[l.id]=0,s=void 0,a.set(0,0,0),r=1/0,t.setFromCoplanarPoints(p[l.vertexIds[0]],p[l.vertexIds[1]],p[l.vertexIds[2]]),t.projectPoint(c,e),i.copy(e);for(let t=m.pop();t;t=m.pop()){n.set(p[t.vertexIds[0]],p[t.vertexIds[1]],p[t.vertexIds[2]]),n.closestPointToPoint(i,e),e.distanceToSquared(i)<r&&(s=t,a.copy(e),r=e.distanceToSquared(i));const o=y[t.id];if(!(o>2))for(let e=0;e<t.neighbours.length;e++){const n=f[t.neighbours[e]];n.id in y||(m.push(n),y[n.id]=o+1)}}return u.copy(a),s}}(),o.Object3D;const c=new a,l="level";AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set},setNavMeshGeometry:function(e){this.navMesh=new THREE.Mesh(e),c.setZoneData(l,a.createZone(e)),Array.from(this.agents).forEach(e=>e.updateNavLocation())},getNavMesh:function(){return this.navMesh},addAgent:function(e){this.agents.add(e)},removeAgent:function(e){this.agents.delete(e)},getPath:function(e,t,n){return this.navMesh?c.findPath(e,t,l,n):null},getGroup:function(e){return this.navMesh?c.getGroup(l,e):null},getNode:function(e,t){return this.navMesh?c.getClosestNode(e,l,t,!0):null},clampStep:function(e,t,n,o,i){return this.navMesh?o?c.clampStep(e,t,o,l,n,i):(i.copy(t),this.getNode(t,n)):(i.copy(t),null)}})},451:(e,t,n)=>{"use strict";n(417);var o=n(612);class i extends o.DataTextureLoader{constructor(e){super(e)}parse(e){if(e.length<19)throw new Error("THREE.TGALoader: Not enough data to contain header.");let t=0;const n=new Uint8Array(e),i={id_length:n[t++],colormap_type:n[t++],image_type:n[t++],colormap_index:n[t++]|n[t++]<<8,colormap_length:n[t++]|n[t++]<<8,colormap_size:n[t++],origin:[n[t++]|n[t++]<<8,n[t++]|n[t++]<<8],width:n[t++]|n[t++]<<8,height:n[t++]|n[t++]<<8,pixel_size:n[t++],flags:n[t++]};if(function(e){switch(e.image_type){case 1:case 9:if(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:if(e.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case 0:throw new Error("THREE.TGALoader: No data.");default:throw new Error("THREE.TGALoader: Invalid type "+e.image_type)}if(e.width<=0||e.height<=0)throw new Error("THREE.TGALoader: Invalid image size.");if(8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size)throw new Error("THREE.TGALoader: Invalid pixel size "+e.pixel_size)}(i),i.id_length+t>e.length)throw new Error("THREE.TGALoader: No data.");t+=i.id_length;let s=!1,r=!1,a=!1;switch(i.image_type){case 9:s=!0,r=!0;break;case 1:r=!0;break;case 10:s=!0;break;case 2:break;case 11:s=!0,a=!0;break;case 3:a=!0}const c=new Uint8Array(i.width*i.height*4),l=function(e,t,n,o,i){let s,r;const a=n.pixel_size>>3,c=n.width*n.height*a;if(t&&(r=i.subarray(o,o+=n.colormap_length*(n.colormap_size>>3))),e){let e,t,n;s=new Uint8Array(c);let r=0;const l=new Uint8Array(a);for(;r<c;)if(e=i[o++],t=1+(127&e),128&e){for(n=0;n<a;++n)l[n]=i[o++];for(n=0;n<t;++n)s.set(l,r+n*a);r+=a*t}else{for(t*=a,n=0;n<t;++n)s[r+n]=i[o++];r+=t}}else s=i.subarray(o,o+=t?n.width*n.height:c);return{pixel_data:s,palettes:r}}(s,r,i,t,n);return function(e,t,n,o,s){let r,c,l,d,h,u;switch((48&i.flags)>>4){default:case 2:r=0,l=1,h=t,c=0,d=1,u=n;break;case 0:r=0,l=1,h=t,c=n-1,d=-1,u=-1;break;case 3:r=t-1,l=-1,h=-1,c=0,d=1,u=n;break;case 1:r=t-1,l=-1,h=-1,c=n-1,d=-1,u=-1}if(a)switch(i.pixel_size){case 8:!function(e,t,n,o,s,r,a,c){let l,d,h,u=0;const p=i.width;for(h=t;h!==o;h+=n)for(d=s;d!==a;d+=r,u++)l=c[u],e[4*(d+p*h)+0]=l,e[4*(d+p*h)+1]=l,e[4*(d+p*h)+2]=l,e[4*(d+p*h)+3]=255}(e,c,d,u,r,l,h,o);break;case 16:!function(e,t,n,o,s,r,a,c){let l,d,h=0;const u=i.width;for(d=t;d!==o;d+=n)for(l=s;l!==a;l+=r,h+=2)e[4*(l+u*d)+0]=c[h+0],e[4*(l+u*d)+1]=c[h+0],e[4*(l+u*d)+2]=c[h+0],e[4*(l+u*d)+3]=c[h+1]}(e,c,d,u,r,l,h,o);break;default:throw new Error("THREE.TGALoader: Format not supported.")}else switch(i.pixel_size){case 8:!function(e,t,n,o,s,r,a,c,l){const d=l;let h,u,p,f=0;const m=i.width;for(p=t;p!==o;p+=n)for(u=s;u!==a;u+=r,f++)h=c[f],e[4*(u+m*p)+3]=255,e[4*(u+m*p)+2]=d[3*h+0],e[4*(u+m*p)+1]=d[3*h+1],e[4*(u+m*p)+0]=d[3*h+2]}(e,c,d,u,r,l,h,o,s);break;case 16:!function(e,t,n,o,s,r,a,c){let l,d,h,u=0;const p=i.width;for(h=t;h!==o;h+=n)for(d=s;d!==a;d+=r,u+=2)l=c[u+0]+(c[u+1]<<8),e[4*(d+p*h)+0]=(31744&l)>>7,e[4*(d+p*h)+1]=(992&l)>>2,e[4*(d+p*h)+2]=(31&l)<<3,e[4*(d+p*h)+3]=32768&l?0:255}(e,c,d,u,r,l,h,o);break;case 24:!function(e,t,n,o,s,r,a,c){let l,d,h=0;const u=i.width;for(d=t;d!==o;d+=n)for(l=s;l!==a;l+=r,h+=3)e[4*(l+u*d)+3]=255,e[4*(l+u*d)+2]=c[h+0],e[4*(l+u*d)+1]=c[h+1],e[4*(l+u*d)+0]=c[h+2]}(e,c,d,u,r,l,h,o);break;case 32:!function(e,t,n,o,s,r,a,c){let l,d,h=0;const u=i.width;for(d=t;d!==o;d+=n)for(l=s;l!==a;l+=r,h+=4)e[4*(l+u*d)+2]=c[h+0],e[4*(l+u*d)+1]=c[h+1],e[4*(l+u*d)+0]=c[h+2],e[4*(l+u*d)+3]=c[h+3]}(e,c,d,u,r,l,h,o);break;default:throw new Error("THREE.TGALoader: Format not supported.")}}(c,i.width,i.height,l.pixel_data,l.palettes),{data:c,width:i.width,height:i.height,flipY:!0,generateMipmaps:!0,minFilter:o.LinearMipmapLinearFilter}}}class s extends o.Loader{load(e,t,n,i){const s=this,r=""===s.path?o.LoaderUtils.extractUrlBase(e):s.path,a=new o.FileLoader(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(n){try{t(s.parse(n,r))}catch(t){i?i(t):console.error(t),s.manager.itemError(e)}},n,i)}parse(e,t){function n(e,t){const n=[],o=e.childNodes;for(let e=0,i=o.length;e<i;e++){const i=o[e];i.nodeName===t&&n.push(i)}return n}function s(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,o=t.length;e<o;e++)n[e]=t[e];return n}function r(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,o=t.length;e<o;e++)n[e]=parseFloat(t[e]);return n}function a(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,o=t.length;e<o;e++)n[e]=parseInt(t[e]);return n}function c(e){return e.substring(1)}function l(){return"three_default_"+et++}function d(e){return 0===Object.keys(e).length}function h(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function u(e){return void 0!==e?e.textContent:"Y_UP"}function p(e,t,o,i){const s=n(e,t)[0];if(void 0!==s){const e=n(s,o);for(let t=0;t<e.length;t++)i(e[t])}}function f(e,t){for(const n in e)e[n].build=t(e[n])}function m(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function y(e){const t={inputs:{}};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType&&"input"===o.nodeName){const e=c(o.getAttribute("source")),n=o.getAttribute("semantic");t.inputs[n]=e}}return t}function g(e){const t={};let n=e.getAttribute("target").split("/");const o=n.shift();let i=n.shift();const s=-1!==i.indexOf("("),r=-1!==i.indexOf(".");if(r)n=i.split("."),i=n.shift(),t.member=n.shift();else if(s){const e=i.split("(");i=e.shift();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t].replace(/\)/,""));t.indices=e}return t.id=o,t.sid=i,t.arraySyntax=s,t.memberSyntax=r,t.sampler=c(e.getAttribute("source")),t}function v(e){const t=[],n=e.channels,o=e.samplers,i=e.sources;for(const e in n)if(n.hasOwnProperty(e)){const s=n[e],r=o[s.sampler],a=r.inputs.INPUT,c=r.inputs.OUTPUT;A(w(s,i[a],i[c]),t)}return t}function b(e){return m(tt.animations[e],v)}function w(e,t,n){const o=tt.nodes[e.id],i=Be(o.id),s=o.transforms[e.sid],r=o.matrix.clone().transpose();let a,c,l,d,h,u;const p={};switch(s){case"matrix":for(l=0,d=t.array.length;l<d;l++)if(a=t.array[l],c=l*n.stride,void 0===p[a]&&(p[a]={}),!0===e.arraySyntax){const t=n.array[c],o=e.indices[0]+4*e.indices[1];p[a][o]=t}else for(h=0,u=n.stride;h<u;h++)p[a][h]=n.array[c+h];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',s)}const f=function(e,t){const n=[];for(const t in e)n.push({time:parseFloat(t),value:e[t]});n.sort(function(e,t){return e.time-t.time});for(let e=0;e<16;e++)T(n,e,t.elements[e]);return n}(p,r);return{name:i.uuid,keyframes:f}}const x=new o.Vector3,k=new o.Vector3,E=new o.Quaternion;function A(e,t){const n=e.keyframes,i=e.name,s=[],r=[],a=[],c=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],o=t.time,i=t.value;De.fromArray(i).transpose(),De.decompose(x,E,k),s.push(o),r.push(x.x,x.y,x.z),a.push(E.x,E.y,E.z,E.w),c.push(k.x,k.y,k.z)}return r.length>0&&t.push(new o.VectorKeyframeTrack(i+".position",s,r)),a.length>0&&t.push(new o.QuaternionKeyframeTrack(i+".quaternion",s,a)),c.length>0&&t.push(new o.VectorKeyframeTrack(i+".scale",s,c)),t}function T(e,t,n){let o,i,s,r=!0;for(i=0,s=e.length;i<s;i++)o=e[i],void 0===o.value[t]?o.value[t]=null:r=!1;if(!0===r)for(i=0,s=e.length;i<s;i++)o=e[i],o.value[t]=n;else!function(e,t){let n,o;for(let i=0,s=e.length;i<s;i++){const s=e[i];if(null===s.value[t]){if(n=N(e,i,t),o=M(e,i,t),null===n){s.value[t]=o.value[t];continue}if(null===o){s.value[t]=n.value[t];continue}C(s,n,o,t)}}}(e,t)}function N(e,t,n){for(;t>=0;){const o=e[t];if(null!==o.value[n])return o;t--}return null}function M(e,t,n){for(;t<e.length;){const o=e[t];if(null!==o.value[n])return o;t++}return null}function C(e,t,n,o){n.time-t.time!==0?e.value[o]=(e.time-t.time)*(n.value[o]-t.value[o])/(n.time-t.time)+t.value[o]:e.value[o]=t.value[o]}function D(e){const t=[],n=e.name,i=e.end-e.start||-1,s=e.animations;for(let e=0,n=s.length;e<n;e++){const n=b(s[e]);for(let e=0,o=n.length;e<o;e++)t.push(n[e])}return new o.AnimationClip(n,i,t)}function L(e){return m(tt.clips[e],D)}function O(e){const t={sources:{}};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=r(o.textContent);break;case"source":const e=o.getAttribute("id");t.sources[e]=le(o);break;case"joints":t.joints=R(o);break;case"vertex_weights":t.vertexWeights=I(o)}}return t}function R(e){const t={inputs:{}};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType&&"input"===o.nodeName){const e=o.getAttribute("semantic"),n=c(o.getAttribute("source"));t.inputs[e]=n}}return t}function I(e){const t={inputs:{}};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"input":const e=o.getAttribute("semantic"),n=c(o.getAttribute("source")),i=parseInt(o.getAttribute("offset"));t.inputs[e]={id:n,offset:i};break;case"vcount":t.vcount=a(o.textContent);break;case"v":t.v=a(o.textContent)}}return t}function S(e){const t={id:e.id},n=tt.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){const t={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},n=e.sources,i=e.vertexWeights,s=i.vcount,r=i.v,a=i.inputs.JOINT.offset,c=i.inputs.WEIGHT.offset,l=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],h=n[i.inputs.WEIGHT.id].array;let u,p,f,m=0;for(u=0,f=s.length;u<f;u++){const e=s[u],n=[];for(p=0;p<e;p++){const e=r[m+a],t=h[r[m+c]];n.push({index:e,weight:t}),m+=2}for(n.sort(y),p=0;p<4;p++){const e=n[p];void 0!==e?(t.indices.array.push(e.index),t.weights.array.push(e.weight)):(t.indices.array.push(0),t.weights.array.push(0))}}for(e.bindShapeMatrix?t.bindMatrix=(new o.Matrix4).fromArray(e.bindShapeMatrix).transpose():t.bindMatrix=(new o.Matrix4).identity(),u=0,f=l.array.length;u<f;u++){const e=l.array[u],n=(new o.Matrix4).fromArray(d.array,u*d.stride).transpose();t.joints.push({name:e,boneInverse:n})}return t;function y(e,t){return t.weight-e.weight}}(e.skin),n.sources.skinIndices=t.skin.indices,n.sources.skinWeights=t.skin.weights),t}function P(e){return m(tt.controllers[e],S)}function _(e){return void 0!==e.build?e.build:e.init_from}function F(e){const t=tt.images[e];return void 0!==t?m(t,_):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function V(e){const t={surfaces:{},samplers:{}};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"newparam":j(o,t);break;case"technique":t.technique=z(o);break;case"extra":t.extra=W(o)}}return t}function j(e,t){const n=e.getAttribute("sid");for(let o=0,i=e.childNodes.length;o<i;o++){const i=e.childNodes[o];if(1===i.nodeType)switch(i.nodeName){case"surface":t.surfaces[n]=B(i);break;case"sampler2D":t.samplers[n]=K(i)}}}function B(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"init_from"===o.nodeName&&(t.init_from=o.textContent)}return t}function K(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"source"===o.nodeName&&(t.source=o.textContent)}return t}function z(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=o.nodeName,t.parameters=U(o);break;case"extra":t.extra=W(o)}}return t}function U(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[o.nodeName]=H(o);break;case"transparent":t[o.nodeName]={opaque:o.hasAttribute("opaque")?o.getAttribute("opaque"):"A_ONE",data:H(o)}}}return t}function H(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"color":t[o.nodeName]=r(o.textContent);break;case"float":t[o.nodeName]=parseFloat(o.textContent);break;case"texture":t[o.nodeName]={id:o.getAttribute("texture"),extra:G(o)}}}return t}function G(e){const t={technique:{}};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"extra"===o.nodeName&&q(o,t)}return t}function q(e,t){for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"technique"===o.nodeName&&X(o,t)}}function X(e,t){for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[o.nodeName]=parseFloat(o.textContent);break;case"wrapU":case"wrapV":"TRUE"===o.textContent.toUpperCase()?t.technique[o.nodeName]=1:"FALSE"===o.textContent.toUpperCase()?t.technique[o.nodeName]=0:t.technique[o.nodeName]=parseInt(o.textContent);break;case"bump":t[o.nodeName]=Z(o)}}}function W(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"technique"===o.nodeName&&(t.technique=J(o))}return t}function J(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"double_sided":t[o.nodeName]=parseInt(o.textContent);break;case"bump":t[o.nodeName]=Z(o)}}return t}function Z(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"texture"===o.nodeName&&(t[o.nodeName]={id:o.getAttribute("texture"),texcoord:o.getAttribute("texcoord"),extra:G(o)})}return t}function Y(e){return e}function Q(e){const t=(n=e.url,m(tt.effects[n],Y));var n;const i=t.profile.technique;let s;switch(i.type){case"phong":case"blinn":s=new o.MeshPhongMaterial;break;case"lambert":s=new o.MeshLambertMaterial;break;default:s=new o.MeshBasicMaterial}function r(e,n=null){const i=t.profile.samplers[e.id];let s=null;if(void 0!==i?s=F(t.profile.surfaces[i.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),s=F(e.id)),null!==s){const t=function(e){let t,n=e.slice((e.lastIndexOf(".")-1>>>0)+2);return n=n.toLowerCase(),t="tga"===n?Ze:Je,t}(s);if(void 0!==t){const i=t.load(s),r=e.extra;if(void 0!==r&&void 0!==r.technique&&!1===d(r.technique)){const e=r.technique;i.wrapS=e.wrapU?o.RepeatWrapping:o.ClampToEdgeWrapping,i.wrapT=e.wrapV?o.RepeatWrapping:o.ClampToEdgeWrapping,i.offset.set(e.offsetU||0,e.offsetV||0),i.repeat.set(e.repeatU||1,e.repeatV||1)}else i.wrapS=o.RepeatWrapping,i.wrapT=o.RepeatWrapping;return null!==n&&(i.colorSpace=n),i}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",s),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}s.name=e.name||"";const a=i.parameters;for(const e in a){const t=a[e];switch(e){case"diffuse":t.color&&s.color.fromArray(t.color),t.texture&&(s.map=r(t.texture,o.SRGBColorSpace));break;case"specular":t.color&&s.specular&&s.specular.fromArray(t.color),t.texture&&(s.specularMap=r(t.texture));break;case"bump":t.texture&&(s.normalMap=r(t.texture));break;case"ambient":t.texture&&(s.lightMap=r(t.texture,o.SRGBColorSpace));break;case"shininess":t.float&&s.shininess&&(s.shininess=t.float);break;case"emission":t.color&&s.emissive&&s.emissive.fromArray(t.color),t.texture&&(s.emissiveMap=r(t.texture,o.SRGBColorSpace))}}s.color.convertSRGBToLinear(),s.specular&&s.specular.convertSRGBToLinear(),s.emissive&&s.emissive.convertSRGBToLinear();let c=a.transparent,l=a.transparency;if(void 0===l&&c&&(l={float:1}),void 0===c&&l&&(c={opaque:"A_ONE",data:{color:[1,1,1,1]}}),c&&l)if(c.data.texture)s.transparent=!0;else{const e=c.data.color;switch(c.opaque){case"A_ONE":s.opacity=e[3]*l.float;break;case"RGB_ZERO":s.opacity=1-e[0]*l.float;break;case"A_ZERO":s.opacity=1-e[3]*l.float;break;case"RGB_ONE":s.opacity=e[0]*l.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',c.opaque)}s.opacity<1&&(s.transparent=!0)}if(void 0!==i.extra&&void 0!==i.extra.technique){const e=i.extra.technique;for(const t in e){const n=e[t];switch(t){case"double_sided":s.side=1===n?o.DoubleSide:o.FrontSide;break;case"bump":s.normalMap=r(n.texture),s.normalScale=new o.Vector2(1,1)}}}return s}function $(e){return m(tt.materials[e],Q)}function ee(e){for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];if("technique_common"===n.nodeName)return te(n)}return{}}function te(e){const t={};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];switch(o.nodeName){case"perspective":case"orthographic":t.technique=o.nodeName,t.parameters=ne(o)}}return t}function ne(e){const t={};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];switch(o.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[o.nodeName]=parseFloat(o.textContent)}}return t}function oe(e){let t;switch(e.optics.technique){case"perspective":t=new o.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":let n=e.optics.parameters.ymag,i=e.optics.parameters.xmag;const s=e.optics.parameters.aspect_ratio;i=void 0===i?n*s:i,n=void 0===n?i/s:n,i*=.5,n*=.5,t=new o.OrthographicCamera(-i,i,n,-n,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new o.PerspectiveCamera}return t.name=e.name||"",t}function ie(e){const t=tt.cameras[e];return void 0!==t?m(t,oe):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function se(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=o.nodeName,t.parameters=re(o)}}return t}function re(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"color":const e=r(i.textContent);t.color=(new o.Color).fromArray(e).convertSRGBToLinear();break;case"falloff_angle":t.falloffAngle=parseFloat(i.textContent);break;case"quadratic_attenuation":const n=parseFloat(i.textContent);t.distance=n?Math.sqrt(1/n):0}}return t}function ae(e){let t;switch(e.technique){case"directional":t=new o.DirectionalLight;break;case"point":t=new o.PointLight;break;case"spot":t=new o.SpotLight;break;case"ambient":t=new o.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function ce(e){const t=tt.lights[e];return void 0!==t?m(t,ae):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function le(e){const t={array:[],stride:3};for(let o=0;o<e.childNodes.length;o++){const i=e.childNodes[o];if(1===i.nodeType)switch(i.nodeName){case"float_array":t.array=r(i.textContent);break;case"Name_array":t.array=s(i.textContent);break;case"technique_common":const e=n(i,"accessor")[0];void 0!==e&&(t.stride=parseInt(e.getAttribute("stride")))}}return t}function de(e){const t={};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];1===o.nodeType&&(t[o.getAttribute("semantic")]=c(o.getAttribute("source")))}return t}function he(e){const t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"input":const e=c(o.getAttribute("source")),n=o.getAttribute("semantic"),i=parseInt(o.getAttribute("offset")),s=parseInt(o.getAttribute("set")),r=s>0?n+s:n;t.inputs[r]={id:e,offset:i},t.stride=Math.max(t.stride,i+1),"TEXCOORD"===n&&(t.hasUV=!0);break;case"vcount":t.vcount=a(o.textContent);break;case"p":t.p=a(o.textContent)}}return t}function ue(e){let t=0;for(let n=0,o=e.length;n<o;n++)!0===e[n].hasUV&&t++;t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function pe(e){const t={},n=e.sources,o=e.vertices,i=e.primitives;if(0===i.length)return{};const s=function(e){const t={};for(let n=0;n<e.length;n++){const o=e[n];void 0===t[o.type]&&(t[o.type]=[]),t[o.type].push(o)}return t}(i);for(const e in s){const i=s[e];ue(i),t[e]=fe(i,n,o)}return t}function fe(e,t,n){const i={},s={array:[],stride:0},r={array:[],stride:0},a={array:[],stride:0},c={array:[],stride:0},l={array:[],stride:0},d=[],h=[],u=new o.BufferGeometry,p=[];let f=0;for(let o=0;o<e.length;o++){const i=e[o],m=i.inputs;let y=0;switch(i.type){case"lines":case"linestrips":y=2*i.count;break;case"triangles":y=3*i.count;break;case"polylist":for(let e=0;e<i.count;e++){const t=i.vcount[e];switch(t){case 3:y+=3;break;case 4:y+=6;break;default:y+=3*(t-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",i.type)}u.addGroup(f,y,o),f+=y,i.material&&p.push(i.material);for(const o in m){const u=m[o];switch(o){case"VERTEX":for(const o in n){const p=n[o];switch(o){case"POSITION":const n=s.array.length;if(me(i,t[p],u.offset,s.array),s.stride=t[p].stride,t.skinWeights&&t.skinIndices&&(me(i,t.skinIndices,u.offset,d),me(i,t.skinWeights,u.offset,h)),!1===i.hasUV&&!0===e.uvsNeedsFix){const e=(s.array.length-n)/s.stride;for(let t=0;t<e;t++)a.array.push(0,0)}break;case"NORMAL":me(i,t[p],u.offset,r.array),r.stride=t[p].stride;break;case"COLOR":me(i,t[p],u.offset,l.array),l.stride=t[p].stride;break;case"TEXCOORD":me(i,t[p],u.offset,a.array),a.stride=t[p].stride;break;case"TEXCOORD1":me(i,t[p],u.offset,c.array),a.stride=t[p].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',o)}}break;case"NORMAL":me(i,t[u.id],u.offset,r.array),r.stride=t[u.id].stride;break;case"COLOR":me(i,t[u.id],u.offset,l.array,!0),l.stride=t[u.id].stride;break;case"TEXCOORD":me(i,t[u.id],u.offset,a.array),a.stride=t[u.id].stride;break;case"TEXCOORD1":me(i,t[u.id],u.offset,c.array),c.stride=t[u.id].stride}}}return s.array.length>0&&u.setAttribute("position",new o.Float32BufferAttribute(s.array,s.stride)),r.array.length>0&&u.setAttribute("normal",new o.Float32BufferAttribute(r.array,r.stride)),l.array.length>0&&u.setAttribute("color",new o.Float32BufferAttribute(l.array,l.stride)),a.array.length>0&&u.setAttribute("uv",new o.Float32BufferAttribute(a.array,a.stride)),c.array.length>0&&u.setAttribute("uv1",new o.Float32BufferAttribute(c.array,c.stride)),d.length>0&&u.setAttribute("skinIndex",new o.Float32BufferAttribute(d,4)),h.length>0&&u.setAttribute("skinWeight",new o.Float32BufferAttribute(h,4)),i.data=u,i.type=e[0].type,i.materialKeys=p,i}function me(e,t,n,o,i=!1){const s=e.p,r=e.stride,a=e.vcount;function c(e){let t=s[e+n]*d;const r=t+d;for(;t<r;t++)o.push(l[t]);if(i){const e=o.length-d-1;Ye.setRGB(o[e+0],o[e+1],o[e+2]).convertSRGBToLinear(),o[e+0]=Ye.r,o[e+1]=Ye.g,o[e+2]=Ye.b}}const l=t.array,d=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,n=a.length;t<n;t++){const n=a[t];if(4===n){const t=e+1*r,n=e+2*r,o=e+3*r;c(e+0*r),c(t),c(o),c(t),c(n),c(o)}else if(3===n){const t=e+1*r,n=e+2*r;c(e+0*r),c(t),c(n)}else if(n>4)for(let t=1,o=n-2;t<=o;t++){const n=e+r*t,o=e+r*(t+1);c(e+0*r),c(n),c(o)}e+=r*n}}else for(let e=0,t=s.length;e<t;e+=r)c(e)}function ye(e){return m(tt.geometries[e],pe)}function ge(e){return void 0!==e.build?e.build:e}function ve(e,t){for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"joint":t.joints[o.getAttribute("sid")]=be(o);break;case"link":t.links.push(xe(o))}}}function be(e){let t;for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"prismatic":case"revolute":t=we(o)}}return t}function we(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new o.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"axis":const e=r(o.textContent);t.axis.fromArray(e);break;case"limits":const n=o.getElementsByTagName("max")[0],i=o.getElementsByTagName("min")[0];t.limits.max=parseFloat(n.textContent),t.limits.min=parseFloat(i.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function xe(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"attachment_full":t.attachments.push(ke(o));break;case"matrix":case"translate":case"rotate":t.transforms.push(Ee(o))}}return t}function ke(e){const t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"link":t.links.push(xe(o));break;case"matrix":case"translate":case"rotate":t.transforms.push(Ee(o))}}return t}function Ee(e){const t={type:e.nodeName},n=r(e.textContent);switch(t.type){case"matrix":t.obj=new o.Matrix4,t.obj.fromArray(n).transpose();break;case"translate":t.obj=new o.Vector3,t.obj.fromArray(n);break;case"rotate":t.obj=new o.Vector3,t.obj.fromArray(n),t.angle=o.MathUtils.degToRad(n[3])}return t}function Ae(e,t){for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];1===o.nodeType&&"technique_common"===o.nodeName&&Te(o,t)}}function Te(e,t){for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"inertia":t.inertia=r(o.textContent);break;case"mass":t.mass=r(o.textContent)[0]}}}function Ne(e){const t={target:e.getAttribute("target").split("/").pop()};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType&&"axis"===o.nodeName){const e=o.getElementsByTagName("param")[0];t.axis=e.textContent;const n=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=n.substring(0,n.length-1)}}return t}function Me(e){return void 0!==e.build?e.build:e}function Ce(e){const t=[],n=Ge.querySelector('[id="'+e.id+'"]');for(let e=0;e<n.childNodes.length;e++){const i=n.childNodes[e];if(1!==i.nodeType)continue;let s,a;switch(i.nodeName){case"matrix":s=r(i.textContent);const e=(new o.Matrix4).fromArray(s).transpose();t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:e});break;case"translate":case"scale":s=r(i.textContent),a=(new o.Vector3).fromArray(s),t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:a});break;case"rotate":s=r(i.textContent),a=(new o.Vector3).fromArray(s);const n=o.MathUtils.degToRad(s[3]);t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:a,angle:n})}}return t}const De=new o.Matrix4,Le=new o.Vector3;function Oe(e){const t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new o.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1!==i.nodeType)continue;let s;switch(i.nodeName){case"node":t.nodes.push(i.getAttribute("id")),Oe(i);break;case"instance_camera":t.instanceCameras.push(c(i.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Re(i));break;case"instance_light":t.instanceLights.push(c(i.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Re(i));break;case"instance_node":t.instanceNodes.push(c(i.getAttribute("url")));break;case"matrix":s=r(i.textContent),t.matrix.multiply(De.fromArray(s).transpose()),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"translate":s=r(i.textContent),Le.fromArray(s),t.matrix.multiply(De.makeTranslation(Le.x,Le.y,Le.z)),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"rotate":s=r(i.textContent);const e=o.MathUtils.degToRad(s[3]);t.matrix.multiply(De.makeRotationAxis(Le.fromArray(s),e)),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"scale":s=r(i.textContent),t.matrix.scale(Le.fromArray(s)),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"extra":break;default:console.log(i)}}return je(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):tt.nodes[t.id]=t,t}function Re(e){const t={id:c(e.getAttribute("url")),materials:{},skeletons:[]};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];switch(o.nodeName){case"bind_material":const e=o.getElementsByTagName("instance_material");for(let n=0;n<e.length;n++){const o=e[n],i=o.getAttribute("symbol"),s=o.getAttribute("target");t.materials[i]=c(s)}break;case"skeleton":t.skeletons.push(c(o.textContent))}}return t}function Ie(e,t){const n=[],i=[];let s,r,a;for(s=0;s<e.length;s++){const o=e[s];let i;if(je(o))i=Be(o),Se(i,t,n);else if(ze(o)){const e=tt.visualScenes[o].children;for(let o=0;o<e.length;o++){const i=e[o];"JOINT"===i.type&&Se(Be(i.id),t,n)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",o)}for(s=0;s<t.length;s++)for(r=0;r<n.length;r++)if(a=n[r],a.bone.name===t[s].name){i[s]=a,a.processed=!0;break}for(s=0;s<n.length;s++)a=n[s],!1===a.processed&&(i.push(a),a.processed=!0);const c=[],l=[];for(s=0;s<i.length;s++)a=i[s],c.push(a.bone),l.push(a.boneInverse);return new o.Skeleton(c,l)}function Se(e,t,n){e.traverse(function(e){if(!0===e.isBone){let i;for(let n=0;n<t.length;n++){const o=t[n];if(o.name===e.name){i=o.boneInverse;break}}void 0===i&&(i=new o.Matrix4),n.push({bone:e,boneInverse:i,processed:!1})}})}function Pe(e){const t=[],n=e.matrix,i=e.nodes,s=e.type,r=e.instanceCameras,a=e.instanceControllers,c=e.instanceLights,l=e.instanceGeometries,d=e.instanceNodes;for(let e=0,n=i.length;e<n;e++)t.push(Be(i[e]));for(let e=0,n=r.length;e<n;e++){const n=ie(r[e]);null!==n&&t.push(n.clone())}for(let e=0,n=a.length;e<n;e++){const n=a[e],o=P(n.id),i=Ve(ye(o.id),n.materials),s=Ie(n.skeletons,o.skin.joints);for(let e=0,n=i.length;e<n;e++){const n=i[e];n.isSkinnedMesh&&(n.bind(s,o.skin.bindMatrix),n.normalizeSkinWeights()),t.push(n)}}for(let e=0,n=c.length;e<n;e++){const n=ce(c[e]);null!==n&&t.push(n.clone())}for(let e=0,n=l.length;e<n;e++){const n=l[e],o=Ve(ye(n.id),n.materials);for(let e=0,n=o.length;e<n;e++)t.push(o[e])}for(let e=0,n=d.length;e<n;e++)t.push(Be(d[e]).clone());let h;if(0===i.length&&1===t.length)h=t[0];else{h="JOINT"===s?new o.Bone:new o.Group;for(let e=0;e<t.length;e++)h.add(t[e])}return h.name="JOINT"===s?e.sid:e.name,h.matrix.copy(n),h.matrix.decompose(h.position,h.quaternion,h.scale),h}const _e=new o.MeshBasicMaterial({name:o.Loader.DEFAULT_MATERIAL_NAME,color:16711935});function Fe(e,t){const n=[];for(let o=0,i=e.length;o<i;o++){const i=t[e[o]];void 0===i?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[o]),n.push(_e)):n.push($(i))}return n}function Ve(e,t){const n=[];for(const i in e){const s=e[i],r=Fe(s.materialKeys,t);if(0===r.length&&("lines"===i||"linestrips"===i?r.push(new o.LineBasicMaterial):r.push(new o.MeshPhongMaterial)),"lines"===i||"linestrips"===i)for(let e=0,t=r.length;e<t;e++){const t=r[e];if(!0===t.isMeshPhongMaterial||!0===t.isMeshLambertMaterial){const n=new o.LineBasicMaterial;n.color.copy(t.color),n.opacity=t.opacity,n.transparent=t.transparent,r[e]=n}}const a=void 0!==s.data.attributes.skinIndex,c=1===r.length?r[0]:r;let l;switch(i){case"lines":l=new o.LineSegments(s.data,c);break;case"linestrips":l=new o.Line(s.data,c);break;case"triangles":case"polylist":l=a?new o.SkinnedMesh(s.data,c):new o.Mesh(s.data,c)}n.push(l)}return n}function je(e){return void 0!==tt.nodes[e]}function Be(e){return m(tt.nodes[e],Pe)}function Ke(e){const t=new o.Group;t.name=e.name;const n=e.children;for(let e=0;e<n.length;e++){const o=n[e];t.add(Be(o.id))}return t}function ze(e){return void 0!==tt.visualScenes[e]}function Ue(e){return m(tt.visualScenes[e],Ke)}if(0===e.length)return{scene:new o.Scene};const He=(new DOMParser).parseFromString(e,"application/xml"),Ge=n(He,"COLLADA")[0],qe=He.getElementsByTagName("parsererror")[0];if(void 0!==qe){const e=n(qe,"div")[0];let t;return t=e?e.textContent:function(e){let t="";const n=[e];for(;n.length;){const e=n.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",n.push.apply(n,e.childNodes))}return t.trim()}(qe),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",t),null}const Xe=Ge.getAttribute("version");console.debug("THREE.ColladaLoader: File version",Xe);const We=function(e){return{unit:h(n(e,"unit")[0]),upAxis:u(n(e,"up_axis")[0])}}(n(Ge,"asset")[0]),Je=new o.TextureLoader(this.manager);let Ze;Je.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),i&&(Ze=new i(this.manager),Ze.setPath(this.resourcePath||t));const Ye=new o.Color,Qe=[];let $e={},et=0;const tt={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};p(Ge,"library_animations","animation",function e(t){const n={sources:{},samplers:{},channels:{}};let i=!1;for(let o=0,s=t.childNodes.length;o<s;o++){const s=t.childNodes[o];if(1!==s.nodeType)continue;let r;switch(s.nodeName){case"source":r=s.getAttribute("id"),n.sources[r]=le(s);break;case"sampler":r=s.getAttribute("id"),n.samplers[r]=y(s);break;case"channel":r=s.getAttribute("target"),n.channels[r]=g(s);break;case"animation":e(s),i=!0;break;default:console.log(s)}}!1===i&&(tt.animations[t.getAttribute("id")||o.MathUtils.generateUUID()]=n)}),p(Ge,"library_animation_clips","animation_clip",function(e){const t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"instance_animation"===o.nodeName&&t.animations.push(c(o.getAttribute("url")))}tt.clips[e.getAttribute("id")]=t}),p(Ge,"library_controllers","controller",function(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"skin":t.id=c(o.getAttribute("source")),t.skin=O(o);break;case"morph":t.id=c(o.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}tt.controllers[e.getAttribute("id")]=t}),p(Ge,"library_images","image",function(e){const t={init_from:n(e,"init_from")[0].textContent};tt.images[e.getAttribute("id")]=t}),p(Ge,"library_effects","effect",function(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"profile_COMMON"===o.nodeName&&(t.profile=V(o))}tt.effects[e.getAttribute("id")]=t}),p(Ge,"library_materials","material",function(e){const t={name:e.getAttribute("name")};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"instance_effect"===o.nodeName&&(t.url=c(o.getAttribute("url")))}tt.materials[e.getAttribute("id")]=t}),p(Ge,"library_cameras","camera",function(e){const t={name:e.getAttribute("name")};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"optics"===o.nodeName&&(t.optics=ee(o))}tt.cameras[e.getAttribute("id")]=t}),p(Ge,"library_lights","light",function(e){let t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"technique_common"===o.nodeName&&(t=se(o))}tt.lights[e.getAttribute("id")]=t}),p(Ge,"library_geometries","geometry",function(e){const t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},o=n(e,"mesh")[0];if(void 0!==o){for(let e=0;e<o.childNodes.length;e++){const n=o.childNodes[e];if(1!==n.nodeType)continue;const i=n.getAttribute("id");switch(n.nodeName){case"source":t.sources[i]=le(n);break;case"vertices":t.vertices=de(n);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",n.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(he(n));break;default:console.log(n)}}tt.geometries[e.getAttribute("id")]=t}}),p(Ge,"library_nodes","node",Oe),p(Ge,"library_visual_scenes","visual_scene",function(e){const t={name:e.getAttribute("name"),children:[]};!function(e){const t=e.getElementsByTagName("node");for(let e=0;e<t.length;e++){const n=t[e];!1===n.hasAttribute("id")&&n.setAttribute("id",l())}}(e);const o=n(e,"node");for(let e=0;e<o.length;e++)t.children.push(Oe(o[e]));tt.visualScenes[e.getAttribute("id")]=t}),p(Ge,"library_kinematics_models","kinematics_model",function(e){const t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];1===o.nodeType&&"technique_common"===o.nodeName&&ve(o,t)}tt.kinematicsModels[e.getAttribute("id")]=t}),p(Ge,"library_physics_models","physics_model",function(e){const t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];1===o.nodeType&&"rigid_body"===o.nodeName&&(t.rigidBodies[o.getAttribute("name")]={},Ae(o,t.rigidBodies[o.getAttribute("name")]))}tt.physicsModels[e.getAttribute("id")]=t}),p(Ge,"scene","instance_kinematics_scene",function(e){const t={bindJointAxis:[]};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];1===o.nodeType&&"bind_joint_axis"===o.nodeName&&t.bindJointAxis.push(Ne(o))}tt.kinematicsScenes[c(e.getAttribute("url"))]=t}),f(tt.animations,v),f(tt.clips,D),f(tt.controllers,S),f(tt.images,_),f(tt.effects,Y),f(tt.materials,Q),f(tt.cameras,oe),f(tt.lights,ae),f(tt.geometries,pe),f(tt.visualScenes,Ke),function(){const e=tt.clips;if(!0===d(e)){if(!1===d(tt.animations)){const e=[];for(const t in tt.animations){const n=b(t);for(let t=0,o=n.length;t<o;t++)e.push(n[t])}Qe.push(new o.AnimationClip("default",-1,e))}}else for(const t in e)Qe.push(L(t))}(),function(){const e=Object.keys(tt.kinematicsModels)[0],t=Object.keys(tt.kinematicsScenes)[0],n=Object.keys(tt.visualScenes)[0];if(void 0===e||void 0===t)return;const i=(s=e,m(tt.kinematicsModels[s],ge));var s;const r=function(e){return m(tt.kinematicsScenes[e],Me)}(t),a=Ue(n),c=r.bindJointAxis,l={};for(let e=0,t=c.length;e<t;e++){const t=c[e],n=Ge.querySelector('[sid="'+t.target+'"]');if(n){const e=n.parentElement;d(t.jointIndex,e)}}function d(e,t){const n=t.getAttribute("name"),o=i.joints[e];a.traverse(function(i){i.name===n&&(l[e]={object:i,transforms:Ce(t),joint:o,position:o.zeroPosition})})}const h=new o.Matrix4;$e={joints:i&&i.joints,getJointValue:function(e){const t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){const n=l[e];if(n){const i=n.joint;if(t>i.limits.max||t<i.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+i.limits.min+", max: "+i.limits.max+").");else if(i.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{const s=n.object,r=i.axis,a=n.transforms;De.identity();for(let n=0;n<a.length;n++){const s=a[n];if(s.sid&&-1!==s.sid.indexOf(e))switch(i.type){case"revolute":De.multiply(h.makeRotationAxis(r,o.MathUtils.degToRad(t)));break;case"prismatic":De.multiply(h.makeTranslation(r.x*t,r.y*t,r.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+i.type)}else switch(s.type){case"matrix":De.multiply(s.obj);break;case"translate":De.multiply(h.makeTranslation(s.obj.x,s.obj.y,s.obj.z));break;case"scale":De.scale(s.obj);break;case"rotate":De.multiply(h.makeRotationAxis(s.obj,s.angle))}}s.matrix.copy(De),s.matrix.decompose(s.position,s.quaternion,s.scale),l[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}();const nt=function(e){return Ue(c(n(e,"instance_visual_scene")[0].getAttribute("url")))}(n(Ge,"scene")[0]);return nt.animations=Qe,"Z_UP"===We.upAxis&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),nt.rotation.set(-Math.PI/2,0,0)),nt.scale.multiplyScalar(We.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Qe},kinematics:$e,library:tt,scene:nt}}}THREE.ColladaLoader=s,AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var e=this,t=this.el,n=this.data,o=this.el.sceneEl.systems.renderer;n&&(this.remove(),this.loader.load(n,function(n){e.model=n.scene,e.model.traverse(function(e){if(e.isMesh){var t=e.material;t.color&&o.applyColorCorrection(t.color),t.map&&o.applyColorCorrection(t.map),t.emissive&&o.applyColorCorrection(t.emissive),t.emissiveMap&&o.applyColorCorrection(t.emissiveMap)}}),t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"collada",model:e.model})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}});var r=Uint8Array,a=Uint16Array,c=Int32Array,l=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),d=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),h=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=function(e,t){for(var n=new a(31),o=0;o<31;++o)n[o]=t+=1<<e[o-1];var i=new c(n[30]);for(o=1;o<30;++o)for(var s=n[o];s<n[o+1];++s)i[s]=s-n[o]<<5|o;return{b:n,r:i}},p=u(l,2),f=p.b,m=p.r;f[28]=258,m[258]=28;for(var y=u(d,0),g=y.b,v=(y.r,new a(32768)),b=0;b<32768;++b){var w=(43690&b)>>1|(21845&b)<<1;w=(61680&(w=(52428&w)>>2|(13107&w)<<2))>>4|(3855&w)<<4,v[b]=((65280&w)>>8|(255&w)<<8)>>1}var x=function(e,t,n){for(var o=e.length,i=0,s=new a(t);i<o;++i)e[i]&&++s[e[i]-1];var r,c=new a(t);for(i=1;i<t;++i)c[i]=c[i-1]+s[i-1]<<1;if(n){r=new a(1<<t);var l=15-t;for(i=0;i<o;++i)if(e[i])for(var d=i<<4|e[i],h=t-e[i],u=c[e[i]-1]++<<h,p=u|(1<<h)-1;u<=p;++u)r[v[u]>>l]=d}else for(r=new a(o),i=0;i<o;++i)e[i]&&(r[i]=v[c[e[i]-1]++]>>15-e[i]);return r},k=new r(288);for(b=0;b<144;++b)k[b]=8;for(b=144;b<256;++b)k[b]=9;for(b=256;b<280;++b)k[b]=7;for(b=280;b<288;++b)k[b]=8;var E=new r(32);for(b=0;b<32;++b)E[b]=5;var A=x(k,9,1),T=x(E,5,1),N=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},M=function(e,t,n){var o=t/8|0;return(e[o]|e[o+1]<<8)>>(7&t)&n},C=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},D=function(e){return(e+7)/8|0},L=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],O=function(e,t,n){var o=new Error(t||L[e]);if(o.code=e,Error.captureStackTrace&&Error.captureStackTrace(o,O),!n)throw o;return o},R=function(e,t,n,o){var i=e.length,s=o?o.length:0;if(!i||t.f&&!t.l)return n||new r(0);var a=!n,c=a||2!=t.i,u=t.i;a&&(n=new r(3*i));var p=function(e){var t=n.length;if(e>t){var o=new r(Math.max(2*t,e));o.set(n),n=o}},m=t.f||0,y=t.p||0,v=t.b||0,b=t.l,w=t.d,k=t.m,E=t.n,L=8*i;do{if(!b){m=M(e,y,1);var R=M(e,y+1,3);if(y+=3,!R){var I=e[(H=D(y)+4)-4]|e[H-3]<<8,S=H+I;if(S>i){u&&O(0);break}c&&p(v+I),n.set(e.subarray(H,S),v),t.b=v+=I,t.p=y=8*S,t.f=m;continue}if(1==R)b=A,w=T,k=9,E=5;else if(2==R){var P=M(e,y,31)+257,_=M(e,y+10,15)+4,F=P+M(e,y+5,31)+1;y+=14;for(var V=new r(F),j=new r(19),B=0;B<_;++B)j[h[B]]=M(e,y+3*B,7);y+=3*_;var K=N(j),z=(1<<K)-1,U=x(j,K,1);for(B=0;B<F;){var H,G=U[M(e,y,z)];if(y+=15&G,(H=G>>4)<16)V[B++]=H;else{var q=0,X=0;for(16==H?(X=3+M(e,y,3),y+=2,q=V[B-1]):17==H?(X=3+M(e,y,7),y+=3):18==H&&(X=11+M(e,y,127),y+=7);X--;)V[B++]=q}}var W=V.subarray(0,P),J=V.subarray(P);k=N(W),E=N(J),b=x(W,k,1),w=x(J,E,1)}else O(1);if(y>L){u&&O(0);break}}c&&p(v+131072);for(var Z=(1<<k)-1,Y=(1<<E)-1,Q=y;;Q=y){var $=(q=b[C(e,y)&Z])>>4;if((y+=15&q)>L){u&&O(0);break}if(q||O(2),$<256)n[v++]=$;else{if(256==$){Q=y,b=null;break}var ee=$-254;if($>264){var te=l[B=$-257];ee=M(e,y,(1<<te)-1)+f[B],y+=te}var ne=w[C(e,y)&Y],oe=ne>>4;if(ne||O(3),y+=15&ne,J=g[oe],oe>3&&(te=d[oe],J+=C(e,y)&(1<<te)-1,y+=te),y>L){u&&O(0);break}c&&p(v+131072);var ie=v+ee;if(v<J){var se=s-J,re=Math.min(J,ie);for(se+v<0&&O(3);v<re;++v)n[v]=o[se+v]}for(;v<ie;++v)n[v]=n[v-J]}}t.l=b,t.p=Q,t.b=v,t.f=m,b&&(m=1,t.m=k,t.d=w,t.n=E)}while(!m);return v!=n.length&&a?function(e,t,n){return(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length),new r(e.subarray(t,n))}(n,0,v):n.subarray(0,v)},I=new r(0);function S(e,t){return R(e.subarray((n=e,o=t&&t.dictionary,(8!=(15&n[0])||n[0]>>4>7||(n[0]<<8|n[1])%31)&&O(6,"invalid zlib data"),(n[1]>>5&1)==+!o&&O(6,"invalid zlib data: "+(32&n[1]?"need":"unexpected")+" dictionary"),2+(n[1]>>3&4)),-4),{i:2},t&&t.out,t&&t.dictionary);var n,o}var P="undefined"!=typeof TextDecoder&&new TextDecoder;try{P.decode(I,{stream:!0})}catch(e){}function _(e,t,n){const o=n.length-e-1;if(t>=n[o])return o-1;if(t<=n[e])return e;let i=e,s=o,r=Math.floor((i+s)/2);for(;t<n[r]||t>=n[r+1];)t<n[r]?s=r:i=r,r=Math.floor((i+s)/2);return r}function F(e,t){let n=1;for(let t=2;t<=e;++t)n*=t;let o=1;for(let e=2;e<=t;++e)o*=e;for(let n=2;n<=e-t;++n)o*=n;return n/o}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;class V extends o.Curve{constructor(e,t,n,i,s){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=s||this.knots.length-1;for(let e=0;e<n.length;++e){const t=n[e];this.controlPoints[e]=new o.Vector4(t.x,t.y,t.z,t.w)}}getPoint(e,t=new o.Vector3){const n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=function(e,t,n,i){const s=_(e,i,t),r=function(e,t,n,o){const i=[],s=[],r=[];i[0]=1;for(let a=1;a<=n;++a){s[a]=t-o[e+1-a],r[a]=o[e+a]-t;let n=0;for(let e=0;e<a;++e){const t=r[e+1],o=s[a-e],c=i[e]/(t+o);i[e]=n+t*c,n=o*c}i[a]=n}return i}(s,i,e,t),a=new o.Vector4(0,0,0,0);for(let t=0;t<=e;++t){const o=n[s-e+t],i=r[t],c=o.w*i;a.x+=o.x*c,a.y+=o.y*c,a.z+=o.z*c,a.w+=o.w*i}return a}(this.degree,this.knots,this.controlPoints,i);return 1!==s.w&&s.divideScalar(s.w),n.set(s.x,s.y,s.z)}getTangent(e,t=new o.Vector3){const n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=function(e,t,n,i,s){const r=function(e,t,n,i,s){const r=s<e?s:e,a=[],c=_(e,i,t),l=function(e,t,n,o,i){const s=[];for(let e=0;e<=n;++e)s[e]=0;const r=[];for(let e=0;e<=o;++e)r[e]=s.slice(0);const a=[];for(let e=0;e<=n;++e)a[e]=s.slice(0);a[0][0]=1;const c=s.slice(0),l=s.slice(0);for(let o=1;o<=n;++o){c[o]=t-i[e+1-o],l[o]=i[e+o]-t;let n=0;for(let e=0;e<o;++e){const t=l[e+1],i=c[o-e];a[o][e]=t+i;const s=a[e][o-1]/a[o][e];a[e][o]=n+t*s,n=i*s}a[o][o]=n}for(let e=0;e<=n;++e)r[0][e]=a[e][n];for(let e=0;e<=n;++e){let t=0,i=1;const c=[];for(let e=0;e<=n;++e)c[e]=s.slice(0);c[0][0]=1;for(let s=1;s<=o;++s){let o=0;const l=e-s,d=n-s;e>=s&&(c[i][0]=c[t][0]/a[d+1][l],o=c[i][0]*a[l][d]);const h=e-1<=d?s-1:n-e;for(let e=l>=-1?1:-l;e<=h;++e)c[i][e]=(c[t][e]-c[t][e-1])/a[d+1][l+e],o+=c[i][e]*a[l+e][d];e<=d&&(c[i][s]=-c[t][s-1]/a[d+1][e],o+=c[i][s]*a[e][d]),r[s][e]=o;const u=t;t=i,i=u}}let d=n;for(let e=1;e<=o;++e){for(let t=0;t<=n;++t)r[e][t]*=d;d*=n-e}return r}(c,i,e,r,t),d=[];for(let e=0;e<n.length;++e){const t=n[e].clone(),o=t.w;t.x*=o,t.y*=o,t.z*=o,d[e]=t}for(let t=0;t<=r;++t){const n=d[c-e].clone().multiplyScalar(l[t][0]);for(let o=1;o<=e;++o)n.add(d[c-e+o].clone().multiplyScalar(l[t][o]));a[t]=n}for(let e=r+1;e<=s+1;++e)a[e]=new o.Vector4(0,0,0);return a}(e,t,n,i,s);return function(e){const t=e.length,n=[],i=[];for(let s=0;s<t;++s){const t=e[s];n[s]=new o.Vector3(t.x,t.y,t.z),i[s]=t.w}const s=[];for(let e=0;e<t;++e){const t=n[e].clone();for(let n=1;n<=e;++n)t.sub(s[e-n].clone().multiplyScalar(F(e,n)*i[n]));s[e]=t.divideScalar(i[0])}return s}(r)}(this.degree,this.knots,this.controlPoints,i,1);return n.copy(s[1]).normalize(),n}}let j,B,K;class z extends o.Loader{constructor(e){super(e)}load(e,t,n,i){const s=this,r=""===s.path?o.LoaderUtils.extractUrlBase(e):s.path,a=new o.FileLoader(this.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(n){try{t(s.parse(n,r))}catch(t){i?i(t):console.error(t),s.manager.itemError(e)}},n,i)}parse(e,t){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=21&&t===se(e,0,21)}(e))j=(new X).parse(e);else{const t=se(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function o(t){const o=e[t-1];return e=e.slice(n+t),n++,o}for(let e=0;e<t.length;++e)if(o(1)===t[e])return!1;return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(Z(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Z(t));j=(new q).parse(t)}const n=new o.TextureLoader(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new U(n,this.manager).parse(j)}}class U{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){B=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),o=this.parseDeformers(),i=(new H).parse(o);return this.parseScene(o,i,n),K}parseConnections(){const e=new Map;return"Connections"in j&&j.Connections.connections.forEach(function(t){const n=t[0],o=t[1],i=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const s={ID:o,relationship:i};e.get(n).parents.push(s),e.has(o)||e.set(o,{parents:[],children:[]});const r={ID:n,relationship:i};e.get(o).children.push(r)}),e}parseImages(){const e={},t={};if("Video"in j.Objects){const n=j.Objects.Video;for(const o in n){const i=n[o];if(e[parseInt(o)]=i.RelativeFilename||i.Filename,"Content"in i){const e=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,s="string"==typeof i.Content&&""!==i.Content;if(e||s){const e=this.parseImage(n[o]);t[i.RelativeFilename||i.Filename]=e}}}}for(const n in e){const o=e[n];void 0!==t[o]?e[n]=t[o]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,o=n.slice(n.lastIndexOf(".")+1).toLowerCase();let i;switch(o){case"bmp":i="image/bmp";break;case"jpg":case"jpeg":i="image/jpeg";break;case"png":i="image/png";break;case"tif":i="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),i="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+o+'" is not supported.')}if("string"==typeof t)return"data:"+i+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:i}))}}parseTextures(e){const t=new Map;if("Texture"in j.Objects){const n=j.Objects.Texture;for(const o in n){const i=this.parseTexture(n[o],e);t.set(parseInt(o),i)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,s=e.WrapModeV,r=void 0!==i?i.value:0,a=void 0!==s?s.value:0;if(n.wrapS=0===r?o.RepeatWrapping:o.ClampToEdgeWrapping,n.wrapT=0===a?o.RepeatWrapping:o.ClampToEdgeWrapping,"Scaling"in e){const t=e.Scaling.value;n.repeat.x=t[0],n.repeat.y=t[1]}if("Translation"in e){const t=e.Translation.value;n.offset.x=t[0],n.offset.y=t[1]}return n}loadTexture(e,t){let n;const i=this.textureLoader.path,s=B.get(e.id).children;let r;void 0!==s&&s.length>0&&void 0!==t[s[0].ID]&&(n=t[s[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));const a=e.FileName.slice(-3).toLowerCase();if("tga"===a){const t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),r=new o.Texture):(t.setPath(this.textureLoader.path),r=t.load(n))}else if("dds"===a){const t=this.manager.getHandler(".dds");null===t?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),r=new o.Texture):(t.setPath(this.textureLoader.path),r=t.load(n))}else"psd"===a?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),r=new o.Texture):r=this.textureLoader.load(n);return this.textureLoader.setPath(i),r}parseMaterials(e){const t=new Map;if("Material"in j.Objects){const n=j.Objects.Material;for(const o in n){const i=this.parseMaterial(n[o],e);null!==i&&t.set(parseInt(o),i)}}return t}parseMaterial(e,t){const n=e.id,i=e.attrName;let s=e.ShadingModel;if("object"==typeof s&&(s=s.value),!B.has(n))return null;const r=this.parseParameters(e,t,n);let a;switch(s.toLowerCase()){case"phong":a=new o.MeshPhongMaterial;break;case"lambert":a=new o.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new o.MeshPhongMaterial}return a.setValues(r),a.name=i,a}parseParameters(e,t,n){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new o.Color).fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(i.color=(new o.Color).fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new o.Color).fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(i.emissive=(new o.Color).fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new o.Color).fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new o.Color).fromArray(e.SpecularColor.value).convertSRGBToLinear());const s=this;return B.get(n).children.forEach(function(e){const n=e.relationship;switch(n){case"Bump":i.bumpMap=s.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=s.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=s.getTexture(t,e.ID),void 0!==i.map&&(i.map.colorSpace=o.SRGBColorSpace);break;case"DisplacementColor":i.displacementMap=s.getTexture(t,e.ID);break;case"EmissiveColor":i.emissiveMap=s.getTexture(t,e.ID),void 0!==i.emissiveMap&&(i.emissiveMap.colorSpace=o.SRGBColorSpace);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=s.getTexture(t,e.ID);break;case"ReflectionColor":i.envMap=s.getTexture(t,e.ID),void 0!==i.envMap&&(i.envMap.mapping=o.EquirectangularReflectionMapping,i.envMap.colorSpace=o.SRGBColorSpace);break;case"SpecularColor":i.specularMap=s.getTexture(t,e.ID),void 0!==i.specularMap&&(i.specularMap.colorSpace=o.SRGBColorSpace);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=s.getTexture(t,e.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}}),i}getTexture(e,t){return"LayeredTexture"in j.Objects&&t in j.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=B.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in j.Objects){const n=j.Objects.Deformer;for(const o in n){const i=n[o],s=B.get(parseInt(o));if("Skin"===i.attrType){const t=this.parseSkeleton(s,n);t.ID=o,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=s.parents[0].ID,e[o]=t}else if("BlendShape"===i.attrType){const e={id:o};e.rawTargets=this.parseMorphTargets(s,n),e.id=o,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[o]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(e){const i=t[e.ID];if("Cluster"!==i.attrType)return;const s={ID:e.ID,indices:[],weights:[],transformLink:(new o.Matrix4).fromArray(i.TransformLink.a)};"Indexes"in i&&(s.indices=i.Indexes.a,s.weights=i.Weights.a),n.push(s)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let o=0;o<e.children.length;o++){const i=e.children[o],s=t[i.ID],r={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;r.geoID=B.get(parseInt(i.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,n.push(r)}return n}parseScene(e,t,n){K=new o.Group;const i=this.parseModels(e.skeletons,t,n),s=j.Objects.Model,r=this;i.forEach(function(e){const t=s[e.ID];r.setLookAtProperties(e,t),B.get(e.ID).parents.forEach(function(t){const n=i.get(t.ID);void 0!==n&&n.add(e)}),null===e.parent&&K.add(e)}),this.bindSkeleton(e.skeletons,t,i),this.addGlobalSceneSettings(),K.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=ne(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}});const a=(new G).parse();1===K.children.length&&K.children[0].isGroup&&(K.children[0].animations=a,K=K.children[0]),K.animations=a}parseModels(e,t,n){const i=new Map,s=j.Objects.Model;for(const r in s){const a=parseInt(r),c=s[r],l=B.get(a);let d=this.buildSkeleton(l,e,a,c.attrName);if(!d){switch(c.attrType){case"Camera":d=this.createCamera(l);break;case"Light":d=this.createLight(l);break;case"Mesh":d=this.createMesh(l,t,n);break;case"NurbsCurve":d=this.createCurve(l,t);break;case"LimbNode":case"Root":d=new o.Bone;break;default:d=new o.Group}d.name=c.attrName?o.PropertyBinding.sanitizeNodeName(c.attrName):"",d.userData.originalName=c.attrName,d.ID=a}this.getTransformData(d,c),i.set(a,d)}return i}buildSkeleton(e,t,n,i){let s=null;return e.parents.forEach(function(e){for(const r in t){const a=t[r];a.rawBones.forEach(function(t,r){if(t.ID===e.ID){const e=s;s=new o.Bone,s.matrixWorld.copy(t.transformLink),s.name=i?o.PropertyBinding.sanitizeNodeName(i):"",s.userData.originalName=i,s.ID=n,a.bones[r]=s,null!==e&&s.add(e)}})}}),s}createCamera(e){let t,n;if(e.children.forEach(function(e){const t=j.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)}),void 0===n)t=new o.Object3D;else{let e=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(e=1);let i=1;void 0!==n.NearPlane&&(i=n.NearPlane.value/1e3);let s=1e3;void 0!==n.FarPlane&&(s=n.FarPlane.value/1e3);let r=window.innerWidth,a=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(r=n.AspectWidth.value,a=n.AspectHeight.value);const c=r/a;let l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);const d=n.FocalLength?n.FocalLength.value:null;switch(e){case 0:t=new o.PerspectiveCamera(l,c,i,s),null!==d&&t.setFocalLength(d);break;case 1:t=new o.OrthographicCamera(-r/2,r/2,a/2,-a/2,i,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new o.Object3D}}return t}createLight(e){let t,n;if(e.children.forEach(function(e){const t=j.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)}),void 0===n)t=new o.Object3D;else{let e;e=void 0===n.LightType?0:n.LightType.value;let i=16777215;void 0!==n.Color&&(i=(new o.Color).fromArray(n.Color.value).convertSRGBToLinear());let s=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(s=0);let r=0;void 0!==n.FarAttenuationEnd&&(r=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const a=1;switch(e){case 0:t=new o.PointLight(i,s,r,a);break;case 1:t=new o.DirectionalLight(i,s);break;case 2:let e=Math.PI/3;void 0!==n.InnerAngle&&(e=o.MathUtils.degToRad(n.InnerAngle.value));let c=0;void 0!==n.OuterAngle&&(c=o.MathUtils.degToRad(n.OuterAngle.value),c=Math.max(c,1)),t=new o.SpotLight(i,s,r,e,c,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new o.PointLight(i,s)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,s=null,r=null;const a=[];return e.children.forEach(function(e){t.has(e.ID)&&(s=t.get(e.ID)),n.has(e.ID)&&a.push(n.get(e.ID))}),a.length>1?r=a:a.length>0?r=a[0]:(r=new o.MeshPhongMaterial({name:o.Loader.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(r)),"color"in s.attributes&&a.forEach(function(e){e.vertexColors=!0}),s.FBX_Deformer?(i=new o.SkinnedMesh(s,r),i.normalizeSkinWeights()):i=new o.Mesh(s,r),i}createCurve(e,t){const n=e.children.reduce(function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e},null),i=new o.LineBasicMaterial({name:o.Loader.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new o.Line(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?oe(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&B.get(e.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){const n=j.Objects.Model[t.ID];if("Lcl_Translation"in n){const t=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),K.add(e.target)):e.lookAt((new o.Vector3).fromArray(t))}}})}bindSkeleton(e,t,n){const i=this.parsePoseNodes();for(const s in e){const r=e[s];B.get(parseInt(r.ID)).parents.forEach(function(e){if(t.has(e.ID)){const t=e.ID;B.get(t).parents.forEach(function(e){n.has(e.ID)&&n.get(e.ID).bind(new o.Skeleton(r.bones),i[e.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in j.Objects){const t=j.Objects.Pose;for(const n in t)if("BindPose"===t[n].attrType&&t[n].NbPoseNodes>0){const i=t[n].PoseNode;Array.isArray(i)?i.forEach(function(t){e[t.Node]=(new o.Matrix4).fromArray(t.Matrix.a)}):e[i.Node]=(new o.Matrix4).fromArray(i.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in j){if("AmbientColor"in j.GlobalSettings){const e=j.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(0!==t||0!==n||0!==i){const e=new o.Color(t,n,i).convertSRGBToLinear();K.add(new o.AmbientLight(e,1))}}"UnitScaleFactor"in j.GlobalSettings&&(K.userData.unitScaleFactor=j.GlobalSettings.UnitScaleFactor.value)}}}class H{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in j.Objects){const n=j.Objects.Geometry;for(const o in n){const i=B.get(parseInt(o)),s=this.parseGeometry(i,n[o],e);t.set(parseInt(o),s)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const o=n.skeletons,i=[],s=e.parents.map(function(e){return j.Objects.Model[e.ID]});if(0===s.length)return;const r=e.children.reduce(function(e,t){return void 0!==o[t.ID]&&(e=o[t.ID]),e},null);e.children.forEach(function(e){void 0!==n.morphTargets[e.ID]&&i.push(n.morphTargets[e.ID])});const a=s[0],c={};"RotationOrder"in a&&(c.eulerOrder=oe(a.RotationOrder.value)),"InheritType"in a&&(c.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(c.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(c.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(c.scale=a.GeometricScaling.value);const l=ne(c);return this.genGeometry(t,r,i,l)}genGeometry(e,t,n,i){const s=new o.BufferGeometry;e.attrName&&(s.name=e.attrName);const r=this.parseGeoNode(e,t),a=this.genBuffers(r),c=new o.Float32BufferAttribute(a.vertex,3);if(c.applyMatrix4(i),s.setAttribute("position",c),a.colors.length>0&&s.setAttribute("color",new o.Float32BufferAttribute(a.colors,3)),t&&(s.setAttribute("skinIndex",new o.Uint16BufferAttribute(a.weightsIndices,4)),s.setAttribute("skinWeight",new o.Float32BufferAttribute(a.vertexWeights,4)),s.FBX_Deformer=t),a.normal.length>0){const e=(new o.Matrix3).getNormalMatrix(i),t=new o.Float32BufferAttribute(a.normal,3);t.applyNormalMatrix(e),s.setAttribute("normal",t)}if(a.uvs.forEach(function(e,t){const n=0===t?"uv":`uv${t}`;s.setAttribute(n,new o.Float32BufferAttribute(a.uvs[t],2))}),r.material&&"AllSame"!==r.material.mappingType){let e=a.materialIndex[0],t=0;if(a.materialIndex.forEach(function(n,o){n!==e&&(s.addGroup(t,o-t,e),e=n,t=o)}),s.groups.length>0){const t=s.groups[s.groups.length-1],n=t.start+t.count;n!==a.materialIndex.length&&s.addGroup(n,a.materialIndex.length-n,e)}0===s.groups.length&&s.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(s,e,n,i),s}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(o,i){void 0===n.weightTable[o]&&(n.weightTable[o]=[]),n.weightTable[o].push({id:t,weight:e.weights[i]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,o=0,i=!1,s=[],r=[],a=[],c=[],l=[],d=[];const h=this;return e.vertexIndices.forEach(function(u,p){let f,m=!1;u<0&&(u^=-1,m=!0);let y=[],g=[];if(s.push(3*u,3*u+1,3*u+2),e.color){const t=$(p,n,u,e.color);a.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[u]&&e.weightTable[u].forEach(function(e){g.push(e.weight),y.push(e.id)}),g.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);const e=[0,0,0,0],t=[0,0,0,0];g.forEach(function(n,o){let i=n,s=y[o];t.forEach(function(t,n,o){if(i>t){o[n]=i,i=t;const r=e[n];e[n]=s,s=r}})}),y=e,g=t}for(;g.length<4;)g.push(0),y.push(0);for(let e=0;e<4;++e)l.push(g[e]),d.push(y[e])}if(e.normal){const t=$(p,n,u,e.normal);r.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=$(p,n,u,e.material)[0],f<0&&(h.negativeMaterialIndices=!0,f=0)),e.uv&&e.uv.forEach(function(e,t){const o=$(p,n,u,e);void 0===c[t]&&(c[t]=[]),c[t].push(o[0]),c[t].push(o[1])}),o++,m&&(h.genFace(t,e,s,f,r,a,c,l,d,o),n++,o=0,s=[],r=[],a=[],c=[],l=[],d=[])}),t}getNormalNewell(e){const t=new o.Vector3(0,0,0);for(let n=0;n<e.length;n++){const o=e[n],i=e[(n+1)%e.length];t.x+=(o.y-i.y)*(o.z+i.z),t.y+=(o.z-i.z)*(o.x+i.x),t.z+=(o.x-i.x)*(o.y+i.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),n=(Math.abs(t.z)>.5?new o.Vector3(0,1,0):new o.Vector3(0,0,1)).cross(t).normalize(),i=t.clone().cross(n).normalize();return{normal:t,tangent:n,bitangent:i}}flattenVertex(e,t,n){return new o.Vector2(e.dot(t),e.dot(n))}genFace(e,t,n,i,s,r,a,c,l,d){let h;if(d>3){const e=[];for(let i=0;i<n.length;i+=3)e.push(new o.Vector3(t.vertexPositions[n[i]],t.vertexPositions[n[i+1]],t.vertexPositions[n[i+2]]));const{tangent:i,bitangent:s}=this.getNormalTangentAndBitangent(e),r=[];for(const t of e)r.push(this.flattenVertex(t,i,s));h=o.ShapeUtils.triangulateShape(r,[])}else h=[[0,1,2]];for(const[o,d,u]of h)e.vertex.push(t.vertexPositions[n[3*o]]),e.vertex.push(t.vertexPositions[n[3*o+1]]),e.vertex.push(t.vertexPositions[n[3*o+2]]),e.vertex.push(t.vertexPositions[n[3*d]]),e.vertex.push(t.vertexPositions[n[3*d+1]]),e.vertex.push(t.vertexPositions[n[3*d+2]]),e.vertex.push(t.vertexPositions[n[3*u]]),e.vertex.push(t.vertexPositions[n[3*u+1]]),e.vertex.push(t.vertexPositions[n[3*u+2]]),t.skeleton&&(e.vertexWeights.push(c[4*o]),e.vertexWeights.push(c[4*o+1]),e.vertexWeights.push(c[4*o+2]),e.vertexWeights.push(c[4*o+3]),e.vertexWeights.push(c[4*d]),e.vertexWeights.push(c[4*d+1]),e.vertexWeights.push(c[4*d+2]),e.vertexWeights.push(c[4*d+3]),e.vertexWeights.push(c[4*u]),e.vertexWeights.push(c[4*u+1]),e.vertexWeights.push(c[4*u+2]),e.vertexWeights.push(c[4*u+3]),e.weightsIndices.push(l[4*o]),e.weightsIndices.push(l[4*o+1]),e.weightsIndices.push(l[4*o+2]),e.weightsIndices.push(l[4*o+3]),e.weightsIndices.push(l[4*d]),e.weightsIndices.push(l[4*d+1]),e.weightsIndices.push(l[4*d+2]),e.weightsIndices.push(l[4*d+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(r[3*o]),e.colors.push(r[3*o+1]),e.colors.push(r[3*o+2]),e.colors.push(r[3*d]),e.colors.push(r[3*d+1]),e.colors.push(r[3*d+2]),e.colors.push(r[3*u]),e.colors.push(r[3*u+1]),e.colors.push(r[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(s[3*o]),e.normal.push(s[3*o+1]),e.normal.push(s[3*o+2]),e.normal.push(s[3*d]),e.normal.push(s[3*d+1]),e.normal.push(s[3*d+2]),e.normal.push(s[3*u]),e.normal.push(s[3*u+1]),e.normal.push(s[3*u+2])),t.uv&&t.uv.forEach(function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(a[n][2*o]),e.uvs[n].push(a[n][2*o+1]),e.uvs[n].push(a[n][2*d]),e.uvs[n].push(a[n][2*d+1]),e.uvs[n].push(a[n][2*u]),e.uvs[n].push(a[n][2*u+1])})}addMorphTargets(e,t,n,o){if(0===n.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const i=this;n.forEach(function(n){n.rawTargets.forEach(function(n){const s=j.Objects.Geometry[n.geoID];void 0!==s&&i.genMorphGeometry(e,t,s,o,n.name)})})}genMorphGeometry(e,t,n,i,s){const r=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==n.Vertices?n.Vertices.a:[],c=void 0!==n.Indexes?n.Indexes.a:[],l=3*e.attributes.position.count,d=new Float32Array(l);for(let e=0;e<c.length;e++){const t=3*c[e];d[t]=a[3*e],d[t+1]=a[3*e+1],d[t+2]=a[3*e+2]}const h={vertexIndices:r,vertexPositions:d},u=this.genBuffers(h),p=new o.Float32BufferAttribute(u.vertex,3);p.name=s||n.attrName,p.applyMatrix4(i),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,o=e.Normals.a;let i=[];return"IndexToDirect"===n&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:o,indices:i,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,o=e.UV.a;let i=[];return"IndexToDirect"===n&&(i=e.UVIndex.a),{dataSize:2,buffer:o,indices:i,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a;let s=[];"IndexToDirect"===n&&(s=e.ColorIndex.a);for(let e=0,t=new o.Color;e<i.length;e+=4)t.fromArray(i,e).convertSRGBToLinear().toArray(i,e);return{dataSize:4,buffer:i,indices:s,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const o=e.Materials.a,i=[];for(let e=0;e<o.length;++e)i.push(e);return{dataSize:1,buffer:o,indices:i,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new o.BufferGeometry;const n=t-1,i=e.KnotVector.a,s=[],r=e.Points.a;for(let e=0,t=r.length;e<t;e+=4)s.push((new o.Vector4).fromArray(r,e));let a,c;if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form){a=n,c=i.length-1-a;for(let e=0;e<n;++e)s.push(s[e])}const l=new V(n,i,s,a,c).getPoints(12*s.length);return(new o.BufferGeometry).setFromPoints(l)}}class G{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const o=t[n],i=this.addClip(o);e.push(i)}return e}parseClips(){if(void 0===j.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=j.Objects.AnimationCurveNode,t=new Map;for(const n in e){const o=e[n];if(null!==o.attrName.match(/S|R|T|DeformPercent/)){const e={id:o.id,attr:o.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=j.Objects.AnimationCurve;for(const n in t){const o={id:t[n].id,times:t[n].KeyTime.a.map(Y),values:t[n].KeyValueFloat.a},i=B.get(o.id);if(void 0!==i){const t=i.parents[0].ID,n=i.parents[0].relationship;n.match(/X/)?e.get(t).curves.x=o:n.match(/Y/)?e.get(t).curves.y=o:n.match(/Z/)?e.get(t).curves.z=o:n.match(/DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=o)}}}parseAnimationLayers(e){const t=j.Objects.AnimationLayer,n=new Map;for(const i in t){const t=[],s=B.get(parseInt(i));void 0!==s&&(s.children.forEach(function(n,i){if(e.has(n.ID)){const s=e.get(n.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===t[i]){const e=B.get(n.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID;if(void 0!==e){const s=j.Objects.Model[e.toString()];if(void 0===s)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);const r={modelName:s.attrName?o.PropertyBinding.sanitizeNodeName(s.attrName):"",ID:s.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};K.traverse(function(e){e.ID===s.id&&(r.transform=e.matrix,e.userData.transformData&&(r.eulerOrder=e.userData.transformData.eulerOrder))}),r.transform||(r.transform=new o.Matrix4),"PreRotation"in s&&(r.preRotation=s.PreRotation.value),"PostRotation"in s&&(r.postRotation=s.PostRotation.value),t[i]=r}}t[i]&&(t[i][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===t[i]){const e=B.get(n.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,s=B.get(e).parents[0].ID,r=B.get(s).parents[0].ID,a=B.get(r).parents[0].ID,c=j.Objects.Model[a],l={modelName:c.attrName?o.PropertyBinding.sanitizeNodeName(c.attrName):"",morphName:j.Objects.Deformer[e].attrName};t[i]=l}t[i][s.attr]=s}}}),n.set(parseInt(i),t))}return n}parseAnimStacks(e){const t=j.Objects.AnimationStack,n={};for(const o in t){const i=B.get(parseInt(o)).children;i.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=e.get(i[0].ID);n[o]={name:t[o].attrName,layer:s}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(e){t=t.concat(n.generateTracks(e))}),new o.AnimationClip(e.name,-1,t)}generateTracks(e){const t=[];let n=new o.Vector3,i=new o.Vector3;if(e.transform&&e.transform.decompose(n,new o.Quaternion,i),n=n.toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==o&&t.push(o)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const n=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){const n=this.generateMorphTrack(e);void 0!==n&&t.push(n)}return t}generateVectorTrack(e,t,n,i){const s=this.getTimesForAllAxes(t),r=this.getKeyframeTrackValues(s,t,n);return new o.VectorKeyframeTrack(e+"."+i,s,r)}generateRotationTrack(e,t,n,i,s){let r,a;if(void 0!==t.x&&void 0!==t.y&&void 0!==t.z){const e=this.interpolateRotations(t.x,t.y,t.z,s);r=e[0],a=e[1]}void 0!==n&&((n=n.map(o.MathUtils.degToRad)).push(s),n=(new o.Euler).fromArray(n),n=(new o.Quaternion).setFromEuler(n)),void 0!==i&&((i=i.map(o.MathUtils.degToRad)).push(s),i=(new o.Euler).fromArray(i),i=(new o.Quaternion).setFromEuler(i).invert());const c=new o.Quaternion,l=new o.Euler,d=[];if(!a||!r)return new o.QuaternionKeyframeTrack(e+".quaternion",[0],[0]);for(let e=0;e<a.length;e+=3)l.set(a[e],a[e+1],a[e+2],s),c.setFromEuler(l),void 0!==n&&c.premultiply(n),void 0!==i&&c.multiply(i),e>2&&(new o.Quaternion).fromArray(d,(e-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w),c.toArray(d,e/3*4);return new o.QuaternionKeyframeTrack(e+".quaternion",r,d)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(e){return e/100}),i=K.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new o.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort(function(e,t){return e-t}),t.length>1){let e=1,n=t[0];for(let o=1;o<t.length;o++){const i=t[o];i!==n&&(t[e]=i,n=i,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const o=n,i=[];let s=-1,r=-1,a=-1;return e.forEach(function(e){if(t.x&&(s=t.x.times.indexOf(e)),t.y&&(r=t.y.times.indexOf(e)),t.z&&(a=t.z.times.indexOf(e)),-1!==s){const e=t.x.values[s];i.push(e),o[0]=e}else i.push(o[0]);if(-1!==r){const e=t.y.values[r];i.push(e),o[1]=e}else i.push(o[1]);if(-1!==a){const e=t.z.values[a];i.push(e),o[2]=e}else i.push(o[2])}),i}interpolateRotations(e,t,n,i){const s=[],r=[];s.push(e.times[0]),r.push(o.MathUtils.degToRad(e.values[0])),r.push(o.MathUtils.degToRad(t.values[0])),r.push(o.MathUtils.degToRad(n.values[0]));for(let a=1;a<e.values.length;a++){const c=[e.values[a-1],t.values[a-1],n.values[a-1]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;const l=c.map(o.MathUtils.degToRad),d=[e.values[a],t.values[a],n.values[a]];if(isNaN(d[0])||isNaN(d[1])||isNaN(d[2]))continue;const h=d.map(o.MathUtils.degToRad),u=[d[0]-c[0],d[1]-c[1],d[2]-c[2]],p=[Math.abs(u[0]),Math.abs(u[1]),Math.abs(u[2])];if(p[0]>=180||p[1]>=180||p[2]>=180){const t=Math.max(...p)/180,n=new o.Euler(...l,i),c=new o.Euler(...h,i),d=(new o.Quaternion).setFromEuler(n),u=(new o.Quaternion).setFromEuler(c);d.dot(u)&&u.set(-u.x,-u.y,-u.z,-u.w);const f=e.times[a-1],m=e.times[a]-f,y=new o.Quaternion,g=new o.Euler;for(let e=0;e<1;e+=1/t)y.copy(d.clone().slerp(u.clone(),e)),s.push(f+e*m),g.setFromQuaternion(y,i),r.push(g.x),r.push(g.y),r.push(g.z)}else s.push(e.times[a]),r.push(o.MathUtils.degToRad(e.values[a])),r.push(o.MathUtils.degToRad(t.values[a])),r.push(o.MathUtils.degToRad(n.values[a]))}return[s,r]}}class q{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new J,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(e,o){const i=e.match(/^[\s\t]*;/),s=e.match(/^[\s\t]*$/);if(i||s)return;const r=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),a=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=e.match("^\\t{"+(t.currentIndent-1)+"}}");r?t.parseNodeBegin(e,r):a?t.parseNodeProperty(e,a,n[++o]):c?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),o=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),i={name:n},s=this.parseNodeAttr(o),r=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in r?("PoseNode"===n?r.PoseNode.push(i):void 0!==r[n].id&&(r[n]={},r[n][r[n].id]=r[n]),""!==s.id&&(r[n][s.id]=i)):"number"==typeof s.id?(r[n]={},r[n][s.id]=i):"Properties70"!==n&&(r[n]="PoseNode"===n?[i]:i),"number"==typeof s.id&&(i.id=s.id),""!==s.name&&(i.attrName=s.name),""!==s.type&&(i.attrType=s.type),this.pushStack(i)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",o="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),o=e[2]),{id:t,name:n,type:o}}parseNodeProperty(e,t,n){let o=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===o&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if("Properties70"!==s.name){if("C"===o){const e=i.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let r=i.split(",").slice(3);r=r.map(function(e){return e.trim().replace(/^"/,"")}),o="connections",i=[t,n],function(e,t){for(let n=0,o=e.length,i=t.length;n<i;n++,o++)e[o]=t[n]}(i,r),void 0===s[o]&&(s[o]=[])}"Node"===o&&(s.id=i),o in s&&Array.isArray(s[o])?s[o].push(i):"a"!==o?s[o]=i:s.a=i,this.setCurrentProp(s,o),"a"===o&&","!==i.slice(-1)&&(s.a=ie(i))}else this.parseNodeSpecialProperty(e,o,i)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=ie(t.a))}parseNodeSpecialProperty(e,t,n){const o=n.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),i=o[0],s=o[1],r=o[2],a=o[3];let c=o[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=ie(c)}this.getPrevNode()[i]={type:s,type2:r,flag:a,value:c},this.setCurrentProp(this.getPrevNode(),i)}}class X{parse(e){const t=new W(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const o=new J;for(;!this.endOfContent(t);){const e=this.parseNode(t,n);null!==e&&o.add(e.name,e)}return o}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},o=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const s=e.getUint8(),r=e.getString(s);if(0===o)return null;const a=[];for(let t=0;t<i;t++)a.push(this.parseProperty(e));const c=a.length>0?a[0]:"",l=a.length>1?a[1]:"",d=a.length>2?a[2]:"";for(n.singleProperty=1===i&&e.getOffset()===o;o>e.getOffset();){const o=this.parseNode(e,t);null!==o&&this.parseSubNode(r,n,o)}return n.propertyList=a,"number"==typeof c&&(n.id=c),""!==l&&(n.attrName=l),""!==d&&(n.attrType=d),""!==r&&(n.name=r),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach(function(t,n){0!==n&&e.push(t)}),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name)Object.keys(n).forEach(function(e){t[e]=n[e]});else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],o=n.propertyList[1];const i=n.propertyList[2],s=n.propertyList[3];let r;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),r="Color"===o||"ColorRGB"===o||"Vector"===o||"Vector3D"===o||0===o.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:o,type2:i,flag:s,value:r}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const o=e.getUint32(),i=e.getUint32(),s=e.getUint32();if(0===i)switch(t){case"b":case"c":return e.getBooleanArray(o);case"d":return e.getFloat64Array(o);case"f":return e.getFloat32Array(o);case"i":return e.getInt32Array(o);case"l":return e.getInt64Array(o)}const r=S(new Uint8Array(e.getArrayBuffer(s))),a=new W(r.buffer);switch(t){case"b":case"c":return a.getBooleanArray(o);case"d":return a.getFloat64Array(o);case"f":return a.getFloat32Array(o);case"i":return a.getInt32Array(o);case"l":return a.getInt64Array(o)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class W{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const o=n.indexOf(0);return o>=0&&(n=new Uint8Array(this.dv.buffer,t,o)),this._textDecoder.decode(n)}}class J{add(e,t){this[e]=t}}function Z(e){const t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Y(e){return e/46186158e3}const Q=[];function $(e,t,n,o){let i;switch(o.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=n;break;case"AllSame":i=o.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+o.mappingType)}"IndexToDirect"===o.referenceType&&(i=o.indices[i]);const s=i*o.dataSize,r=s+o.dataSize;return function(e,t,n,o){for(let i=n,s=0;i<o;i++,s++)e[s]=t[i];return e}(Q,o.buffer,s,r)}const ee=new o.Euler,te=new o.Vector3;function ne(e){const t=new o.Matrix4,n=new o.Matrix4,i=new o.Matrix4,s=new o.Matrix4,r=new o.Matrix4,a=new o.Matrix4,c=new o.Matrix4,l=new o.Matrix4,d=new o.Matrix4,h=new o.Matrix4,u=new o.Matrix4,p=new o.Matrix4,f=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(te.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(o.MathUtils.degToRad);t.push(e.eulerOrder||o.Euler.DEFAULT_ORDER),n.makeRotationFromEuler(ee.fromArray(t))}if(e.rotation){const t=e.rotation.map(o.MathUtils.degToRad);t.push(e.eulerOrder||o.Euler.DEFAULT_ORDER),i.makeRotationFromEuler(ee.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(o.MathUtils.degToRad);t.push(e.eulerOrder||o.Euler.DEFAULT_ORDER),s.makeRotationFromEuler(ee.fromArray(t)),s.invert()}e.scale&&r.scale(te.fromArray(e.scale)),e.scalingOffset&&c.setPosition(te.fromArray(e.scalingOffset)),e.scalingPivot&&a.setPosition(te.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(te.fromArray(e.rotationOffset)),e.rotationPivot&&d.setPosition(te.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(u.copy(e.parentMatrix),h.copy(e.parentMatrixWorld));const m=n.clone().multiply(i).multiply(s),y=new o.Matrix4;y.extractRotation(h);const g=new o.Matrix4;g.copyPosition(h);const v=g.clone().invert().multiply(h),b=y.clone().invert().multiply(v),w=r,x=new o.Matrix4;if(0===f)x.copy(y).multiply(m).multiply(b).multiply(w);else if(1===f)x.copy(y).multiply(b).multiply(m).multiply(w);else{const e=(new o.Matrix4).scale((new o.Vector3).setFromMatrixScale(u)).clone().invert(),t=b.clone().multiply(e);x.copy(y).multiply(m).multiply(t).multiply(w)}const k=d.clone().invert(),E=a.clone().invert();let A=t.clone().multiply(l).multiply(d).multiply(n).multiply(i).multiply(s).multiply(k).multiply(c).multiply(a).multiply(r).multiply(E);const T=(new o.Matrix4).copyPosition(A),N=h.clone().multiply(T);return p.copyPosition(N),A=p.clone().multiply(x),A.premultiply(h.invert()),A}function oe(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function ie(e){return e.split(",").map(function(e){return parseFloat(e)})}function se(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),(new TextDecoder).decode(new Uint8Array(e,t,n))}THREE.FBXLoader=z,AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){const e=this.data;if(!e.src)return;this.remove();const t=new THREE.FBXLoader;e.crossorigin&&t.setCrossOrigin(e.crossorigin),t.load(e.src,this.load.bind(this))},load:function(e){this.model=e,this.el.setObject3D("mesh",e),this.el.emit("model-loaded",{format:"fbx",model:e})},remove:function(){this.model&&this.el.removeObject3D("mesh")}}),n(144)},464:e=>{window,e.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var o,i=function(e,t){var n=t.x-e.x,o=t.y-e.y;return Math.sqrt(n*n+o*o)},s=function(e){return e*(Math.PI/180)},r=new Map,a=function(e){r.has(e)&&clearTimeout(r.get(e)),r.set(e,setTimeout(e,100))},c=function(e,t,n){for(var o,i=t.split(/[ ,]+/g),s=0;s<i.length;s+=1)o=i[s],e.addEventListener?e.addEventListener(o,n,!1):e.attachEvent&&e.attachEvent(o,n)},l=function(e,t,n){for(var o,i=t.split(/[ ,]+/g),s=0;s<i.length;s+=1)o=i[s],e.removeEventListener?e.removeEventListener(o,n):e.detachEvent&&e.detachEvent(o,n)},d=function(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e},h=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},u=function(e,t){t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},p=function(e,t,n){var o=f(e);for(var i in o)if(o.hasOwnProperty(i))if("string"==typeof t)o[i]=t+" "+n;else{for(var s="",r=0,a=t.length;r<a;r+=1)s+=t[r]+" "+n+", ";o[i]=s.slice(0,-2)}return o},f=function(e){var t={};return t[e]="",["webkit","Moz","o"].forEach(function(n){t[n+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},m=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},y=function(e,t){if(e.length)for(var n=0,o=e.length;n<o;n+=1)t(e[n]);else t(e)},g=!!("ontouchstart"in window),v=!!window.PointerEvent,b=!!window.MSPointerEvent,w={start:"mousedown",move:"mousemove",end:"mouseup"},x={};function k(){}v?o={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:b?o={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:g?(o={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},x=w):o=w,k.prototype.on=function(e,t){var n,o=e.split(/[ ,]+/g);this._handlers_=this._handlers_||{};for(var i=0;i<o.length;i+=1)n=o[i],this._handlers_[n]=this._handlers_[n]||[],this._handlers_[n].push(t);return this},k.prototype.off=function(e,t){return this._handlers_=this._handlers_||{},void 0===e?this._handlers_={}:void 0===t?this._handlers_[e]=null:this._handlers_[e]&&this._handlers_[e].indexOf(t)>=0&&this._handlers_[e].splice(this._handlers_[e].indexOf(t),1),this},k.prototype.trigger=function(e,t){var n,o=this,i=e.split(/[ ,]+/g);o._handlers_=o._handlers_||{};for(var s=0;s<i.length;s+=1)n=i[s],o._handlers_[n]&&o._handlers_[n].length&&o._handlers_[n].forEach(function(e){e.call(o,{type:n,target:o},t)})},k.prototype.config=function(e){this.options=this.defaults||{},e&&(this.options=function(e,t){var n={};for(var o in e)e.hasOwnProperty(o)&&t.hasOwnProperty(o)?n[o]=t[o]:e.hasOwnProperty(o)&&(n[o]=e[o]);return n}(this.options,e))},k.prototype.bindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[t]=function(){"function"==typeof n["on"+t]?n["on"+t].apply(n,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},c(e,o[t],n._domHandlers_[t]),x[t]&&c(e,x[t],n._domHandlers_[t]),n},k.prototype.unbindEvt=function(e,t){return this._domHandlers_=this._domHandlers_||{},l(e,o[t],this._domHandlers_[t]),x[t]&&l(e,x[t],this._domHandlers_[t]),delete this._domHandlers_[t],this};var E=k;function A(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=A.id,A.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}A.prototype=new E,A.constructor=A,A.id=0,A.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},A.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=function(){var e=f("borderRadius");for(var t in e)e.hasOwnProperty(t)&&(e[t]="50%");return e}(),n=p("transition","opacity",e),o={};return o.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},o.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},o.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},m(o.el,n),"circle"===this.options.shape&&m(o.back,t),m(o.front,t),this.applyStyles(o),this},A.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var n in e[t])this.ui[t].style[n]=e[t][n];return this},A.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},A.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},A.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},A.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)},t.options.fadeTime)),t},A.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var n="dynamic"===t.options.mode?"none":"block";t.ui.el.style.display=n,"function"==typeof e&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){var n=t.options.restJoystick,o={};o.x=!0===n||!1!==n.x?0:t.instance.frontPosition.x,o.y=!0===n||!1!==n.y?0:t.instance.frontPosition.y,t.setPosition(e,o)}return t},A.prototype.setPosition=function(e,t){var n=this;n.frontPosition={x:t.x,y:t.y};var o=n.options.fadeTime+"ms",i={};i.front=p("transition",["transform"],o);var s={front:{}};s.front={transform:"translate("+n.frontPosition.x+"px,"+n.frontPosition.y+"px)"},n.applyStyles(i),n.applyStyles(s),n.restTimeout=setTimeout(function(){"function"==typeof e&&e.call(n),n.restCallback()},n.options.fadeTime)},A.prototype.restCallback=function(){var e={};e.front=p("transition","none",""),this.applyStyles(e),this.trigger("rested",this.instance)},A.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},A.prototype.computeDirection=function(e){var t,n,o,i=e.angle.radian,s=Math.PI/4,r=Math.PI/2;if(i>s&&i<3*s&&!e.lockX?t="up":i>-s&&i<=s&&!e.lockY?t="left":i>3*-s&&i<=-s&&!e.lockX?t="down":e.lockY||(t="right"),e.lockY||(n=i>-r&&i<r?"left":"right"),e.lockX||(o=i>0?"up":"down"),e.force>this.options.threshold){var a,c={};for(a in this.direction)this.direction.hasOwnProperty(a)&&(c[a]=this.direction[a]);var l={};for(a in this.direction={x:n,y:o,angle:t},e.direction=this.direction,c)c[a]===this.direction[a]&&(l[a]=!0);if(l.x&&l.y&&l.angle)return e;l.x&&l.y||this.trigger("plain",e),l.x||this.trigger("plain:"+n,e),l.y||this.trigger("plain:"+o,e),l.angle||this.trigger("dir dir:"+t,e)}else this.resetDirection();return e};var T=A;function N(e,t){this.nipples=[],this.idles=[],this.actives=[],this.ids=[],this.pressureIntervals={},this.manager=e,this.id=N.id,N.id+=1,this.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},this.config(t),"static"!==this.options.mode&&"semi"!==this.options.mode||(this.options.multitouch=!1),this.options.multitouch||(this.options.maxNumberOfNipples=1);var n=getComputedStyle(this.options.zone.parentElement);return n&&"flex"===n.display&&(this.parentIsFlex=!0),this.updateBox(),this.prepareNipples(),this.bindings(),this.begin(),this.nipples}N.prototype=new E,N.constructor=N,N.id=0,N.prototype.prepareNipples=function(){var e=this.nipples;e.on=this.on.bind(this),e.off=this.off.bind(this),e.options=this.options,e.destroy=this.destroy.bind(this),e.ids=this.ids,e.id=this.id,e.processOnMove=this.processOnMove.bind(this),e.processOnEnd=this.processOnEnd.bind(this),e.get=function(t){if(void 0===t)return e[0];for(var n=0,o=e.length;n<o;n+=1)if(e[n].identifier===t)return e[n];return!1}},N.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},N.prototype.begin=function(){var e=this.options;if("static"===e.mode){var t=this.createNipple(e.position,this.manager.getIdentifier());t.add(),this.idles.push(t)}},N.prototype.createNipple=function(e,t){var n=this.manager.scroll,o={},i=this.options,s=this.parentIsFlex?n.x:n.x+this.box.left,r=this.parentIsFlex?n.y:n.y+this.box.top;if(e.x&&e.y)o={x:e.x-s,y:e.y-r};else if(e.top||e.right||e.bottom||e.left){var a=document.createElement("DIV");a.style.display="hidden",a.style.top=e.top,a.style.right=e.right,a.style.bottom=e.bottom,a.style.left=e.left,a.style.position="absolute",i.zone.appendChild(a);var c=a.getBoundingClientRect();i.zone.removeChild(a),o=e,e={x:c.left+n.x,y:c.top+n.y}}var l=new T(this,{color:i.color,size:i.size,threshold:i.threshold,fadeTime:i.fadeTime,dataOnly:i.dataOnly,restJoystick:i.restJoystick,restOpacity:i.restOpacity,mode:i.mode,identifier:t,position:e,zone:i.zone,frontPosition:{x:0,y:0},shape:i.shape});return i.dataOnly||(u(l.ui.el,o),u(l.ui.front,l.frontPosition)),this.nipples.push(l),this.trigger("added "+l.identifier+":added",l),this.manager.trigger("added "+l.identifier+":added",l),this.bindNipple(l),l},N.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},N.prototype.bindNipple=function(e){var t,n=this,o=function(e,o){t=e.type+" "+o.id+":"+e.type,n.trigger(t,o)};e.on("destroyed",n.onDestroyed.bind(n)),e.on("shown hidden rested dir plain",o),e.on("dir:up dir:right dir:down dir:left",o),e.on("plain:up plain:right plain:down plain:left",o)},N.prototype.pressureFn=function(e,t,n){var o=this,i=0;clearInterval(o.pressureIntervals[n]),o.pressureIntervals[n]=setInterval(function(){var n=e.force||e.pressure||e.webkitForce||0;n!==i&&(t.trigger("pressure",n),o.trigger("pressure "+t.identifier+":pressure",n),i=n)}.bind(o),100)},N.prototype.onstart=function(e){var t=this,n=t.options,o=e;return e=d(e),t.updateBox(),y(e,function(i){t.actives.length<n.maxNumberOfNipples?t.processOnStart(i):o.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(n){if(Object.values(o.touches).findIndex(function(e){return e.identifier===n})<0){var i=[e[0]];i.identifier=n,t.processOnEnd(i)}}),t.actives.length<n.maxNumberOfNipples&&t.processOnStart(i))}),t.manager.bindDocument(),!1},N.prototype.processOnStart=function(e){var t,n=this,o=n.options,s=n.manager.getIdentifier(e),r=e.force||e.pressure||e.webkitForce||0,a={x:e.pageX,y:e.pageY},c=n.getOrCreate(s,a);c.identifier!==s&&n.manager.removeIdentifier(c.identifier),c.identifier=s;var l=function(t){t.trigger("start",t),n.trigger("start "+t.id+":start",t),t.show(),r>0&&n.pressureFn(e,t,t.identifier),n.processOnMove(e)};if((t=n.idles.indexOf(c))>=0&&n.idles.splice(t,1),n.actives.push(c),n.ids.push(c.identifier),"semi"!==o.mode)l(c);else{if(!(i(a,c.position)<=o.catchDistance))return c.destroy(),void n.processOnStart(e);l(c)}return c},N.prototype.getOrCreate=function(e,t){var n,o=this.options;return/(semi|static)/.test(o.mode)?(n=this.idles[0])?(this.idles.splice(0,1),n):"semi"===o.mode?this.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):n=this.createNipple(t,e)},N.prototype.processOnMove=function(e){var t=this.options,n=this.manager.getIdentifier(e),o=this.nipples.get(n),r=this.manager.scroll;if(function(e){return isNaN(e.buttons)?0!==e.pressure:0!==e.buttons}(e)){if(!o)return console.error("Found zombie joystick with ID "+n),void this.manager.removeIdentifier(n);if(t.dynamicPage){var a=o.el.getBoundingClientRect();o.position={x:r.x+a.left,y:r.y+a.top}}o.identifier=n;var c=o.options.size/2,l={x:e.pageX,y:e.pageY};t.lockX&&(l.y=o.position.y),t.lockY&&(l.x=o.position.x);var d,h,u,p,f,m,y,g,v,b,w=i(l,o.position),x=(d=l,u=(h=o.position).x-d.x,p=h.y-d.y,function(e){return e*(180/Math.PI)}(Math.atan2(p,u))),k=s(x),E=w/c,A={distance:w,position:l};if("circle"===o.options.shape?(f=Math.min(w,c),y=o.position,g=f,b={x:0,y:0},v=s(v=x),b.x=y.x-g*Math.cos(v),b.y=y.y-g*Math.sin(v),m=b):(m=function(e,t,n){return{x:Math.min(Math.max(e.x,t.x-n),t.x+n),y:Math.min(Math.max(e.y,t.y-n),t.y+n)}}(l,o.position,c),f=i(m,o.position)),t.follow){if(w>c){var T=l.x-m.x,N=l.y-m.y;o.position.x+=T,o.position.y+=N,o.el.style.top=o.position.y-(this.box.top+r.y)+"px",o.el.style.left=o.position.x-(this.box.left+r.x)+"px",w=i(l,o.position)}}else l=m,w=f;var M=l.x-o.position.x,C=l.y-o.position.y;o.frontPosition={x:M,y:C},t.dataOnly||(o.ui.front.style.transform="translate("+M+"px,"+C+"px)");var D={identifier:o.identifier,position:l,force:E,pressure:e.force||e.pressure||e.webkitForce||0,distance:w,angle:{radian:k,degree:x},vector:{x:M/c,y:-C/c},raw:A,instance:o,lockX:t.lockX,lockY:t.lockY};(D=o.computeDirection(D)).angle={radian:s(180-x),degree:180-x},o.trigger("move",D),this.trigger("move "+o.id+":move",D)}else this.processOnEnd(e)},N.prototype.processOnEnd=function(e){var t=this,n=t.options,o=t.manager.getIdentifier(e),i=t.nipples.get(o),s=t.manager.removeIdentifier(i.identifier);i&&(n.dataOnly||i.hide(function(){"dynamic"===n.mode&&(i.trigger("removed",i),t.trigger("removed "+i.id+":removed",i),t.manager.trigger("removed "+i.id+":removed",i),i.destroy())}),clearInterval(t.pressureIntervals[i.identifier]),i.resetDirection(),i.trigger("end",i),t.trigger("end "+i.id+":end",i),t.ids.indexOf(i.identifier)>=0&&t.ids.splice(t.ids.indexOf(i.identifier),1),t.actives.indexOf(i)>=0&&t.actives.splice(t.actives.indexOf(i),1),/(semi|static)/.test(n.mode)?t.idles.push(i):t.nipples.indexOf(i)>=0&&t.nipples.splice(t.nipples.indexOf(i),1),t.manager.unbindDocument(),/(semi|static)/.test(n.mode)&&(t.manager.ids[s.id]=s.identifier))},N.prototype.onDestroyed=function(e,t){this.nipples.indexOf(t)>=0&&this.nipples.splice(this.nipples.indexOf(t),1),this.actives.indexOf(t)>=0&&this.actives.splice(this.actives.indexOf(t),1),this.idles.indexOf(t)>=0&&this.idles.splice(this.idles.indexOf(t),1),this.ids.indexOf(t.identifier)>=0&&this.ids.splice(this.ids.indexOf(t.identifier),1),this.manager.removeIdentifier(t.identifier),this.manager.unbindDocument()},N.prototype.destroy=function(){for(var e in this.unbindEvt(this.options.zone,"start"),this.nipples.forEach(function(e){e.destroy()}),this.pressureIntervals)this.pressureIntervals.hasOwnProperty(e)&&clearInterval(this.pressureIntervals[e]);this.trigger("destroyed",this.nipples),this.manager.unbindDocument(),this.off()};var M=N;function C(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=h(),t.config(e),t.prepareCollections();var n=function(){var e;t.collections.forEach(function(n){n.forEach(function(n){e=n.el.getBoundingClientRect(),n.position={x:t.scroll.x+e.left,y:t.scroll.y+e.top}})})};c(window,"resize",function(){a(n)});var o=function(){t.scroll=h()};return c(window,"scroll",function(){a(o)}),t.collections}C.prototype=new E,C.constructor=C,C.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var n;return e.collections.every(function(e){return!(n=e.get(t))}),n}},C.prototype.create=function(e){return this.createCollection(e)},C.prototype.createCollection=function(e){var t=new M(this,e);return this.bindCollection(t),this.collections.push(t),t},C.prototype.bindCollection=function(e){var t,n=this,o=function(e,o){t=e.type+" "+o.id+":"+e.type,n.trigger(t,o)};e.on("destroyed",n.onDestroyed.bind(n)),e.on("shown hidden rested dir plain",o),e.on("dir:up dir:right dir:down dir:left",o),e.on("plain:up plain:right plain:down plain:left",o)},C.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},C.prototype.unbindDocument=function(e){Object.keys(this.ids).length&&!0!==e||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},C.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},C.prototype.removeIdentifier=function(e){var t={};for(var n in this.ids)if(this.ids[n]===e){t.id=n,t.identifier=this.ids[n],delete this.ids[n];break}return t},C.prototype.onmove=function(e){return this.onAny("move",e),!1},C.prototype.onend=function(e){return this.onAny("end",e),!1},C.prototype.oncancel=function(e){return this.onAny("end",e),!1},C.prototype.onAny=function(e,t){var n,o=this,i="processOn"+e.charAt(0).toUpperCase()+e.slice(1);return t=d(t),y(t,function(e){n=o.getIdentifier(e),y(o.collections,function(e,t,n){n.ids.indexOf(t)>=0&&(n[i](e),e._found_=!0)}.bind(null,e,n)),e._found_||o.removeIdentifier(n)}),!1},C.prototype.destroy=function(){this.unbindDocument(!0),this.ids={},this.index=0,this.collections.forEach(function(e){e.destroy()}),this.off()},C.prototype.onDestroyed=function(e,t){if(this.collections.indexOf(t)<0)return!1;this.collections.splice(this.collections.indexOf(t),1)};var D=new C;t.default={create:function(e){return D.create(e)},factory:D}}]).default},537:()=>{const e="-controls";AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){const e=this.el;this.data.camera||(this.data.camera=e.querySelector("[camera]")),this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.eventDetail={},this.navGroup=null,this.navNode=null,e.sceneEl.hasLoaded?this.injectControls():e.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(t){const n=this.el,o=this.data,i=n.sceneEl.systems.nav;if(n.sceneEl.hasLoaded&&this.injectControls(),i&&o.constrainToNavMesh!==t.constrainToNavMesh&&(o.constrainToNavMesh?i.addAgent(this):i.removeAgent(this)),o.enabled!==t.enabled)for(let t=0;t<o.controls.length;t++){const n=o.controls[t]+e;this.el.setAttribute(n,{enabled:this.data.enabled})}},injectControls:function(){const t=this.data;for(let n=0;n<t.controls.length;n++){const o=t.controls[n]+e;this.el.setAttribute(o,{enabled:this.data.enabled})}},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:function(){const e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(o,i){if(!i)return;const s=this.el,r=this.data;if(!r.enabled)return;this.updateVelocityCtrl();const a=this.velocityCtrl,c=this.velocity;if(a)if(i/1e3>.2?c.set(0,0,0):this.updateVelocity(i),r.constrainToNavMesh&&!1!==a.isNavMeshConstrained){if(c.lengthSq()<1e-5)return;e.copy(s.object3D.position),t.copy(c).multiplyScalar(i/1e3).add(e);const o=s.sceneEl.systems.nav;this.navGroup=null===this.navGroup?o.getGroup(e):this.navGroup,this.navNode=this.navNode||o.getNode(e,this.navGroup),this.navNode=o.clampStep(e,t,this.navGroup,this.navNode,n),s.object3D.position.copy(n)}else s.hasAttribute("velocity")?s.setAttribute("velocity",c):(s.object3D.position.x+=c.x*i/1e3,s.object3D.position.y+=c.y*i/1e3,s.object3D.position.z+=c.z*i/1e3)}}(),updateVelocityCtrl:function(){const t=this.data;if(t.enabled){for(let n=0,o=t.controls.length;n<o;n++){const o=this.el.components[t.controls[n]+e];if(o&&o.isVelocityActive())return void(this.velocityCtrl=o)}this.velocityCtrl=null}},updateVelocity:function(){const e=new THREE.Vector2,t=new THREE.Quaternion;return function(n){let o;const i=this.el,s=this.velocityCtrl,r=this.velocity,a=this.data;if(s){if(!s.getVelocityDelta){if(s.getVelocity)return void r.copy(s.getVelocity());if(s.getPositionDelta)return void r.copy(s.getPositionDelta(n).multiplyScalar(1e3/n));throw new Error("Incompatible movement controls: ",s)}o=s.getVelocityDelta(n)}if(i.hasAttribute("velocity")&&!a.constrainToNavMesh&&r.copy(this.el.getAttribute("velocity")),o&&a.enabled){const n=a.camera;t.copy(n.object3D.quaternion),t.premultiply(i.object3D.quaternion),o.applyQuaternion(t);const s=o.length();a.fly?(r.copy(o),r.multiplyScalar(16.66667*this.data.speed)):(e.set(o.x,o.z),e.setLength(s*this.data.speed*16.66667),r.x=e.x,r.y=0,r.z=e.y),0===r.x&&0===r.y&&0===r.z||(this.eventDetail.velocity=r,this.el.emit("moved",this.eventDetail))}}}()})},539:()=>{AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}}),AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){const e=this.el,t=this.data;let n=e.components.material;if(!t.path.length)return void console.error("[a-tube] `path` property expected but not found.");const o=new THREE.CatmullRomCurve3(t.path.map(function(e){return e=e.split(" "),new THREE.Vector3(Number(e[0]),Number(e[1]),Number(e[2]))})),i=new THREE.TubeGeometry(o,t.segments,t.radius,t.radialSegments,t.closed);n||(n={},n.material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(i,n.material),this.el.setObject3D("mesh",this.mesh)},update:function(e){Object.keys(e).length&&(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}})},612:t=>{"use strict";t.exports=e},653:(e,t,n)=>{"use strict";n(95),n(889),n(771),n(778),n(109)},683:()=>{AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}}),AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){const e=this.el,t=this.data;let n=e.components.material;const o=new THREE.PlaneGeometry(t.width,t.depth,t.density,t.density);this.waves=[];const i=o.getAttribute("position");for(let e=0;e<i.count;e++)this.waves.push({z:i.getZ(e),ang:Math.random()*Math.PI*2,amp:t.amplitude+Math.random()*t.amplitudeVariance,speed:(t.speed+Math.random()*t.speedVariance)/1e3});n||(n={},n.material=new THREE.MeshPhongMaterial({color:t.color,transparent:t.opacity<1,opacity:t.opacity,flatShading:!0})),this.mesh=new THREE.Mesh(o,n.material),e.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(e,t){if(!t)return;const n=this.mesh.geometry.getAttribute("position");for(let e=0;e<n.count;e++){const o=this.waves[e],i=o.z+Math.sin(o.ang)*o.amp;n.setZ(e,i),o.ang+=o.speed*t}n.needsUpdate=!0}})},711:(e,t,n)=>{"use strict";n(785),n(683),n(539)},771:()=>{AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){const e=this.el;e.addEventListener("hit",this.onHit),e.addEventListener("gripdown",this.onGripClose),e.addEventListener("gripup",this.onGripOpen),e.addEventListener("trackpaddown",this.onGripClose),e.addEventListener("trackpadup",this.onGripOpen),e.addEventListener("triggerdown",this.onGripClose),e.addEventListener("triggerup",this.onGripOpen)},pause:function(){const e=this.el;e.removeEventListener("hit",this.onHit),e.removeEventListener("gripdown",this.onGripClose),e.removeEventListener("gripup",this.onGripOpen),e.removeEventListener("trackpaddown",this.onGripClose),e.removeEventListener("trackpadup",this.onGripOpen),e.removeEventListener("triggerdown",this.onGripClose),e.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){const e=this.hitEl;this.grabbing=!1,e&&(e.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(e){const t=e.detail.el;t.is(this.GRABBED_STATE)||!this.grabbing||this.hitEl||(t.addState(this.GRABBED_STATE),this.hitEl=t,this.constraint=new CANNON.LockConstraint(this.el.body,t.body),this.system.addConstraint(this.constraint))}})},778:()=>{AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial),this.applyMaterial()},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){this.el.object3D.traverse(e=>{e.isMesh&&(e.material=this.material)})}})},785:()=>{AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}})},804:()=>{AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(e){const t=this.el;this.active&&this.checkpoint!==e&&(this.checkpoint&&t.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=e,this.sync(),this.position.distanceTo(this.targetPosition)<.1?this.checkpoint=null:(t.emit("navigation-start",{checkpoint:e}),"teleport"===this.data.mode&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,t.emit("navigation-end",{checkpoint:e}),t.components["movement-controls"].updateNavLocation())))},isVelocityActive:function(){return!(!this.active||!this.checkpoint)},getVelocity:function(){if(!this.active)return;const e=this.data,t=this.offset,n=this.position,o=this.targetPosition,i=this.checkpoint;return this.sync(),n.distanceTo(o)<.1?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:i}),t.set(0,0,0)):(t.setLength(e.animateSpeed),t)},sync:function(){const e=this.offset,t=this.position,n=this.targetPosition;t.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(n),n.add(this.checkpoint.components.checkpoint.getOffset()),e.copy(n).sub(t)}})},822:()=>{AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){const e=this.data,t=this.el.sceneEl;switch(t.addEventListener("axismove",this.onAxisMove),e.mode){case"swipe":case"touch":t.addEventListener("trackpadtouchstart",this.onTouchStart),t.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":t.addEventListener("trackpaddown",this.onTouchStart),t.addEventListener("trackpadup",this.onTouchEnd)}},removeEventListeners:function(){const e=this.el.sceneEl;e.removeEventListener("axismove",this.onAxisMove),e.removeEventListener("trackpadtouchstart",this.onTouchStart),e.removeEventListener("trackpadtouchend",this.onTouchEnd),e.removeEventListener("trackpaddown",this.onTouchStart),e.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(e){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":case"press":this.isMoving=!0}e.preventDefault()},onTouchEnd:function(e){"swipe"==this.data.mode&&(this.startingAxisData=[]),this.isMoving=!1,e.preventDefault()},onAxisMove:function(e){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(e);case"touch":case"press":return this.handleTouchAxis(e)}},handleSwipeAxis:function(e){const t=this.data,n=e.detail.axis;if(0===this.startingAxisData.length&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=n[0],this.startingAxisData[1]=n[1]),this.startingAxisData.length>0){let e=0,o=0;t.enableNegX&&n[0]<this.startingAxisData[0]&&(e=-1),t.enablePosX&&n[0]>this.startingAxisData[0]&&(e=1),t.enablePosZ&&n[1]>this.startingAxisData[1]&&(o=-1),t.enableNegZ&&n[1]<this.startingAxisData[1]&&(o=1);const i=Math.abs(this.startingAxisData[1]-n[1]);Math.abs(this.startingAxisData[0]-n[0])>i?(this.zVel=0,this.xVel=e,this.isMoving=!0):(this.xVel=0,this.zVel=o,this.isMoving=!0)}},handleTouchAxis:function(e){const t=this.data,n=e.detail.axis;let o=0,i=0;t.enableNegX&&n[0]<0&&(o=-1),t.enablePosX&&n[0]>0&&(o=1),t.enablePosZ&&n[1]>0&&(i=-1),t.enableNegZ&&n[1]<0&&(i=1),Math.abs(n[0])>Math.abs(n[1])?(this.zVel=0,this.xVel=o):(this.xVel=0,this.zVel=i)}})},866:()=>{AFRAME.registerComponent("nav-mesh",{schema:{nodeName:{type:"string"}},init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.nodeName=this.data.nodeName,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){var e=this;const t=this.el.getObject3D("mesh");if(this.el.sceneEl.object3D,!t)return;let n;if(t.traverse(t=>{!t.isMesh||e.nodeName&&t.name!==e.nodeName||(n=t)}),!n)return;const o=n.geometry.clone();n.updateWorldMatrix(!0,!1),o.applyMatrix4(n.matrixWorld),this.system.setNavMeshGeometry(o),this.hasLoadedNavMesh=!0}})},889:()=>{function e(e,t,n,o){e&&(t=t||[],e.traverse(e=>{var i;e.isMesh&&((i=e.material)?Array.isArray(i)?i:i.materials?i.materials:[i]:[]).forEach(e=>{e&&!("envMap"in e)||t.length&&-1===t.indexOf(e.name)||(e.envMap=n,e.reflectivity=o,e.needsUpdate=!0)})}))}AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){const t=this.data;this.texture=(new THREE.CubeTextureLoader).load([t.path+"posx."+t.extension,t.path+"negx."+t.extension,t.path+"posy."+t.extension,t.path+"negy."+t.extension,t.path+"posz."+t.extension,t.path+"negz."+t.extension]),this.texture.format=THREE.RGBAFormat,this.object3dsetHandler=()=>{const t=this.el.getObject3D("mesh"),n=this.data;e(t,n.materials,this.texture,n.reflectivity)},this.object3dsetHandler(),this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(t){const n=this.data,o=this.el.getObject3D("mesh");let i=[],s=[];if(n.materials.length&&(t.materials?(i=n.materials.filter(e=>!t.materials.includes(e)),s=t.materials.filter(e=>!n.materials.includes(e))):i=n.materials),i.length&&e(o,i,this.texture,n.reflectivity),s.length&&e(o,s,null,1),t.materials&&n.reflectivity!==t.reflectivity){const i=n.materials.filter(e=>t.materials.includes(e));i.length&&e(o,i,this.texture,n.reflectivity)}this.data.enableBackground&&!t.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&t.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);const t=this.el.getObject3D("mesh"),n=this.data;e(t,n.materials,null,1),n.enableBackground&&this.setBackground(null)},setBackground:function(e){this.el.sceneEl.object3D.background=e}})},914:(e,t,n)=>{"use strict";n(804);const o=Object.assign(function(){},{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16}),i=function(e,t,n){this.type=e,this.index=t,this.pressed=n.pressed,this.value=n.value},s=.2,r="left",a="right";AFRAME.registerComponent("gamepad-controls",{GamepadButton:o,schema:{enabled:{default:!0},rotationSensitivity:{default:2}},init:function(){const e=this.el.sceneEl;this.system=e.systems["tracked-controls"]||e.systems["tracked-controls-webxr"]||{controllers:[]},this.prevTime=window.performance.now(),this.buttons={};const t=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=t.x,this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=t.y,this.yaw.add(this.pitch),this._lookVector=new THREE.Vector2,this._moveVector=new THREE.Vector2,this._dpadVector=new THREE.Vector2,e.addBehavior(this)},update:function(){this.tick()},tick:function(e,t){this.updateButtonState(),this.updateRotation(t)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const e=this._dpadVector,t=this._moveVector;this.getDpad(e),this.getJoystick(1,t);const n=e.x||t.x,o=e.y||t.y;return Math.abs(n)>s||Math.abs(o)>s},getVelocityDelta:function(){const e=this._dpadVector,t=this._moveVector;this.getDpad(e),this.getJoystick(1,t);const n=e.x||t.x,o=e.y||t.y,i=new THREE.Vector3;return Math.abs(n)>s&&(i.x+=n),Math.abs(o)>s&&(i.z+=o),i},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;const e=this._lookVector;return this.getJoystick(2,e),Math.abs(e.x)>s||Math.abs(e.y)>s},updateRotation:function(e){if(!this.isRotationActive())return;const t=this.data,n=this.yaw,o=this.pitch;n.rotation.y=this.el.object3D.rotation.y,o.rotation.x=this.el.object3D.rotation.x;const i=this._lookVector;this.getJoystick(2,i),Math.abs(i.x)<=s&&(i.x=0),Math.abs(i.y)<=s&&(i.y=0),i.multiplyScalar(t.rotationSensitivity*e/1e3),n.rotation.y-=i.x,o.rotation.x-=i.y,o.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,o.rotation.x)),this.el.object3D.rotation.set(o.rotation.x,n.rotation.y,0)},updateButtonState:function(){const e=this.getGamepad(a);if(this.data.enabled&&e)for(var t=0;t<e.buttons.length;t++)e.buttons[t].pressed&&!this.buttons[t]?this.emit(new i("gamepadbuttondown",t,e.buttons[t])):!e.buttons[t].pressed&&this.buttons[t]&&this.emit(new i("gamepadbuttonup",t,e.buttons[t])),this.buttons[t]=e.buttons[t].pressed;else for(const e in this.buttons)this.buttons[e]=!1},emit:function(e){this.el.emit(e.type,e),this.el.emit(e.type+":"+e.index,new i(e.type,e.index,e))},getGamepad:function(){const e=[],t=[];return function(n){const o=this.el.sceneEl.components["proxy-controls"],i=o&&o.isConnected()&&o.getGamepad(0);if(i)return i;e.length=0;for(let t=0;t<this.system.controllers.length;t++){const o=this.system.controllers[t],i=o?o.gamepad:null;if(e.push(i),i&&o.handedness===n)return i}const s=navigator.getGamepads?navigator.getGamepads():t;for(let e=0;e<s.length;e++){const t=s[e];if(t&&t.hand===n)return t}return e[0]||s[0]}}(),getButton:function(e){return this.getGamepad(a).buttons[e]},getAxis:function(e){return this.getGamepad(e>1?a:r).axes[e]},getJoystick:function(e,t){const n=this.getGamepad(1===e?r:a);if(!n)return t.set(0,0);if("xr-standard"===n.mapping)switch(e){case 1:return t.set(n.axes[2],n.axes[3]);case 2:return t.set(n.axes[2],0)}else switch(e){case 1:return t.set(n.axes[0],n.axes[1]);case 2:return t.set(n.axes[2],n.axes[3])}throw new Error('Unexpected joystick index "%d".',e)},getDpad:function(e){const t=this.getGamepad(r);return t&&t.buttons[o.DPAD_RIGHT]?e.set((t.buttons[o.DPAD_RIGHT].pressed?1:0)+(t.buttons[o.DPAD_LEFT].pressed?-1:0),(t.buttons[o.DPAD_UP].pressed?-1:0)+(t.buttons[o.DPAD_DOWN].pressed?1:0)):e.set(0,0)},isConnected:function(){const e=this.getGamepad(r);return!(!e||!e.connected)},getID:function(){return this.getGamepad(r).id}}),n(919);const c=window.KeyboardEvent;AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this),onContextMenu:this.onContextMenu.bind(this)}},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){const e=this.data,t=this.getKeys();return this.dVelocity.set(0,0,0),e.enabled&&((t.KeyW||t.ArrowUp)&&(this.dVelocity.z-=1),(t.KeyA||t.ArrowLeft)&&(this.dVelocity.x-=1),(t.KeyS||t.ArrowDown)&&(this.dVelocity.z+=1),(t.KeyD||t.ArrowRight)&&(this.dVelocity.x+=1),t.ShiftLeft&&(this.dVelocity=this.dVelocity.multiplyScalar(2))),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},attachEventListeners:function(){window.addEventListener("contextmenu",this.listeners.onContextMenu,!1),window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},onContextMenu:function(){for(const e in this.localKeys)this.localKeys.hasOwnProperty(e)&&delete this.localKeys[e]},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(this.localKeys[e.code]=!0,this.emit(e))},onKeyUp:function(e){AFRAME.utils.shouldCaptureKeyEvent(e)&&(delete this.localKeys[e.code],this.emit(e))},onBlur:function(){for(const e in this.localKeys)this.localKeys.hasOwnProperty(e)&&delete this.localKeys[e]},emit:function(e){"__keyboard-controls-proxy"in e&&this.el.emit(e.type,e),this.el.emit(e.type+":"+e.code,new c(e.type,e)),this.data.debug&&console.log(e.type+":"+e.code)},isPressed:function(e){return e in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){const e=this.el.sceneEl.components["proxy-controls"];return e&&e.isConnected()}}),n(267),n(537),n(822);var l=n(464),d=n.n(l);AFRAME.registerComponent("nipple-controls",{schema:{enabled:{default:!0},mode:{default:"dynamic",oneOf:["static","semi","dynamic"]},rotationSensitivity:{default:1},moveJoystickEnabled:{default:!0},lookJoystickEnabled:{default:!0},sideMargin:{default:"30px"},bottomMargin:{default:"70px"},moveJoystickPosition:{default:"left",oneOf:["left","right"]},lookJoystickPosition:{default:"right",oneOf:["left","right"]}},init(){this.dVelocity=new THREE.Vector3,this.lookVector=new THREE.Vector2;const e=this.el.querySelector("[look-controls]").components["look-controls"];this.pitchObject=e.pitchObject,this.yawObject=e.yawObject,this.rigRotation=this.el.object3D.rotation,this.moveData=void 0,this.lookData=void 0,this.moving=!1,this.rotating=!1},update(e){this.data.moveJoystickPosition===e.moveJoystickPosition&&this.data.sideMargin===e.sideMargin&&this.data.bottomMargin===e.bottomMargin&&this.data.mode===e.mode||this.removeMoveJoystick(),this.data.lookJoystickPosition===e.lookJoystickPosition&&this.data.sideMargin===e.sideMargin&&this.data.bottomMargin===e.bottomMargin&&this.data.mode===e.mode||this.removeLookJoystick(),this.data.enabled&&this.data.moveJoystickEnabled?this.createMoveJoystick():this.removeMoveJoystick(),this.data.enabled&&this.data.lookJoystickEnabled?this.createLookJoystick():this.removeLookJoystick()},pause(){this.moving=!1,this.rotating=!1},remove(){this.removeMoveJoystick(),this.removeLookJoystick()},isVelocityActive(){return this.data.enabled&&this.moving},getVelocityDelta(){if(this.dVelocity.set(0,0,0),this.isVelocityActive()){const e=this.moveData.force<1?this.moveData.force:1,t=this.moveData.angle.radian,n=Math.cos(t)*e,o=-Math.sin(t)*e;this.dVelocity.set(n,0,o)}return this.dVelocity},isRotationActive(){return this.data.enabled&&this.rotating},updateRotation(e){if(!this.isRotationActive())return;const t=this.lookData.force<1?this.lookData.force:1,n=this.lookData.angle.radian,o=this.lookVector;o.x=Math.cos(n)*t,o.y=Math.sin(n)*t,o.multiplyScalar(this.data.rotationSensitivity*e/1e3),this.yawObject.rotation.y-=o.x;let i=this.pitchObject.rotation.x+o.y;i=Math.max(-Math.PI/2,Math.min(Math.PI/2,i)),this.pitchObject.rotation.x=i},tick:function(e,t){this.updateRotation(t)},initLeftZone(){const e=document.createElement("div");e.setAttribute("id","joystickLeftZone"),e.setAttribute("style",`position:absolute;${this.data.moveJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(e),this.leftZone=e},initRightZone(){const e=document.createElement("div");e.setAttribute("id","joystickRightZone"),e.setAttribute("style",`position:absolute;${this.data.lookJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(e),this.rightZone=e},createMoveJoystick(){if(this.moveJoystick)return;this.initLeftZone();const e={mode:this.data.mode,zone:this.leftZone,color:"white",fadeTime:0};this.leftZone.style.width="100px","static"===this.data.mode?(this.leftZone.style.height="100px",e.position={left:"50%",bottom:"50%"}):this.leftZone.style.height="400px",this.moveJoystick=d().create(e),this.moveJoystick.on("move",(e,t)=>{this.moveData=t,this.moving=!0}),this.moveJoystick.on("end",(e,t)=>{this.moving=!1})},createLookJoystick(){if(this.lookJoystick)return;this.initRightZone();const e={mode:this.data.mode,zone:this.rightZone,color:"white",fadeTime:0};this.rightZone.style.width="100px","static"===this.data.mode?(this.rightZone.style.height="100px",e.position={left:"50%",bottom:"50%"}):this.rightZone.style.height="400px",this.lookJoystick=d().create(e),this.lookJoystick.on("move",(e,t)=>{this.lookData=t,this.rotating=!0}),this.lookJoystick.on("end",(e,t)=>{this.rotating=!1})},removeMoveJoystick(){this.moveJoystick&&(this.moveJoystick.destroy(),this.moveJoystick=void 0),this.moveData=void 0,this.leftZone&&this.leftZone.parentNode&&(this.leftZone.remove(),this.leftZone=void 0)},removeLookJoystick(){this.lookJoystick&&(this.lookJoystick.destroy(),this.lookJoystick=void 0),this.lookData=void 0,this.rightZone&&this.rightZone.parentNode&&(this.rightZone.remove(),this.rightZone=void 0)}})},919:()=>{!function(e){var t="KeyboardEvent"in e;t||(e.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in e.KeyboardEvent||(e.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var n=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,o=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,i=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,s=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function r(e,t){return-1!==String(e).indexOf(t)}var a=r(navigator.platform,"Win")?"win":r(navigator.platform,"Mac")?"mac":r(navigator.platform,"CrOS")?"cros":r(navigator.platform,"Linux")?"linux":r(navigator.userAgent,"iPad")||r(navigator.platform,"iPod")||r(navigator.platform,"iPhone")?"ios":"",c=r(navigator.userAgent,"Chrome/")?"chrome":r(navigator.vendor,"Apple")?"safari":r(navigator.userAgent,"MSIE")?"ie":r(navigator.userAgent,"Gecko/")?"moz":r(navigator.userAgent,"Opera/")?"opera":"",l=c+"-"+a;function d(e,t,n){l!==t&&c!==t&&a!==t||Object.keys(n).forEach(function(t){e[t]=n[t]})}var h={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:o},92:{code:"OSRight",location:i},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:s},97:{code:"Numpad1",keyCap:"1",location:s},98:{code:"Numpad2",keyCap:"2",location:s},99:{code:"Numpad3",keyCap:"3",location:s},100:{code:"Numpad4",keyCap:"4",location:s},101:{code:"Numpad5",keyCap:"5",location:s},102:{code:"Numpad6",keyCap:"6",location:s},103:{code:"Numpad7",keyCap:"7",location:s},104:{code:"Numpad8",keyCap:"8",location:s},105:{code:"Numpad9",keyCap:"9",location:s},106:{code:"NumpadMultiply",keyCap:"*",location:s},107:{code:"NumpadAdd",keyCap:"+",location:s},108:{code:"NumpadComma",keyCap:",",location:s},109:{code:"NumpadSubtract",keyCap:"-",location:s},110:{code:"NumpadDecimal",keyCap:".",location:s},111:{code:"NumpadDivide",keyCap:"/",location:s},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:s},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:o},161:{code:"ShiftRight",location:i},162:{code:"ControlLeft",location:o},163:{code:"ControlRight",location:i},164:{code:"AltLeft",location:o},165:{code:"AltRight",location:i},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};d(h,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:s},189:{code:"NumpadSubtract",keyCap:"-",location:s}}),d(h,"moz-mac",{12:{code:"NumLock",location:s},173:{code:"Minus",keyCap:"-"}}),d(h,"moz-win",{173:{code:"Minus",keyCap:"-"}}),d(h,"chrome-mac",{93:{code:"OSRight",location:i}}),d(h,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),d(h,"ios",{10:{code:"Enter",location:n}}),d(h,"safari-mac",{91:{code:"OSLeft",location:o},93:{code:"OSRight",location:i},229:{code:"KeyQ",keyCap:"Q"}});var u={};"cros"===a&&(u["U+00A0"]={code:"ShiftLeft",location:o},u["U+00A1"]={code:"ShiftRight",location:i},u["U+00A2"]={code:"ControlLeft",location:o},u["U+00A3"]={code:"ControlRight",location:i},u["U+00A4"]={code:"AltLeft",location:o},u["U+00A5"]={code:"AltRight",location:i}),"chrome-mac"===l&&(u["U+0010"]={code:"ContextMenu"}),"safari-mac"===l&&(u["U+0010"]={code:"ContextMenu"}),"ios"===a&&(u["U+0010"]={code:"Function"},u["U+001C"]={code:"ArrowLeft"},u["U+001D"]={code:"ArrowRight"},u["U+001E"]={code:"ArrowUp"},u["U+001F"]={code:"ArrowDown"},u["U+0001"]={code:"Home"},u["U+0004"]={code:"End"},u["U+000B"]={code:"PageUp"},u["U+000C"]={code:"PageDown"});var p=[];p[o]={16:{code:"ShiftLeft",location:o},17:{code:"ControlLeft",location:o},18:{code:"AltLeft",location:o}},p[i]={16:{code:"ShiftRight",location:i},17:{code:"ControlRight",location:i},18:{code:"AltRight",location:i}},p[s]={13:{code:"NumpadEnter",location:s}},d(p[s],"moz",{109:{code:"NumpadSubtract",location:s},107:{code:"NumpadAdd",location:s}}),d(p[o],"moz-mac",{224:{code:"OSLeft",location:o}}),d(p[i],"moz-mac",{224:{code:"OSRight",location:i}}),d(p[i],"moz-win",{91:{code:"OSRight",location:i}}),d(p[i],"mac",{93:{code:"OSRight",location:i}}),d(p[s],"chrome-mac",{12:{code:"NumLock",location:s}}),d(p[s],"safari-mac",{12:{code:"NumLock",location:s},187:{code:"NumpadAdd",location:s},189:{code:"NumpadSubtract",location:s},190:{code:"NumpadDecimal",location:s},191:{code:"NumpadDivide",location:s}});var f={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};d(f,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var m,y,g,v={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},b=(m=h,y="code",g={},Object.keys(m).forEach(function(e){var t=m[e];y in t&&(g[t[y]]=t)}),g);try{var w=t&&"location"in new KeyboardEvent("")}catch(e){}function x(e){var t="keyCode"in e?e.keyCode:"which"in e?e.which:0,n=function(){if(w||"keyLocation"in e){var n=w?e.location:e.keyLocation;if(n&&t in p[n])return p[n][t]}return"keyIdentifier"in e&&e.keyIdentifier in u?u[e.keyIdentifier]:t in h?h[t]:null}();if(!n)return null;var o,i=(o=f[n.code])?e.shiftKey&&"shiftKey"in o?o.shiftKey:o.key:n.code;return{code:n.code,key:i,location:n.location,keyCap:n.keyCap}}"KeyboardEvent"in e&&"defineProperty"in Object&&function(){function e(e,t,n){t in e||Object.defineProperty(e,t,n)}if(e(KeyboardEvent.prototype,"code",{get:function(){var e=x(this);return e?e.code:""}}),"key"in KeyboardEvent.prototype){var t=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var e=t.get.call(this);return v.hasOwnProperty(e)?v[e]:e}})}e(KeyboardEvent.prototype,"key",{get:function(){var e=x(this);return e&&"key"in e?e.key:"Unidentified"}}),e(KeyboardEvent.prototype,"location",{get:function(){var e=x(this);return e&&"location"in e?e.location:n}}),e(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in e.KeyboardEvent||(e.KeyboardEvent.queryKeyCap=function(e,t){if(e=String(e),!b.hasOwnProperty(e))return"Undefined";if(t&&"en-us"!==String(t).toLowerCase())throw Error("Unsupported locale");var n=b[e];return n.keyCap||n.code||"Undefined"}),e.identifyKey=function(e){if(!("code"in e)){var t=x(e);e.code=t?t.code:"",e.key=t&&"key"in t?t.key:"Unidentified",e.location="location"in e?e.location:"keyLocation"in e?e.keyLocation:t&&"location"in t?t.location:n,e.locale=""}}}(window)},982:()=>{AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0},updateNavLocation:function(){this.group=null,this.path=[]},tick:function(){const e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(o,i){const s=this.el,r=this.data,a=this.raycaster,c=r.speed*i/1e3;if(!r.active)return;if(!this.path.length){const t=this.el.object3D.position;this.group=this.group||this.system.getGroup(t),this.path=this.system.getPath(t,e.copy(r.destination),this.group)||[],s.emit("navigation-start")}if(!this.path.length)return console.warn("[nav] Unable to find path to %o.",r.destination),this.el.setAttribute("nav-agent",{active:!1}),void s.emit("navigation-end");const l=s.object3D.position,d=this.path[0];let h;if(t.subVectors(d,l),t.length()<c){if(this.path.shift(),!this.path.length)return this.el.setAttribute("nav-agent",{active:!1}),void s.emit("navigation-end");n.copy(l),h=this.path[0]}else n.copy(t.setLength(c)).add(l),h=d;h.y=l.y,s.object3D.lookAt(h),a.ray.origin.copy(n),a.ray.origin.y+=1.5,a.ray.direction={x:0,y:-1,z:0};const u=a.intersectObject(this.system.getNavMesh());u.length?(t.subVectors(u[0].point,l),l.add(t.setLength(c))):l.copy(n)}}()})}},n={};function o(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,o),s.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";o.r(i),o(914),o(451),o(653),o(449),o(711)})(),i})());
//# sourceMappingURL=aframe-extras.min.js.map